{
    "origin": "codeshovel",
    "repositoryName": "tomcat",
    "repositoryPath": "/home/student/mortonss/research/better_bug_research/github_repos/tomcat/.git",
    "startCommitName": "HEAD",
    "sourceFileName": "HTMLManagerServlet.java",
    "functionName": "doPost",
    "functionId": "doPost___request-HttpServletRequest__response-HttpServletResponse",
    "sourceFilePath": "java/org/apache/catalina/manager/HTMLManagerServlet.java",
    "functionStartLine": 144,
    "functionEndLine": 206,
    "numCommitsSeen": 136,
    "timeTaken": 5039,
    "changeHistory": [
        "f1911d8c5f0dc3774fe731ae27d4a9a9b39197c3",
        "ffbbe88537b26444a4ac1396c19b13647b775a3d",
        "7125c9fc203b683374220322159e451c2c418cef",
        "2b6b1a887c0137eb52a5a2fed127112fb238885f",
        "87bc1e5ed9f0c6945c2da931a51b0f7d94dba341",
        "0681407981c65809956bf447b8822002b67381f0",
        "e59b0dcf03e2dfdb5fdd79c8c29e93d53becdfeb",
        "99f01fd6ddbf1945e2bc5531e055b7d993c4c634",
        "4cf35556f7254f6890a6f6a04fcacf3033334c9e",
        "b88897a8e39578ac09116bfa69437174aa9594e0",
        "13f53fbe1990fb7699d6e02a68951dd543d6d39b",
        "a0159a34201e21ebc60ed6acffe7343fe26a7b65",
        "73578675b8ded44bd98cbc5ad9a3a596029889f3",
        "291875a9af83f5e5ad8eeaafc2e83291cc5e9a3c",
        "80e61cdeb8924723b218d28636312bd879b7a04b",
        "0f8e4ddac4efa2dc30956a5a3b9294e59ad570cd",
        "4f8bf034fc3c14086253afe765a93387925b02b2",
        "f20214581129e40d56c9f5b8e560386b3137d513"
    ],
    "changeHistoryShort": {
        "f20214581129e40d56c9f5b8e560386b3137d513": "Ybodychange",
        "4f8bf034fc3c14086253afe765a93387925b02b2": "Ybodychange",
        "0f8e4ddac4efa2dc30956a5a3b9294e59ad570cd": "Ybodychange",
        "80e61cdeb8924723b218d28636312bd879b7a04b": "Ybodychange",
        "291875a9af83f5e5ad8eeaafc2e83291cc5e9a3c": "Ybodychange",
        "73578675b8ded44bd98cbc5ad9a3a596029889f3": "Ybodychange",
        "a0159a34201e21ebc60ed6acffe7343fe26a7b65": "Ybodychange",
        "13f53fbe1990fb7699d6e02a68951dd543d6d39b": "Ybodychange",
        "b88897a8e39578ac09116bfa69437174aa9594e0": "Ybodychange",
        "4cf35556f7254f6890a6f6a04fcacf3033334c9e": "Ybodychange",
        "99f01fd6ddbf1945e2bc5531e055b7d993c4c634": "Ybodychange",
        "e59b0dcf03e2dfdb5fdd79c8c29e93d53becdfeb": "Ybodychange",
        "0681407981c65809956bf447b8822002b67381f0": "Ybodychange",
        "87bc1e5ed9f0c6945c2da931a51b0f7d94dba341": "Ybodychange",
        "2b6b1a887c0137eb52a5a2fed127112fb238885f": "Ybodychange",
        "7125c9fc203b683374220322159e451c2c418cef": "Ybodychange",
        "ffbbe88537b26444a4ac1396c19b13647b775a3d": "Ybodychange",
        "f1911d8c5f0dc3774fe731ae27d4a9a9b39197c3": "Yintroduced"
    },
    "changeHistoryDetails": {
        "f20214581129e40d56c9f5b8e560386b3137d513": {
            "type": "Ybodychange",
            "commitMessage": "Cleanups",
            "commitDate": "16/03/25 8:20 AM",
            "commitName": "f20214581129e40d56c9f5b8e560386b3137d513",
            "commitAuthor": "remm",
            "commitDateOld": "03/01/25 11:07 AM",
            "commitNameOld": "1fe43f77dc82049e350b721c8593762729818eb5",
            "commitAuthorOld": "Christopher Schultz",
            "daysBetweenCommits": 71.84,
            "commitsBetweenForRepo": 209,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,63 +1,63 @@\n     public void doPost(HttpServletRequest request, HttpServletResponse response) throws IOException, ServletException {\n \n         StringManager smClient = StringManager.getManager(Constants.Package, request.getLocales());\n \n         // Identify the request parameters that we need\n         // By obtaining the command from the pathInfo, per-command security can\n         // be configured in web.xml\n         String command = request.getPathInfo();\n \n         String path = request.getParameter(\"path\");\n         ContextName cn = null;\n         if (path != null) {\n             cn = new ContextName(path, request.getParameter(\"version\"));\n         }\n \n         String deployPath = request.getParameter(\"deployPath\");\n         String deployWar = request.getParameter(\"deployWar\");\n         String deployConfig = request.getParameter(\"deployConfig\");\n         ContextName deployCn = null;\n-        if (deployPath != null && deployPath.length() > 0) {\n+        if (deployPath != null && !deployPath.isEmpty()) {\n             deployCn = new ContextName(deployPath, request.getParameter(\"deployVersion\"));\n-        } else if (deployConfig != null && deployConfig.length() > 0) {\n+        } else if (deployConfig != null && !deployConfig.isEmpty()) {\n             deployCn = ContextName.extractFromPath(deployConfig);\n-        } else if (deployWar != null && deployWar.length() > 0) {\n+        } else if (deployWar != null && !deployWar.isEmpty()) {\n             deployCn = ContextName.extractFromPath(deployWar);\n         }\n \n         String tlsHostName = request.getParameter(\"tlsHostName\");\n \n         // Prepare our output writer to generate the response message\n         response.setContentType(\"text/html; charset=\" + Constants.CHARSET);\n \n         String message = \"\";\n \n-        if (command == null || command.length() == 0) {\n+        if (command == null || command.isEmpty()) {\n             // No command == list\n             // List always displayed -> do nothing\n         } else if (command.equals(\"/upload\")) {\n             message = upload(request, smClient);\n         } else if (command.equals(\"/deploy\")) {\n             message = deployInternal(deployConfig, deployCn, deployWar, smClient);\n         } else if (command.equals(\"/reload\")) {\n             message = reload(cn, smClient);\n         } else if (command.equals(\"/undeploy\")) {\n             message = undeploy(cn, smClient);\n         } else if (command.equals(\"/expire\")) {\n             message = expireSessions(cn, request, smClient);\n         } else if (command.equals(\"/start\")) {\n             message = start(cn, smClient);\n         } else if (command.equals(\"/stop\")) {\n             message = stop(cn, smClient);\n         } else if (command.equals(\"/findleaks\")) {\n             message = findleaks(smClient);\n         } else if (command.equals(\"/sslReload\")) {\n             message = sslReload(tlsHostName, smClient);\n         } else {\n             // Try GET\n             doGet(request, response);\n             return;\n         }\n \n         list(request, response, message, smClient);\n     }\n\\ No newline at end of file\n",
            "actualSource": "    public void doPost(HttpServletRequest request, HttpServletResponse response) throws IOException, ServletException {\n\n        StringManager smClient = StringManager.getManager(Constants.Package, request.getLocales());\n\n        // Identify the request parameters that we need\n        // By obtaining the command from the pathInfo, per-command security can\n        // be configured in web.xml\n        String command = request.getPathInfo();\n\n        String path = request.getParameter(\"path\");\n        ContextName cn = null;\n        if (path != null) {\n            cn = new ContextName(path, request.getParameter(\"version\"));\n        }\n\n        String deployPath = request.getParameter(\"deployPath\");\n        String deployWar = request.getParameter(\"deployWar\");\n        String deployConfig = request.getParameter(\"deployConfig\");\n        ContextName deployCn = null;\n        if (deployPath != null && !deployPath.isEmpty()) {\n            deployCn = new ContextName(deployPath, request.getParameter(\"deployVersion\"));\n        } else if (deployConfig != null && !deployConfig.isEmpty()) {\n            deployCn = ContextName.extractFromPath(deployConfig);\n        } else if (deployWar != null && !deployWar.isEmpty()) {\n            deployCn = ContextName.extractFromPath(deployWar);\n        }\n\n        String tlsHostName = request.getParameter(\"tlsHostName\");\n\n        // Prepare our output writer to generate the response message\n        response.setContentType(\"text/html; charset=\" + Constants.CHARSET);\n\n        String message = \"\";\n\n        if (command == null || command.isEmpty()) {\n            // No command == list\n            // List always displayed -> do nothing\n        } else if (command.equals(\"/upload\")) {\n            message = upload(request, smClient);\n        } else if (command.equals(\"/deploy\")) {\n            message = deployInternal(deployConfig, deployCn, deployWar, smClient);\n        } else if (command.equals(\"/reload\")) {\n            message = reload(cn, smClient);\n        } else if (command.equals(\"/undeploy\")) {\n            message = undeploy(cn, smClient);\n        } else if (command.equals(\"/expire\")) {\n            message = expireSessions(cn, request, smClient);\n        } else if (command.equals(\"/start\")) {\n            message = start(cn, smClient);\n        } else if (command.equals(\"/stop\")) {\n            message = stop(cn, smClient);\n        } else if (command.equals(\"/findleaks\")) {\n            message = findleaks(smClient);\n        } else if (command.equals(\"/sslReload\")) {\n            message = sslReload(tlsHostName, smClient);\n        } else {\n            // Try GET\n            doGet(request, response);\n            return;\n        }\n\n        list(request, response, message, smClient);\n    }",
            "path": "java/org/apache/catalina/manager/HTMLManagerServlet.java",
            "extendedDetails": {}
        },
        "4f8bf034fc3c14086253afe765a93387925b02b2": {
            "type": "Ybodychange",
            "commitMessage": "Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=47467\nWhen deploying a web application via the manager application and a path is not explicitly specified, derive it from the provided deployment descriptor or, if that is not present, the WAR or DIR.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1825580 13f79535-47bb-0310-9956-ffa450edef68\n",
            "commitDate": "28/02/18 10:12 AM",
            "commitName": "4f8bf034fc3c14086253afe765a93387925b02b2",
            "commitAuthor": "Mark Thomas",
            "commitDateOld": "28/02/18 10:02 AM",
            "commitNameOld": "d130c4062d22f9d6b22a40baee60104e708dc1fe",
            "commitAuthorOld": "Mark Thomas",
            "daysBetweenCommits": 0.01,
            "commitsBetweenForRepo": 1,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,62 +1,67 @@\n     public void doPost(HttpServletRequest request,\n                       HttpServletResponse response)\n         throws IOException, ServletException {\n \n         StringManager smClient = StringManager.getManager(\n                 Constants.Package, request.getLocales());\n \n         // Identify the request parameters that we need\n         // By obtaining the command from the pathInfo, per-command security can\n         // be configured in web.xml\n         String command = request.getPathInfo();\n \n         String path = request.getParameter(\"path\");\n         ContextName cn = null;\n         if (path != null) {\n             cn = new ContextName(path, request.getParameter(\"version\"));\n         }\n+\n         String deployPath = request.getParameter(\"deployPath\");\n-        ContextName deployCn = null;\n-        if (deployPath != null) {\n-            deployCn = new ContextName(deployPath,\n-                    request.getParameter(\"deployVersion\"));\n-        }\n-        String deployConfig = request.getParameter(\"deployConfig\");\n         String deployWar = request.getParameter(\"deployWar\");\n+        String deployConfig = request.getParameter(\"deployConfig\");\n+        ContextName deployCn = null;\n+        if (deployPath != null && deployPath.length() > 0) {\n+            deployCn = new ContextName(deployPath, request.getParameter(\"deployVersion\"));\n+        } else if (deployConfig != null && deployConfig.length() > 0) {\n+            deployCn = ContextName.extractFromPath(deployConfig);\n+        } else if (deployWar != null && deployWar.length() > 0) {\n+            deployCn = ContextName.extractFromPath(deployWar);\n+        }\n+\n         String tlsHostName = request.getParameter(\"tlsHostName\");\n \n         // Prepare our output writer to generate the response message\n         response.setContentType(\"text/html; charset=\" + Constants.CHARSET);\n \n         String message = \"\";\n \n         if (command == null || command.length() == 0) {\n             // No command == list\n             // List always displayed -> do nothing\n         } else if (command.equals(\"/upload\")) {\n             message = upload(request, smClient);\n         } else if (command.equals(\"/deploy\")) {\n             message = deployInternal(deployConfig, deployCn, deployWar,\n                     smClient);\n         } else if (command.equals(\"/reload\")) {\n             message = reload(cn, smClient);\n         } else if (command.equals(\"/undeploy\")) {\n             message = undeploy(cn, smClient);\n         } else if (command.equals(\"/expire\")) {\n             message = expireSessions(cn, request, smClient);\n         } else if (command.equals(\"/start\")) {\n             message = start(cn, smClient);\n         } else if (command.equals(\"/stop\")) {\n             message = stop(cn, smClient);\n         } else if (command.equals(\"/findleaks\")) {\n             message = findleaks(smClient);\n         } else if (command.equals(\"/sslReload\")) {\n             message = sslReload(tlsHostName, smClient);\n         } else {\n             // Try GET\n             doGet(request,response);\n             return;\n         }\n \n         list(request, response, message, smClient);\n     }\n\\ No newline at end of file\n",
            "actualSource": "    public void doPost(HttpServletRequest request,\n                      HttpServletResponse response)\n        throws IOException, ServletException {\n\n        StringManager smClient = StringManager.getManager(\n                Constants.Package, request.getLocales());\n\n        // Identify the request parameters that we need\n        // By obtaining the command from the pathInfo, per-command security can\n        // be configured in web.xml\n        String command = request.getPathInfo();\n\n        String path = request.getParameter(\"path\");\n        ContextName cn = null;\n        if (path != null) {\n            cn = new ContextName(path, request.getParameter(\"version\"));\n        }\n\n        String deployPath = request.getParameter(\"deployPath\");\n        String deployWar = request.getParameter(\"deployWar\");\n        String deployConfig = request.getParameter(\"deployConfig\");\n        ContextName deployCn = null;\n        if (deployPath != null && deployPath.length() > 0) {\n            deployCn = new ContextName(deployPath, request.getParameter(\"deployVersion\"));\n        } else if (deployConfig != null && deployConfig.length() > 0) {\n            deployCn = ContextName.extractFromPath(deployConfig);\n        } else if (deployWar != null && deployWar.length() > 0) {\n            deployCn = ContextName.extractFromPath(deployWar);\n        }\n\n        String tlsHostName = request.getParameter(\"tlsHostName\");\n\n        // Prepare our output writer to generate the response message\n        response.setContentType(\"text/html; charset=\" + Constants.CHARSET);\n\n        String message = \"\";\n\n        if (command == null || command.length() == 0) {\n            // No command == list\n            // List always displayed -> do nothing\n        } else if (command.equals(\"/upload\")) {\n            message = upload(request, smClient);\n        } else if (command.equals(\"/deploy\")) {\n            message = deployInternal(deployConfig, deployCn, deployWar,\n                    smClient);\n        } else if (command.equals(\"/reload\")) {\n            message = reload(cn, smClient);\n        } else if (command.equals(\"/undeploy\")) {\n            message = undeploy(cn, smClient);\n        } else if (command.equals(\"/expire\")) {\n            message = expireSessions(cn, request, smClient);\n        } else if (command.equals(\"/start\")) {\n            message = start(cn, smClient);\n        } else if (command.equals(\"/stop\")) {\n            message = stop(cn, smClient);\n        } else if (command.equals(\"/findleaks\")) {\n            message = findleaks(smClient);\n        } else if (command.equals(\"/sslReload\")) {\n            message = sslReload(tlsHostName, smClient);\n        } else {\n            // Try GET\n            doGet(request,response);\n            return;\n        }\n\n        list(request, response, message, smClient);\n    }",
            "path": "java/org/apache/catalina/manager/HTMLManagerServlet.java",
            "extendedDetails": {}
        },
        "0f8e4ddac4efa2dc30956a5a3b9294e59ad570cd": {
            "type": "Ybodychange",
            "commitMessage": "Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=61565\nAdd TLS config reload to Manager app\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1818127 13f79535-47bb-0310-9956-ffa450edef68\n",
            "commitDate": "14/12/17 7:41 AM",
            "commitName": "0f8e4ddac4efa2dc30956a5a3b9294e59ad570cd",
            "commitAuthor": "Mark Thomas",
            "commitDateOld": "13/12/17 5:25 AM",
            "commitNameOld": "77860e1539797c0cb6b80806e75e5a429377015e",
            "commitAuthorOld": "Mark Thomas",
            "daysBetweenCommits": 1.09,
            "commitsBetweenForRepo": 5,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,59 +1,62 @@\n     public void doPost(HttpServletRequest request,\n                       HttpServletResponse response)\n         throws IOException, ServletException {\n \n         StringManager smClient = StringManager.getManager(\n                 Constants.Package, request.getLocales());\n \n         // Identify the request parameters that we need\n         // By obtaining the command from the pathInfo, per-command security can\n         // be configured in web.xml\n         String command = request.getPathInfo();\n \n         String path = request.getParameter(\"path\");\n         ContextName cn = null;\n         if (path != null) {\n             cn = new ContextName(path, request.getParameter(\"version\"));\n         }\n         String deployPath = request.getParameter(\"deployPath\");\n         ContextName deployCn = null;\n         if (deployPath != null) {\n             deployCn = new ContextName(deployPath,\n                     request.getParameter(\"deployVersion\"));\n         }\n         String deployConfig = request.getParameter(\"deployConfig\");\n         String deployWar = request.getParameter(\"deployWar\");\n+        String tlsHostName = request.getParameter(\"tlsHostName\");\n \n         // Prepare our output writer to generate the response message\n         response.setContentType(\"text/html; charset=\" + Constants.CHARSET);\n \n         String message = \"\";\n \n         if (command == null || command.length() == 0) {\n             // No command == list\n             // List always displayed -> do nothing\n         } else if (command.equals(\"/upload\")) {\n             message = upload(request, smClient);\n         } else if (command.equals(\"/deploy\")) {\n             message = deployInternal(deployConfig, deployCn, deployWar,\n                     smClient);\n         } else if (command.equals(\"/reload\")) {\n             message = reload(cn, smClient);\n         } else if (command.equals(\"/undeploy\")) {\n             message = undeploy(cn, smClient);\n         } else if (command.equals(\"/expire\")) {\n             message = expireSessions(cn, request, smClient);\n         } else if (command.equals(\"/start\")) {\n             message = start(cn, smClient);\n         } else if (command.equals(\"/stop\")) {\n             message = stop(cn, smClient);\n         } else if (command.equals(\"/findleaks\")) {\n             message = findleaks(smClient);\n+        } else if (command.equals(\"/sslReload\")) {\n+            message = sslReload(tlsHostName, smClient);\n         } else {\n             // Try GET\n             doGet(request,response);\n             return;\n         }\n \n         list(request, response, message, smClient);\n     }\n\\ No newline at end of file\n",
            "actualSource": "    public void doPost(HttpServletRequest request,\n                      HttpServletResponse response)\n        throws IOException, ServletException {\n\n        StringManager smClient = StringManager.getManager(\n                Constants.Package, request.getLocales());\n\n        // Identify the request parameters that we need\n        // By obtaining the command from the pathInfo, per-command security can\n        // be configured in web.xml\n        String command = request.getPathInfo();\n\n        String path = request.getParameter(\"path\");\n        ContextName cn = null;\n        if (path != null) {\n            cn = new ContextName(path, request.getParameter(\"version\"));\n        }\n        String deployPath = request.getParameter(\"deployPath\");\n        ContextName deployCn = null;\n        if (deployPath != null) {\n            deployCn = new ContextName(deployPath,\n                    request.getParameter(\"deployVersion\"));\n        }\n        String deployConfig = request.getParameter(\"deployConfig\");\n        String deployWar = request.getParameter(\"deployWar\");\n        String tlsHostName = request.getParameter(\"tlsHostName\");\n\n        // Prepare our output writer to generate the response message\n        response.setContentType(\"text/html; charset=\" + Constants.CHARSET);\n\n        String message = \"\";\n\n        if (command == null || command.length() == 0) {\n            // No command == list\n            // List always displayed -> do nothing\n        } else if (command.equals(\"/upload\")) {\n            message = upload(request, smClient);\n        } else if (command.equals(\"/deploy\")) {\n            message = deployInternal(deployConfig, deployCn, deployWar,\n                    smClient);\n        } else if (command.equals(\"/reload\")) {\n            message = reload(cn, smClient);\n        } else if (command.equals(\"/undeploy\")) {\n            message = undeploy(cn, smClient);\n        } else if (command.equals(\"/expire\")) {\n            message = expireSessions(cn, request, smClient);\n        } else if (command.equals(\"/start\")) {\n            message = start(cn, smClient);\n        } else if (command.equals(\"/stop\")) {\n            message = stop(cn, smClient);\n        } else if (command.equals(\"/findleaks\")) {\n            message = findleaks(smClient);\n        } else if (command.equals(\"/sslReload\")) {\n            message = sslReload(tlsHostName, smClient);\n        } else {\n            // Try GET\n            doGet(request,response);\n            return;\n        }\n\n        list(request, response, message, smClient);\n    }",
            "path": "java/org/apache/catalina/manager/HTMLManagerServlet.java",
            "extendedDetails": {}
        },
        "80e61cdeb8924723b218d28636312bd879b7a04b": {
            "type": "Ybodychange",
            "commitMessage": "Refactor to reduce code duplication\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1514291 13f79535-47bb-0310-9956-ffa450edef68\n",
            "commitDate": "15/08/13 9:25 AM",
            "commitName": "80e61cdeb8924723b218d28636312bd879b7a04b",
            "commitAuthor": "Mark Emlyn David Thomas",
            "commitDateOld": "14/03/13 3:34 PM",
            "commitNameOld": "ca205c1c429f5a497c57fbbcdf17bf19d8ea0ec5",
            "commitAuthorOld": "Mark Emlyn David Thomas",
            "daysBetweenCommits": 153.74,
            "commitsBetweenForRepo": 1113,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,58 +1,59 @@\n     public void doPost(HttpServletRequest request,\n                       HttpServletResponse response)\n         throws IOException, ServletException {\n \n-        StringManager smClient = getStringManager(request);\n+        StringManager smClient = StringManager.getManager(\n+                Constants.Package, request.getLocales());\n \n         // Identify the request parameters that we need\n         // By obtaining the command from the pathInfo, per-command security can\n         // be configured in web.xml\n         String command = request.getPathInfo();\n \n         String path = request.getParameter(\"path\");\n         ContextName cn = null;\n         if (path != null) {\n             cn = new ContextName(path, request.getParameter(\"version\"));\n         }\n         String deployPath = request.getParameter(\"deployPath\");\n         ContextName deployCn = null;\n         if (deployPath != null) {\n             deployCn = new ContextName(deployPath,\n                     request.getParameter(\"deployVersion\"));\n         }\n         String deployConfig = request.getParameter(\"deployConfig\");\n         String deployWar = request.getParameter(\"deployWar\");\n \n         // Prepare our output writer to generate the response message\n         response.setContentType(\"text/html; charset=\" + Constants.CHARSET);\n \n         String message = \"\";\n \n         if (command == null || command.length() == 0) {\n             // No command == list\n             // List always displayed -> do nothing\n         } else if (command.equals(\"/upload\")) {\n             message = upload(request, smClient);\n         } else if (command.equals(\"/deploy\")) {\n             message = deployInternal(deployConfig, deployCn, deployWar,\n                     smClient);\n         } else if (command.equals(\"/reload\")) {\n             message = reload(cn, smClient);\n         } else if (command.equals(\"/undeploy\")) {\n             message = undeploy(cn, smClient);\n         } else if (command.equals(\"/expire\")) {\n             message = expireSessions(cn, request, smClient);\n         } else if (command.equals(\"/start\")) {\n             message = start(cn, smClient);\n         } else if (command.equals(\"/stop\")) {\n             message = stop(cn, smClient);\n         } else if (command.equals(\"/findleaks\")) {\n             message = findleaks(smClient);\n         } else {\n             // Try GET\n             doGet(request,response);\n             return;\n         }\n \n         list(request, response, message, smClient);\n     }\n\\ No newline at end of file\n",
            "actualSource": "    public void doPost(HttpServletRequest request,\n                      HttpServletResponse response)\n        throws IOException, ServletException {\n\n        StringManager smClient = StringManager.getManager(\n                Constants.Package, request.getLocales());\n\n        // Identify the request parameters that we need\n        // By obtaining the command from the pathInfo, per-command security can\n        // be configured in web.xml\n        String command = request.getPathInfo();\n\n        String path = request.getParameter(\"path\");\n        ContextName cn = null;\n        if (path != null) {\n            cn = new ContextName(path, request.getParameter(\"version\"));\n        }\n        String deployPath = request.getParameter(\"deployPath\");\n        ContextName deployCn = null;\n        if (deployPath != null) {\n            deployCn = new ContextName(deployPath,\n                    request.getParameter(\"deployVersion\"));\n        }\n        String deployConfig = request.getParameter(\"deployConfig\");\n        String deployWar = request.getParameter(\"deployWar\");\n\n        // Prepare our output writer to generate the response message\n        response.setContentType(\"text/html; charset=\" + Constants.CHARSET);\n\n        String message = \"\";\n\n        if (command == null || command.length() == 0) {\n            // No command == list\n            // List always displayed -> do nothing\n        } else if (command.equals(\"/upload\")) {\n            message = upload(request, smClient);\n        } else if (command.equals(\"/deploy\")) {\n            message = deployInternal(deployConfig, deployCn, deployWar,\n                    smClient);\n        } else if (command.equals(\"/reload\")) {\n            message = reload(cn, smClient);\n        } else if (command.equals(\"/undeploy\")) {\n            message = undeploy(cn, smClient);\n        } else if (command.equals(\"/expire\")) {\n            message = expireSessions(cn, request, smClient);\n        } else if (command.equals(\"/start\")) {\n            message = start(cn, smClient);\n        } else if (command.equals(\"/stop\")) {\n            message = stop(cn, smClient);\n        } else if (command.equals(\"/findleaks\")) {\n            message = findleaks(smClient);\n        } else {\n            // Try GET\n            doGet(request,response);\n            return;\n        }\n\n        list(request, response, message, smClient);\n    }",
            "path": "java/org/apache/catalina/manager/HTMLManagerServlet.java",
            "extendedDetails": {}
        },
        "291875a9af83f5e5ad8eeaafc2e83291cc5e9a3c": {
            "type": "Ybodychange",
            "commitMessage": "Changes to Manager and HTML Manager to support parallel deployment\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1036828 13f79535-47bb-0310-9956-ffa450edef68\n",
            "commitDate": "19/11/10 6:55 AM",
            "commitName": "291875a9af83f5e5ad8eeaafc2e83291cc5e9a3c",
            "commitAuthor": "Mark Emlyn David Thomas",
            "commitDateOld": "15/11/10 11:52 AM",
            "commitNameOld": "22fde16fedd17ad1194ca0880b4b607ebe011665",
            "commitAuthorOld": "Mark Emlyn David Thomas",
            "daysBetweenCommits": 3.79,
            "commitsBetweenForRepo": 32,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,49 +1,58 @@\n     public void doPost(HttpServletRequest request,\n                       HttpServletResponse response)\n         throws IOException, ServletException {\n \n         StringManager smClient = getStringManager(request);\n \n         // Identify the request parameters that we need\n         // By obtaining the command from the pathInfo, per-command security can\n         // be configured in web.xml\n         String command = request.getPathInfo();\n \n         String path = request.getParameter(\"path\");\n+        ContextName cn = null;\n+        if (path != null) {\n+            cn = new ContextName(path, request.getParameter(\"version\"));\n+        }\n         String deployPath = request.getParameter(\"deployPath\");\n+        ContextName deployCn = null;\n+        if (deployPath != null) {\n+            deployCn = new ContextName(deployPath,\n+                    request.getParameter(\"deployVersion\")); \n+        }\n         String deployConfig = request.getParameter(\"deployConfig\");\n         String deployWar = request.getParameter(\"deployWar\");\n \n         // Prepare our output writer to generate the response message\n         response.setContentType(\"text/html; charset=\" + Constants.CHARSET);\n \n         String message = \"\";\n \n         if (command == null || command.length() == 0) {\n             // No command == list\n             // List always displayed -> do nothing\n         } else if (command.equals(\"/upload\")) {\n             message = upload(request, smClient);\n         } else if (command.equals(\"/deploy\")) {\n-            message = deployInternal(deployConfig, deployPath, deployWar,\n+            message = deployInternal(deployConfig, deployCn, deployWar,\n                     smClient);\n         } else if (command.equals(\"/reload\")) {\n-            message = reload(path, smClient);\n+            message = reload(cn, smClient);\n         } else if (command.equals(\"/undeploy\")) {\n-            message = undeploy(path, smClient);\n+            message = undeploy(cn, smClient);\n         } else if (command.equals(\"/expire\")) {\n-            message = expireSessions(path, request, smClient);\n+            message = expireSessions(cn, request, smClient);\n         } else if (command.equals(\"/start\")) {\n-            message = start(path, smClient);\n+            message = start(cn, smClient);\n         } else if (command.equals(\"/stop\")) {\n-            message = stop(path, smClient);\n+            message = stop(cn, smClient);\n         } else if (command.equals(\"/findleaks\")) {\n             message = findleaks(smClient);\n         } else {\n             // Try GET\n             doGet(request,response);\n             return;\n         }\n \n         list(request, response, message, smClient);\n     }\n\\ No newline at end of file\n",
            "actualSource": "    public void doPost(HttpServletRequest request,\n                      HttpServletResponse response)\n        throws IOException, ServletException {\n\n        StringManager smClient = getStringManager(request);\n\n        // Identify the request parameters that we need\n        // By obtaining the command from the pathInfo, per-command security can\n        // be configured in web.xml\n        String command = request.getPathInfo();\n\n        String path = request.getParameter(\"path\");\n        ContextName cn = null;\n        if (path != null) {\n            cn = new ContextName(path, request.getParameter(\"version\"));\n        }\n        String deployPath = request.getParameter(\"deployPath\");\n        ContextName deployCn = null;\n        if (deployPath != null) {\n            deployCn = new ContextName(deployPath,\n                    request.getParameter(\"deployVersion\")); \n        }\n        String deployConfig = request.getParameter(\"deployConfig\");\n        String deployWar = request.getParameter(\"deployWar\");\n\n        // Prepare our output writer to generate the response message\n        response.setContentType(\"text/html; charset=\" + Constants.CHARSET);\n\n        String message = \"\";\n\n        if (command == null || command.length() == 0) {\n            // No command == list\n            // List always displayed -> do nothing\n        } else if (command.equals(\"/upload\")) {\n            message = upload(request, smClient);\n        } else if (command.equals(\"/deploy\")) {\n            message = deployInternal(deployConfig, deployCn, deployWar,\n                    smClient);\n        } else if (command.equals(\"/reload\")) {\n            message = reload(cn, smClient);\n        } else if (command.equals(\"/undeploy\")) {\n            message = undeploy(cn, smClient);\n        } else if (command.equals(\"/expire\")) {\n            message = expireSessions(cn, request, smClient);\n        } else if (command.equals(\"/start\")) {\n            message = start(cn, smClient);\n        } else if (command.equals(\"/stop\")) {\n            message = stop(cn, smClient);\n        } else if (command.equals(\"/findleaks\")) {\n            message = findleaks(smClient);\n        } else {\n            // Try GET\n            doGet(request,response);\n            return;\n        }\n\n        list(request, response, message, smClient);\n    }",
            "path": "java/org/apache/catalina/manager/HTMLManagerServlet.java",
            "extendedDetails": {},
            "BugCommit": "0",
            "TangledWMoveandFileRename": "17"
        },
        "73578675b8ded44bd98cbc5ad9a3a596029889f3": {
            "type": "Ybodychange",
            "commitMessage": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49426\nMessages displayed to the user in the Manager (text and HTML) should be based on the Locale of the user, not the server\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1023361 13f79535-47bb-0310-9956-ffa450edef68\n",
            "commitDate": "16/10/10 2:31 PM",
            "commitName": "73578675b8ded44bd98cbc5ad9a3a596029889f3",
            "commitAuthor": "Mark Emlyn David Thomas",
            "commitDateOld": "27/09/10 4:32 PM",
            "commitNameOld": "27a4f9f7f7ac9bc02bb2750c122d2de1f000644e",
            "commitAuthorOld": "Mark Emlyn David Thomas",
            "daysBetweenCommits": 18.92,
            "commitsBetweenForRepo": 161,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,46 +1,49 @@\n     public void doPost(HttpServletRequest request,\n                       HttpServletResponse response)\n         throws IOException, ServletException {\n \n+        StringManager smClient = getStringManager(request);\n+\n         // Identify the request parameters that we need\n         // By obtaining the command from the pathInfo, per-command security can\n         // be configured in web.xml\n         String command = request.getPathInfo();\n \n         String path = request.getParameter(\"path\");\n         String deployPath = request.getParameter(\"deployPath\");\n         String deployConfig = request.getParameter(\"deployConfig\");\n         String deployWar = request.getParameter(\"deployWar\");\n \n         // Prepare our output writer to generate the response message\n         response.setContentType(\"text/html; charset=\" + Constants.CHARSET);\n \n         String message = \"\";\n \n         if (command == null || command.length() == 0) {\n             // No command == list\n             // List always displayed -> do nothing\n         } else if (command.equals(\"/upload\")) {\n-            message = upload(request);\n+            message = upload(request, smClient);\n         } else if (command.equals(\"/deploy\")) {\n-            message = deployInternal(deployConfig, deployPath, deployWar);\n+            message = deployInternal(deployConfig, deployPath, deployWar,\n+                    smClient);\n         } else if (command.equals(\"/reload\")) {\n-            message = reload(path);\n+            message = reload(path, smClient);\n         } else if (command.equals(\"/undeploy\")) {\n-            message = undeploy(path);\n+            message = undeploy(path, smClient);\n         } else if (command.equals(\"/expire\")) {\n-            message = expireSessions(path, request);\n+            message = expireSessions(path, request, smClient);\n         } else if (command.equals(\"/start\")) {\n-            message = start(path);\n+            message = start(path, smClient);\n         } else if (command.equals(\"/stop\")) {\n-            message = stop(path);\n+            message = stop(path, smClient);\n         } else if (command.equals(\"/findleaks\")) {\n-            message = findleaks();\n+            message = findleaks(smClient);\n         } else {\n             // Try GET\n             doGet(request,response);\n             return;\n         }\n \n-        list(request, response, message);\n+        list(request, response, message, smClient);\n     }\n\\ No newline at end of file\n",
            "actualSource": "    public void doPost(HttpServletRequest request,\n                      HttpServletResponse response)\n        throws IOException, ServletException {\n\n        StringManager smClient = getStringManager(request);\n\n        // Identify the request parameters that we need\n        // By obtaining the command from the pathInfo, per-command security can\n        // be configured in web.xml\n        String command = request.getPathInfo();\n\n        String path = request.getParameter(\"path\");\n        String deployPath = request.getParameter(\"deployPath\");\n        String deployConfig = request.getParameter(\"deployConfig\");\n        String deployWar = request.getParameter(\"deployWar\");\n\n        // Prepare our output writer to generate the response message\n        response.setContentType(\"text/html; charset=\" + Constants.CHARSET);\n\n        String message = \"\";\n\n        if (command == null || command.length() == 0) {\n            // No command == list\n            // List always displayed -> do nothing\n        } else if (command.equals(\"/upload\")) {\n            message = upload(request, smClient);\n        } else if (command.equals(\"/deploy\")) {\n            message = deployInternal(deployConfig, deployPath, deployWar,\n                    smClient);\n        } else if (command.equals(\"/reload\")) {\n            message = reload(path, smClient);\n        } else if (command.equals(\"/undeploy\")) {\n            message = undeploy(path, smClient);\n        } else if (command.equals(\"/expire\")) {\n            message = expireSessions(path, request, smClient);\n        } else if (command.equals(\"/start\")) {\n            message = start(path, smClient);\n        } else if (command.equals(\"/stop\")) {\n            message = stop(path, smClient);\n        } else if (command.equals(\"/findleaks\")) {\n            message = findleaks(smClient);\n        } else {\n            // Try GET\n            doGet(request,response);\n            return;\n        }\n\n        list(request, response, message, smClient);\n    }",
            "path": "java/org/apache/catalina/manager/HTMLManagerServlet.java",
            "extendedDetails": {},
            "BugCommit": "0",
            "TangledWMoveandFileRename": "23"
        },
        "a0159a34201e21ebc60ed6acffe7343fe26a7b65": {
            "type": "Ybodychange",
            "commitMessage": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49476\nCSRF protection was preventing access to session expiration features\nAlso:\n- Switch Manager app to generic CSRF protection\n- Add support for multiple nonces to CSRF filter\n- Improve 403 page\n- Don't open JSP pages in session expiration in a new window - makes CSRF prevention a real pain\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@957478 13f79535-47bb-0310-9956-ffa450edef68\n",
            "commitDate": "24/06/10 4:57 AM",
            "commitName": "a0159a34201e21ebc60ed6acffe7343fe26a7b65",
            "commitAuthor": "Mark Emlyn David Thomas",
            "commitDateOld": "11/05/10 3:05 PM",
            "commitNameOld": "5ad9ecdfc65736b88613e42bcc849008d2cacd71",
            "commitAuthorOld": "Mark Emlyn David Thomas",
            "daysBetweenCommits": 43.58,
            "commitsBetweenForRepo": 244,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,65 +1,46 @@\n     public void doPost(HttpServletRequest request,\n                       HttpServletResponse response)\n         throws IOException, ServletException {\n \n         // Identify the request parameters that we need\n         // By obtaining the command from the pathInfo, per-command security can\n         // be configured in web.xml\n         String command = request.getPathInfo();\n \n         String path = request.getParameter(\"path\");\n         String deployPath = request.getParameter(\"deployPath\");\n         String deployConfig = request.getParameter(\"deployConfig\");\n         String deployWar = request.getParameter(\"deployWar\");\n-        String requestNonce = request.getParameter(NONCE_REQUEST);\n \n         // Prepare our output writer to generate the response message\n         response.setContentType(\"text/html; charset=\" + Constants.CHARSET);\n \n         String message = \"\";\n \n-        // Check nonce\n-        // There *must* be a nonce in the session before any POST is processed\n-        HttpSession session = request.getSession();\n-        String sessionNonce = (String) session.getAttribute(NONCE_SESSION);\n-        if (sessionNonce == null) {\n-            message = sm.getString(\"htmlManagerServlet.noNonce\", command);\n-            // Reset the command\n-            command = null;\n-        } else {\n-            if (!sessionNonce.equals(requestNonce)) {\n-                // Nonce mis-match.\n-                message =\n-                    sm.getString(\"htmlManagerServlet.nonceMismatch\", command);\n-                // Reset the command\n-                command = null;\n-            }\n-        }\n-        \n         if (command == null || command.length() == 0) {\n             // No command == list\n             // List always displayed -> do nothing\n         } else if (command.equals(\"/upload\")) {\n             message = upload(request);\n         } else if (command.equals(\"/deploy\")) {\n             message = deployInternal(deployConfig, deployPath, deployWar);\n         } else if (command.equals(\"/reload\")) {\n             message = reload(path);\n         } else if (command.equals(\"/undeploy\")) {\n             message = undeploy(path);\n         } else if (command.equals(\"/expire\")) {\n             message = expireSessions(path, request);\n         } else if (command.equals(\"/start\")) {\n             message = start(path);\n         } else if (command.equals(\"/stop\")) {\n             message = stop(path);\n         } else if (command.equals(\"/findleaks\")) {\n             message = findleaks();\n         } else {\n             // Try GET\n             doGet(request,response);\n             return;\n         }\n \n         list(request, response, message);\n     }\n\\ No newline at end of file\n",
            "actualSource": "    public void doPost(HttpServletRequest request,\n                      HttpServletResponse response)\n        throws IOException, ServletException {\n\n        // Identify the request parameters that we need\n        // By obtaining the command from the pathInfo, per-command security can\n        // be configured in web.xml\n        String command = request.getPathInfo();\n\n        String path = request.getParameter(\"path\");\n        String deployPath = request.getParameter(\"deployPath\");\n        String deployConfig = request.getParameter(\"deployConfig\");\n        String deployWar = request.getParameter(\"deployWar\");\n\n        // Prepare our output writer to generate the response message\n        response.setContentType(\"text/html; charset=\" + Constants.CHARSET);\n\n        String message = \"\";\n\n        if (command == null || command.length() == 0) {\n            // No command == list\n            // List always displayed -> do nothing\n        } else if (command.equals(\"/upload\")) {\n            message = upload(request);\n        } else if (command.equals(\"/deploy\")) {\n            message = deployInternal(deployConfig, deployPath, deployWar);\n        } else if (command.equals(\"/reload\")) {\n            message = reload(path);\n        } else if (command.equals(\"/undeploy\")) {\n            message = undeploy(path);\n        } else if (command.equals(\"/expire\")) {\n            message = expireSessions(path, request);\n        } else if (command.equals(\"/start\")) {\n            message = start(path);\n        } else if (command.equals(\"/stop\")) {\n            message = stop(path);\n        } else if (command.equals(\"/findleaks\")) {\n            message = findleaks();\n        } else {\n            // Try GET\n            doGet(request,response);\n            return;\n        }\n\n        list(request, response, message);\n    }",
            "path": "java/org/apache/catalina/manager/HTMLManagerServlet.java",
            "extendedDetails": {},
            "BugCommit": "0",
            "TangledWMoveandFileRename": "5"
        },
        "13f53fbe1990fb7699d6e02a68951dd543d6d39b": {
            "type": "Ybodychange",
            "commitMessage": "Add a find leaks option - with a suitable warning to the manager app (html & text)\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@909528 13f79535-47bb-0310-9956-ffa450edef68\n",
            "commitDate": "12/02/10 11:51 AM",
            "commitName": "13f53fbe1990fb7699d6e02a68951dd543d6d39b",
            "commitAuthor": "Mark Emlyn David Thomas",
            "commitDateOld": "02/01/10 8:22 AM",
            "commitNameOld": "8f4ebe23a2fa948273f950930c9ea216ad46da3b",
            "commitAuthorOld": "Rainer Jung",
            "daysBetweenCommits": 41.14,
            "commitsBetweenForRepo": 287,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,63 +1,65 @@\n     public void doPost(HttpServletRequest request,\n                       HttpServletResponse response)\n         throws IOException, ServletException {\n \n         // Identify the request parameters that we need\n         // By obtaining the command from the pathInfo, per-command security can\n         // be configured in web.xml\n         String command = request.getPathInfo();\n \n         String path = request.getParameter(\"path\");\n         String deployPath = request.getParameter(\"deployPath\");\n         String deployConfig = request.getParameter(\"deployConfig\");\n         String deployWar = request.getParameter(\"deployWar\");\n         String requestNonce = request.getParameter(NONCE_REQUEST);\n \n         // Prepare our output writer to generate the response message\n         response.setContentType(\"text/html; charset=\" + Constants.CHARSET);\n \n         String message = \"\";\n \n         // Check nonce\n         // There *must* be a nonce in the session before any POST is processed\n         HttpSession session = request.getSession();\n         String sessionNonce = (String) session.getAttribute(NONCE_SESSION);\n         if (sessionNonce == null) {\n             message = sm.getString(\"htmlManagerServlet.noNonce\", command);\n             // Reset the command\n             command = null;\n         } else {\n             if (!sessionNonce.equals(requestNonce)) {\n                 // Nonce mis-match.\n                 message =\n                     sm.getString(\"htmlManagerServlet.nonceMismatch\", command);\n                 // Reset the command\n                 command = null;\n             }\n         }\n         \n         if (command == null || command.length() == 0) {\n             // No command == list\n             // List always displayed -> do nothing\n         } else if (command.equals(\"/upload\")) {\n             message = upload(request);\n         } else if (command.equals(\"/deploy\")) {\n             message = deployInternal(deployConfig, deployPath, deployWar);\n         } else if (command.equals(\"/reload\")) {\n             message = reload(path);\n         } else if (command.equals(\"/undeploy\")) {\n             message = undeploy(path);\n         } else if (command.equals(\"/expire\")) {\n             message = expireSessions(path, request);\n         } else if (command.equals(\"/start\")) {\n             message = start(path);\n         } else if (command.equals(\"/stop\")) {\n             message = stop(path);\n+        } else if (command.equals(\"/findleaks\")) {\n+            message = findleaks();\n         } else {\n             // Try GET\n             doGet(request,response);\n             return;\n         }\n \n         list(request, response, message);\n     }\n\\ No newline at end of file\n",
            "actualSource": "    public void doPost(HttpServletRequest request,\n                      HttpServletResponse response)\n        throws IOException, ServletException {\n\n        // Identify the request parameters that we need\n        // By obtaining the command from the pathInfo, per-command security can\n        // be configured in web.xml\n        String command = request.getPathInfo();\n\n        String path = request.getParameter(\"path\");\n        String deployPath = request.getParameter(\"deployPath\");\n        String deployConfig = request.getParameter(\"deployConfig\");\n        String deployWar = request.getParameter(\"deployWar\");\n        String requestNonce = request.getParameter(NONCE_REQUEST);\n\n        // Prepare our output writer to generate the response message\n        response.setContentType(\"text/html; charset=\" + Constants.CHARSET);\n\n        String message = \"\";\n\n        // Check nonce\n        // There *must* be a nonce in the session before any POST is processed\n        HttpSession session = request.getSession();\n        String sessionNonce = (String) session.getAttribute(NONCE_SESSION);\n        if (sessionNonce == null) {\n            message = sm.getString(\"htmlManagerServlet.noNonce\", command);\n            // Reset the command\n            command = null;\n        } else {\n            if (!sessionNonce.equals(requestNonce)) {\n                // Nonce mis-match.\n                message =\n                    sm.getString(\"htmlManagerServlet.nonceMismatch\", command);\n                // Reset the command\n                command = null;\n            }\n        }\n        \n        if (command == null || command.length() == 0) {\n            // No command == list\n            // List always displayed -> do nothing\n        } else if (command.equals(\"/upload\")) {\n            message = upload(request);\n        } else if (command.equals(\"/deploy\")) {\n            message = deployInternal(deployConfig, deployPath, deployWar);\n        } else if (command.equals(\"/reload\")) {\n            message = reload(path);\n        } else if (command.equals(\"/undeploy\")) {\n            message = undeploy(path);\n        } else if (command.equals(\"/expire\")) {\n            message = expireSessions(path, request);\n        } else if (command.equals(\"/start\")) {\n            message = start(path);\n        } else if (command.equals(\"/stop\")) {\n            message = stop(path);\n        } else if (command.equals(\"/findleaks\")) {\n            message = findleaks();\n        } else {\n            // Try GET\n            doGet(request,response);\n            return;\n        }\n\n        list(request, response, message);\n    }",
            "path": "java/org/apache/catalina/manager/HTMLManagerServlet.java",
            "extendedDetails": {},
            "BugCommit": "0",
            "TangledWMoveandFileRename": "3"
        },
        "b88897a8e39578ac09116bfa69437174aa9594e0": {
            "type": "Ybodychange",
            "commitMessage": "Use string manager for i18n.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@826291 13f79535-47bb-0310-9956-ffa450edef68\n",
            "commitDate": "17/10/09 2:21 PM",
            "commitName": "b88897a8e39578ac09116bfa69437174aa9594e0",
            "commitAuthor": "Mark Emlyn David Thomas",
            "commitDateOld": "11/10/09 1:55 AM",
            "commitNameOld": "a6ed4a1669ac7360fbb16c6045af7867b70153a4",
            "commitAuthorOld": "Konstantin Kolinko",
            "daysBetweenCommits": 6.52,
            "commitsBetweenForRepo": 8,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,62 +1,63 @@\n     public void doPost(HttpServletRequest request,\n                       HttpServletResponse response)\n         throws IOException, ServletException {\n \n         // Identify the request parameters that we need\n         // By obtaining the command from the pathInfo, per-command security can\n         // be configured in web.xml\n         String command = request.getPathInfo();\n \n         String path = request.getParameter(\"path\");\n         String deployPath = request.getParameter(\"deployPath\");\n         String deployConfig = request.getParameter(\"deployConfig\");\n         String deployWar = request.getParameter(\"deployWar\");\n         String requestNonce = request.getParameter(NONCE_REQUEST);\n \n         // Prepare our output writer to generate the response message\n         response.setContentType(\"text/html; charset=\" + Constants.CHARSET);\n \n         String message = \"\";\n \n         // Check nonce\n         // There *must* be a nonce in the session before any POST is processed\n         HttpSession session = request.getSession();\n         String sessionNonce = (String) session.getAttribute(NONCE_SESSION);\n         if (sessionNonce == null) {\n-            message = \"FAIL: No nonce found in session. Command [\" + command + \"] was ignored.\";\n+            message = sm.getString(\"htmlManagerServlet.noNonce\", command);\n             // Reset the command\n             command = null;\n         } else {\n             if (!sessionNonce.equals(requestNonce)) {\n                 // Nonce mis-match.\n-                message = \"FAIL: Nonce mismatch. Command [\" + command + \"] was ignored.\";\n+                message =\n+                    sm.getString(\"htmlManagerServlet.nonceMismatch\", command);\n                 // Reset the command\n                 command = null;\n             }\n         }\n         \n         if (command == null || command.length() == 0) {\n             // No command == list\n             // List always displayed -> do nothing\n         } else if (command.equals(\"/upload\")) {\n             message = upload(request);\n         } else if (command.equals(\"/deploy\")) {\n             message = deployInternal(deployConfig, deployPath, deployWar);\n         } else if (command.equals(\"/reload\")) {\n             message = reload(path);\n         } else if (command.equals(\"/undeploy\")) {\n             message = undeploy(path);\n         } else if (command.equals(\"/expire\")) {\n             message = expireSessions(path, request);\n         } else if (command.equals(\"/start\")) {\n             message = start(path);\n         } else if (command.equals(\"/stop\")) {\n             message = stop(path);\n         } else {\n             // Try GET\n             doGet(request,response);\n             return;\n         }\n \n         list(request, response, message);\n     }\n\\ No newline at end of file\n",
            "actualSource": "    public void doPost(HttpServletRequest request,\n                      HttpServletResponse response)\n        throws IOException, ServletException {\n\n        // Identify the request parameters that we need\n        // By obtaining the command from the pathInfo, per-command security can\n        // be configured in web.xml\n        String command = request.getPathInfo();\n\n        String path = request.getParameter(\"path\");\n        String deployPath = request.getParameter(\"deployPath\");\n        String deployConfig = request.getParameter(\"deployConfig\");\n        String deployWar = request.getParameter(\"deployWar\");\n        String requestNonce = request.getParameter(NONCE_REQUEST);\n\n        // Prepare our output writer to generate the response message\n        response.setContentType(\"text/html; charset=\" + Constants.CHARSET);\n\n        String message = \"\";\n\n        // Check nonce\n        // There *must* be a nonce in the session before any POST is processed\n        HttpSession session = request.getSession();\n        String sessionNonce = (String) session.getAttribute(NONCE_SESSION);\n        if (sessionNonce == null) {\n            message = sm.getString(\"htmlManagerServlet.noNonce\", command);\n            // Reset the command\n            command = null;\n        } else {\n            if (!sessionNonce.equals(requestNonce)) {\n                // Nonce mis-match.\n                message =\n                    sm.getString(\"htmlManagerServlet.nonceMismatch\", command);\n                // Reset the command\n                command = null;\n            }\n        }\n        \n        if (command == null || command.length() == 0) {\n            // No command == list\n            // List always displayed -> do nothing\n        } else if (command.equals(\"/upload\")) {\n            message = upload(request);\n        } else if (command.equals(\"/deploy\")) {\n            message = deployInternal(deployConfig, deployPath, deployWar);\n        } else if (command.equals(\"/reload\")) {\n            message = reload(path);\n        } else if (command.equals(\"/undeploy\")) {\n            message = undeploy(path);\n        } else if (command.equals(\"/expire\")) {\n            message = expireSessions(path, request);\n        } else if (command.equals(\"/start\")) {\n            message = start(path);\n        } else if (command.equals(\"/stop\")) {\n            message = stop(path);\n        } else {\n            // Try GET\n            doGet(request,response);\n            return;\n        }\n\n        list(request, response, message);\n    }",
            "path": "java/org/apache/catalina/manager/HTMLManagerServlet.java",
            "extendedDetails": {},
            "BugCommit": "0",
            "TangledWMoveandFileRename": "1"
        },
        "4cf35556f7254f6890a6f6a04fcacf3033334c9e": {
            "type": "Ybodychange",
            "commitMessage": "Use a nonce to provide CSRF protection\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@823975 13f79535-47bb-0310-9956-ffa450edef68\n",
            "commitDate": "10/10/09 6:11 PM",
            "commitName": "4cf35556f7254f6890a6f6a04fcacf3033334c9e",
            "commitAuthor": "Mark Emlyn David Thomas",
            "commitDateOld": "10/10/09 4:54 PM",
            "commitNameOld": "99f01fd6ddbf1945e2bc5531e055b7d993c4c634",
            "commitAuthorOld": "Mark Emlyn David Thomas",
            "daysBetweenCommits": 0.05,
            "commitsBetweenForRepo": 1,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,44 +1,62 @@\n     public void doPost(HttpServletRequest request,\n                       HttpServletResponse response)\n         throws IOException, ServletException {\n \n         // Identify the request parameters that we need\n         // By obtaining the command from the pathInfo, per-command security can\n         // be configured in web.xml\n         String command = request.getPathInfo();\n \n         String path = request.getParameter(\"path\");\n         String deployPath = request.getParameter(\"deployPath\");\n         String deployConfig = request.getParameter(\"deployConfig\");\n         String deployWar = request.getParameter(\"deployWar\");\n+        String requestNonce = request.getParameter(NONCE_REQUEST);\n \n         // Prepare our output writer to generate the response message\n         response.setContentType(\"text/html; charset=\" + Constants.CHARSET);\n \n         String message = \"\";\n \n+        // Check nonce\n+        // There *must* be a nonce in the session before any POST is processed\n+        HttpSession session = request.getSession();\n+        String sessionNonce = (String) session.getAttribute(NONCE_SESSION);\n+        if (sessionNonce == null) {\n+            message = \"FAIL: No nonce found in session. Command [\" + command + \"] was ignored.\";\n+            // Reset the command\n+            command = null;\n+        } else {\n+            if (!sessionNonce.equals(requestNonce)) {\n+                // Nonce mis-match.\n+                message = \"FAIL: Nonce mismatch. Command [\" + command + \"] was ignored.\";\n+                // Reset the command\n+                command = null;\n+            }\n+        }\n+        \n         if (command == null || command.length() == 0) {\n             // No command == list\n             // List always displayed -> do nothing\n         } else if (command.equals(\"/upload\")) {\n             message = upload(request);\n         } else if (command.equals(\"/deploy\")) {\n             message = deployInternal(deployConfig, deployPath, deployWar);\n         } else if (command.equals(\"/reload\")) {\n             message = reload(path);\n         } else if (command.equals(\"/undeploy\")) {\n             message = undeploy(path);\n         } else if (command.equals(\"/expire\")) {\n             message = expireSessions(path, request);\n         } else if (command.equals(\"/start\")) {\n             message = start(path);\n         } else if (command.equals(\"/stop\")) {\n             message = stop(path);\n         } else {\n             // Try GET\n             doGet(request,response);\n             return;\n         }\n \n         list(request, response, message);\n     }\n\\ No newline at end of file\n",
            "actualSource": "    public void doPost(HttpServletRequest request,\n                      HttpServletResponse response)\n        throws IOException, ServletException {\n\n        // Identify the request parameters that we need\n        // By obtaining the command from the pathInfo, per-command security can\n        // be configured in web.xml\n        String command = request.getPathInfo();\n\n        String path = request.getParameter(\"path\");\n        String deployPath = request.getParameter(\"deployPath\");\n        String deployConfig = request.getParameter(\"deployConfig\");\n        String deployWar = request.getParameter(\"deployWar\");\n        String requestNonce = request.getParameter(NONCE_REQUEST);\n\n        // Prepare our output writer to generate the response message\n        response.setContentType(\"text/html; charset=\" + Constants.CHARSET);\n\n        String message = \"\";\n\n        // Check nonce\n        // There *must* be a nonce in the session before any POST is processed\n        HttpSession session = request.getSession();\n        String sessionNonce = (String) session.getAttribute(NONCE_SESSION);\n        if (sessionNonce == null) {\n            message = \"FAIL: No nonce found in session. Command [\" + command + \"] was ignored.\";\n            // Reset the command\n            command = null;\n        } else {\n            if (!sessionNonce.equals(requestNonce)) {\n                // Nonce mis-match.\n                message = \"FAIL: Nonce mismatch. Command [\" + command + \"] was ignored.\";\n                // Reset the command\n                command = null;\n            }\n        }\n        \n        if (command == null || command.length() == 0) {\n            // No command == list\n            // List always displayed -> do nothing\n        } else if (command.equals(\"/upload\")) {\n            message = upload(request);\n        } else if (command.equals(\"/deploy\")) {\n            message = deployInternal(deployConfig, deployPath, deployWar);\n        } else if (command.equals(\"/reload\")) {\n            message = reload(path);\n        } else if (command.equals(\"/undeploy\")) {\n            message = undeploy(path);\n        } else if (command.equals(\"/expire\")) {\n            message = expireSessions(path, request);\n        } else if (command.equals(\"/start\")) {\n            message = start(path);\n        } else if (command.equals(\"/stop\")) {\n            message = stop(path);\n        } else {\n            // Try GET\n            doGet(request,response);\n            return;\n        }\n\n        list(request, response, message);\n    }",
            "path": "java/org/apache/catalina/manager/HTMLManagerServlet.java",
            "extendedDetails": {},
            "BugCommit": "0",
            "TangledWMoveandFileRename": "2"
        },
        "99f01fd6ddbf1945e2bc5531e055b7d993c4c634": {
            "type": "Ybodychange",
            "commitMessage": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=40001\nUse POST rather than GET for all operations that are not idempotent\nPartly based on a patch suggested by Daniel Naber\nRemove the \"Are you sure?\", partly due to lack of i18n support and since as (based on my recollection) as many people disliked the feature as liked it.\nProvides a (very) small measure of CSRF protection but lays the foundation for using a nonce with POST.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@823962 13f79535-47bb-0310-9956-ffa450edef68\n",
            "commitDate": "10/10/09 4:54 PM",
            "commitName": "99f01fd6ddbf1945e2bc5531e055b7d993c4c634",
            "commitAuthor": "Mark Emlyn David Thomas",
            "commitDateOld": "10/10/09 1:16 PM",
            "commitNameOld": "e59b0dcf03e2dfdb5fdd79c8c29e93d53becdfeb",
            "commitAuthorOld": "Mark Emlyn David Thomas",
            "daysBetweenCommits": 0.15,
            "commitsBetweenForRepo": 1,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,21 +1,44 @@\n     public void doPost(HttpServletRequest request,\n                       HttpServletResponse response)\n         throws IOException, ServletException {\n \n         // Identify the request parameters that we need\n         // By obtaining the command from the pathInfo, per-command security can\n         // be configured in web.xml\n         String command = request.getPathInfo();\n \n-        if (command == null || !command.equals(\"/upload\")) {\n-            doGet(request,response);\n-            return;\n-        }\n+        String path = request.getParameter(\"path\");\n+        String deployPath = request.getParameter(\"deployPath\");\n+        String deployConfig = request.getParameter(\"deployConfig\");\n+        String deployWar = request.getParameter(\"deployWar\");\n \n         // Prepare our output writer to generate the response message\n         response.setContentType(\"text/html; charset=\" + Constants.CHARSET);\n \n-        String message = upload(request);\n+        String message = \"\";\n+\n+        if (command == null || command.length() == 0) {\n+            // No command == list\n+            // List always displayed -> do nothing\n+        } else if (command.equals(\"/upload\")) {\n+            message = upload(request);\n+        } else if (command.equals(\"/deploy\")) {\n+            message = deployInternal(deployConfig, deployPath, deployWar);\n+        } else if (command.equals(\"/reload\")) {\n+            message = reload(path);\n+        } else if (command.equals(\"/undeploy\")) {\n+            message = undeploy(path);\n+        } else if (command.equals(\"/expire\")) {\n+            message = expireSessions(path, request);\n+        } else if (command.equals(\"/start\")) {\n+            message = start(path);\n+        } else if (command.equals(\"/stop\")) {\n+            message = stop(path);\n+        } else {\n+            // Try GET\n+            doGet(request,response);\n+            return;\n+        }\n \n         list(request, response, message);\n     }\n\\ No newline at end of file\n",
            "actualSource": "    public void doPost(HttpServletRequest request,\n                      HttpServletResponse response)\n        throws IOException, ServletException {\n\n        // Identify the request parameters that we need\n        // By obtaining the command from the pathInfo, per-command security can\n        // be configured in web.xml\n        String command = request.getPathInfo();\n\n        String path = request.getParameter(\"path\");\n        String deployPath = request.getParameter(\"deployPath\");\n        String deployConfig = request.getParameter(\"deployConfig\");\n        String deployWar = request.getParameter(\"deployWar\");\n\n        // Prepare our output writer to generate the response message\n        response.setContentType(\"text/html; charset=\" + Constants.CHARSET);\n\n        String message = \"\";\n\n        if (command == null || command.length() == 0) {\n            // No command == list\n            // List always displayed -> do nothing\n        } else if (command.equals(\"/upload\")) {\n            message = upload(request);\n        } else if (command.equals(\"/deploy\")) {\n            message = deployInternal(deployConfig, deployPath, deployWar);\n        } else if (command.equals(\"/reload\")) {\n            message = reload(path);\n        } else if (command.equals(\"/undeploy\")) {\n            message = undeploy(path);\n        } else if (command.equals(\"/expire\")) {\n            message = expireSessions(path, request);\n        } else if (command.equals(\"/start\")) {\n            message = start(path);\n        } else if (command.equals(\"/stop\")) {\n            message = stop(path);\n        } else {\n            // Try GET\n            doGet(request,response);\n            return;\n        }\n\n        list(request, response, message);\n    }",
            "path": "java/org/apache/catalina/manager/HTMLManagerServlet.java",
            "extendedDetails": {},
            "BugCommit": "0",
            "TangledWMoveandFileRename": "2"
        },
        "e59b0dcf03e2dfdb5fdd79c8c29e93d53becdfeb": {
            "type": "Ybodychange",
            "commitMessage": "Refactor upload into its own method in preparation for moving some commands from GET to POST.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@823910 13f79535-47bb-0310-9956-ffa450edef68\n",
            "commitDate": "10/10/09 1:16 PM",
            "commitName": "e59b0dcf03e2dfdb5fdd79c8c29e93d53becdfeb",
            "commitAuthor": "Mark Emlyn David Thomas",
            "commitDateOld": "10/10/09 1:11 PM",
            "commitNameOld": "0681407981c65809956bf447b8822002b67381f0",
            "commitAuthorOld": "Mark Emlyn David Thomas",
            "daysBetweenCommits": 0.0,
            "commitsBetweenForRepo": 1,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,116 +1,21 @@\n     public void doPost(HttpServletRequest request,\n                       HttpServletResponse response)\n         throws IOException, ServletException {\n \n         // Identify the request parameters that we need\n         // By obtaining the command from the pathInfo, per-command security can\n         // be configured in web.xml\n         String command = request.getPathInfo();\n \n         if (command == null || !command.equals(\"/upload\")) {\n             doGet(request,response);\n             return;\n         }\n \n         // Prepare our output writer to generate the response message\n         response.setContentType(\"text/html; charset=\" + Constants.CHARSET);\n \n-        String message = \"\";\n-\n-        // Create a new file upload handler\n-        DiskFileUpload upload = new DiskFileUpload();\n-\n-        // Get the tempdir\n-        File tempdir = (File) getServletContext().getAttribute\n-            (ServletContext.TEMPDIR);\n-        // Set upload parameters\n-        upload.setSizeMax(-1);\n-        upload.setRepositoryPath(tempdir.getCanonicalPath());\n-    \n-        // Parse the request\n-        String basename = null;\n-        String war = null;\n-        FileItem warUpload = null;\n-        try {\n-            List<FileItem> items = upload.parseRequest(request);\n-        \n-            // Process the uploaded fields\n-            Iterator<FileItem> iter = items.iterator();\n-            while (iter.hasNext()) {\n-                FileItem item = iter.next();\n-        \n-                if (!item.isFormField()) {\n-                    if (item.getFieldName().equals(\"deployWar\") &&\n-                        warUpload == null) {\n-                        warUpload = item;\n-                    } else {\n-                        item.delete();\n-                    }\n-                }\n-            }\n-            while (true) {\n-                if (warUpload == null) {\n-                    message = sm.getString\n-                        (\"htmlManagerServlet.deployUploadNoFile\");\n-                    break;\n-                }\n-                war = warUpload.getName();\n-                if (!war.toLowerCase().endsWith(\".war\")) {\n-                    message = sm.getString\n-                        (\"htmlManagerServlet.deployUploadNotWar\",war);\n-                    break;\n-                }\n-                // Get the filename if uploaded name includes a path\n-                if (war.lastIndexOf('\\\\') >= 0) {\n-                    war = war.substring(war.lastIndexOf('\\\\') + 1);\n-                }\n-                if (war.lastIndexOf('/') >= 0) {\n-                    war = war.substring(war.lastIndexOf('/') + 1);\n-                }\n-                // Identify the appBase of the owning Host of this Context\n-                // (if any)\n-                basename = war.substring(0, war.toLowerCase().indexOf(\".war\"));\n-                File file = new File(getAppBase(), war);\n-                if (file.exists()) {\n-                    message = sm.getString\n-                        (\"htmlManagerServlet.deployUploadWarExists\",war);\n-                    break;\n-                }\n-                String path = null;\n-                if (basename.equals(\"ROOT\")) {\n-                    path = \"\";\n-                } else {\n-                    path = \"/\" + basename.replace('#', '/');\n-                }\n-\n-                if ((host.findChild(path) != null) && !isDeployed(path)) {\n-                    message = sm.getString\n-                        (\"htmlManagerServlet.deployUploadInServerXml\", war);\n-                    break;\n-                }\n-\n-                if (!isServiced(path)) {\n-                    addServiced(path);\n-                    try {\n-                        warUpload.write(file);\n-                        // Perform new deployment\n-                        check(path);\n-                    } finally {\n-                        removeServiced(path);\n-                    }\n-                }\n-                break;\n-            }\n-        } catch(Exception e) {\n-            message = sm.getString\n-                (\"htmlManagerServlet.deployUploadFail\", e.getMessage());\n-            log(message, e);\n-        } finally {\n-            if (warUpload != null) {\n-                warUpload.delete();\n-            }\n-            warUpload = null;\n-        }\n+        String message = upload(request);\n \n         list(request, response, message);\n     }\n\\ No newline at end of file\n",
            "actualSource": "    public void doPost(HttpServletRequest request,\n                      HttpServletResponse response)\n        throws IOException, ServletException {\n\n        // Identify the request parameters that we need\n        // By obtaining the command from the pathInfo, per-command security can\n        // be configured in web.xml\n        String command = request.getPathInfo();\n\n        if (command == null || !command.equals(\"/upload\")) {\n            doGet(request,response);\n            return;\n        }\n\n        // Prepare our output writer to generate the response message\n        response.setContentType(\"text/html; charset=\" + Constants.CHARSET);\n\n        String message = upload(request);\n\n        list(request, response, message);\n    }",
            "path": "java/org/apache/catalina/manager/HTMLManagerServlet.java",
            "extendedDetails": {},
            "BugCommit": "0",
            "TangledWMoveandFileRename": "2"
        },
        "0681407981c65809956bf447b8822002b67381f0": {
            "type": "Ybodychange",
            "commitMessage": "Fix the Eclipse warnings, add some additional comments.\nNo functional change.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@823908 13f79535-47bb-0310-9956-ffa450edef68\n",
            "commitDate": "10/10/09 1:11 PM",
            "commitName": "0681407981c65809956bf447b8822002b67381f0",
            "commitAuthor": "Mark Emlyn David Thomas",
            "commitDateOld": "29/09/09 7:01 PM",
            "commitNameOld": "69e506bd51d54368b1e78d2ce86a0398fc640147",
            "commitAuthorOld": "Konstantin Kolinko",
            "daysBetweenCommits": 10.76,
            "commitsBetweenForRepo": 19,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,114 +1,116 @@\n     public void doPost(HttpServletRequest request,\n                       HttpServletResponse response)\n         throws IOException, ServletException {\n \n         // Identify the request parameters that we need\n+        // By obtaining the command from the pathInfo, per-command security can\n+        // be configured in web.xml\n         String command = request.getPathInfo();\n \n         if (command == null || !command.equals(\"/upload\")) {\n             doGet(request,response);\n             return;\n         }\n \n         // Prepare our output writer to generate the response message\n         response.setContentType(\"text/html; charset=\" + Constants.CHARSET);\n \n         String message = \"\";\n \n         // Create a new file upload handler\n         DiskFileUpload upload = new DiskFileUpload();\n \n         // Get the tempdir\n         File tempdir = (File) getServletContext().getAttribute\n             (ServletContext.TEMPDIR);\n         // Set upload parameters\n         upload.setSizeMax(-1);\n         upload.setRepositoryPath(tempdir.getCanonicalPath());\n     \n         // Parse the request\n         String basename = null;\n         String war = null;\n         FileItem warUpload = null;\n         try {\n             List<FileItem> items = upload.parseRequest(request);\n         \n             // Process the uploaded fields\n             Iterator<FileItem> iter = items.iterator();\n             while (iter.hasNext()) {\n                 FileItem item = iter.next();\n         \n                 if (!item.isFormField()) {\n                     if (item.getFieldName().equals(\"deployWar\") &&\n                         warUpload == null) {\n                         warUpload = item;\n                     } else {\n                         item.delete();\n                     }\n                 }\n             }\n             while (true) {\n                 if (warUpload == null) {\n                     message = sm.getString\n                         (\"htmlManagerServlet.deployUploadNoFile\");\n                     break;\n                 }\n                 war = warUpload.getName();\n                 if (!war.toLowerCase().endsWith(\".war\")) {\n                     message = sm.getString\n                         (\"htmlManagerServlet.deployUploadNotWar\",war);\n                     break;\n                 }\n                 // Get the filename if uploaded name includes a path\n                 if (war.lastIndexOf('\\\\') >= 0) {\n                     war = war.substring(war.lastIndexOf('\\\\') + 1);\n                 }\n                 if (war.lastIndexOf('/') >= 0) {\n                     war = war.substring(war.lastIndexOf('/') + 1);\n                 }\n                 // Identify the appBase of the owning Host of this Context\n                 // (if any)\n                 basename = war.substring(0, war.toLowerCase().indexOf(\".war\"));\n                 File file = new File(getAppBase(), war);\n                 if (file.exists()) {\n                     message = sm.getString\n                         (\"htmlManagerServlet.deployUploadWarExists\",war);\n                     break;\n                 }\n                 String path = null;\n                 if (basename.equals(\"ROOT\")) {\n                     path = \"\";\n                 } else {\n                     path = \"/\" + basename.replace('#', '/');\n                 }\n \n                 if ((host.findChild(path) != null) && !isDeployed(path)) {\n                     message = sm.getString\n                         (\"htmlManagerServlet.deployUploadInServerXml\", war);\n                     break;\n                 }\n \n                 if (!isServiced(path)) {\n                     addServiced(path);\n                     try {\n                         warUpload.write(file);\n                         // Perform new deployment\n                         check(path);\n                     } finally {\n                         removeServiced(path);\n                     }\n                 }\n                 break;\n             }\n         } catch(Exception e) {\n             message = sm.getString\n                 (\"htmlManagerServlet.deployUploadFail\", e.getMessage());\n             log(message, e);\n         } finally {\n             if (warUpload != null) {\n                 warUpload.delete();\n             }\n             warUpload = null;\n         }\n \n         list(request, response, message);\n     }\n\\ No newline at end of file\n",
            "actualSource": "    public void doPost(HttpServletRequest request,\n                      HttpServletResponse response)\n        throws IOException, ServletException {\n\n        // Identify the request parameters that we need\n        // By obtaining the command from the pathInfo, per-command security can\n        // be configured in web.xml\n        String command = request.getPathInfo();\n\n        if (command == null || !command.equals(\"/upload\")) {\n            doGet(request,response);\n            return;\n        }\n\n        // Prepare our output writer to generate the response message\n        response.setContentType(\"text/html; charset=\" + Constants.CHARSET);\n\n        String message = \"\";\n\n        // Create a new file upload handler\n        DiskFileUpload upload = new DiskFileUpload();\n\n        // Get the tempdir\n        File tempdir = (File) getServletContext().getAttribute\n            (ServletContext.TEMPDIR);\n        // Set upload parameters\n        upload.setSizeMax(-1);\n        upload.setRepositoryPath(tempdir.getCanonicalPath());\n    \n        // Parse the request\n        String basename = null;\n        String war = null;\n        FileItem warUpload = null;\n        try {\n            List<FileItem> items = upload.parseRequest(request);\n        \n            // Process the uploaded fields\n            Iterator<FileItem> iter = items.iterator();\n            while (iter.hasNext()) {\n                FileItem item = iter.next();\n        \n                if (!item.isFormField()) {\n                    if (item.getFieldName().equals(\"deployWar\") &&\n                        warUpload == null) {\n                        warUpload = item;\n                    } else {\n                        item.delete();\n                    }\n                }\n            }\n            while (true) {\n                if (warUpload == null) {\n                    message = sm.getString\n                        (\"htmlManagerServlet.deployUploadNoFile\");\n                    break;\n                }\n                war = warUpload.getName();\n                if (!war.toLowerCase().endsWith(\".war\")) {\n                    message = sm.getString\n                        (\"htmlManagerServlet.deployUploadNotWar\",war);\n                    break;\n                }\n                // Get the filename if uploaded name includes a path\n                if (war.lastIndexOf('\\\\') >= 0) {\n                    war = war.substring(war.lastIndexOf('\\\\') + 1);\n                }\n                if (war.lastIndexOf('/') >= 0) {\n                    war = war.substring(war.lastIndexOf('/') + 1);\n                }\n                // Identify the appBase of the owning Host of this Context\n                // (if any)\n                basename = war.substring(0, war.toLowerCase().indexOf(\".war\"));\n                File file = new File(getAppBase(), war);\n                if (file.exists()) {\n                    message = sm.getString\n                        (\"htmlManagerServlet.deployUploadWarExists\",war);\n                    break;\n                }\n                String path = null;\n                if (basename.equals(\"ROOT\")) {\n                    path = \"\";\n                } else {\n                    path = \"/\" + basename.replace('#', '/');\n                }\n\n                if ((host.findChild(path) != null) && !isDeployed(path)) {\n                    message = sm.getString\n                        (\"htmlManagerServlet.deployUploadInServerXml\", war);\n                    break;\n                }\n\n                if (!isServiced(path)) {\n                    addServiced(path);\n                    try {\n                        warUpload.write(file);\n                        // Perform new deployment\n                        check(path);\n                    } finally {\n                        removeServiced(path);\n                    }\n                }\n                break;\n            }\n        } catch(Exception e) {\n            message = sm.getString\n                (\"htmlManagerServlet.deployUploadFail\", e.getMessage());\n            log(message, e);\n        } finally {\n            if (warUpload != null) {\n                warUpload.delete();\n            }\n            warUpload = null;\n        }\n\n        list(request, response, message);\n    }",
            "path": "java/org/apache/catalina/manager/HTMLManagerServlet.java",
            "extendedDetails": {},
            "BugCommit": "0",
            "TangledWMoveandFileRename": "4"
        },
        "87bc1e5ed9f0c6945c2da931a51b0f7d94dba341": {
            "type": "Ybodychange",
            "commitMessage": "The servletapi gives us a perfectly good constant for 'javax.servlet.context.tempdir'. Use it.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@786471 13f79535-47bb-0310-9956-ffa450edef68\n",
            "commitDate": "19/06/09 7:10 AM",
            "commitName": "87bc1e5ed9f0c6945c2da931a51b0f7d94dba341",
            "commitAuthor": "Mark Emlyn David Thomas",
            "commitDateOld": "27/12/08 7:39 AM",
            "commitNameOld": "2b6b1a887c0137eb52a5a2fed127112fb238885f",
            "commitAuthorOld": "Mark Emlyn David Thomas",
            "daysBetweenCommits": 173.94,
            "commitsBetweenForRepo": 453,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,114 +1,114 @@\n     public void doPost(HttpServletRequest request,\n                       HttpServletResponse response)\n         throws IOException, ServletException {\n \n         // Identify the request parameters that we need\n         String command = request.getPathInfo();\n \n         if (command == null || !command.equals(\"/upload\")) {\n             doGet(request,response);\n             return;\n         }\n \n         // Prepare our output writer to generate the response message\n         response.setContentType(\"text/html; charset=\" + Constants.CHARSET);\n \n         String message = \"\";\n \n         // Create a new file upload handler\n         DiskFileUpload upload = new DiskFileUpload();\n \n         // Get the tempdir\n         File tempdir = (File) getServletContext().getAttribute\n-            (\"javax.servlet.context.tempdir\");\n+            (ServletContext.TEMPDIR);\n         // Set upload parameters\n         upload.setSizeMax(-1);\n         upload.setRepositoryPath(tempdir.getCanonicalPath());\n     \n         // Parse the request\n         String basename = null;\n         String war = null;\n         FileItem warUpload = null;\n         try {\n             List<FileItem> items = upload.parseRequest(request);\n         \n             // Process the uploaded fields\n             Iterator<FileItem> iter = items.iterator();\n             while (iter.hasNext()) {\n                 FileItem item = iter.next();\n         \n                 if (!item.isFormField()) {\n                     if (item.getFieldName().equals(\"deployWar\") &&\n                         warUpload == null) {\n                         warUpload = item;\n                     } else {\n                         item.delete();\n                     }\n                 }\n             }\n             while (true) {\n                 if (warUpload == null) {\n                     message = sm.getString\n                         (\"htmlManagerServlet.deployUploadNoFile\");\n                     break;\n                 }\n                 war = warUpload.getName();\n                 if (!war.toLowerCase().endsWith(\".war\")) {\n                     message = sm.getString\n                         (\"htmlManagerServlet.deployUploadNotWar\",war);\n                     break;\n                 }\n                 // Get the filename if uploaded name includes a path\n                 if (war.lastIndexOf('\\\\') >= 0) {\n                     war = war.substring(war.lastIndexOf('\\\\') + 1);\n                 }\n                 if (war.lastIndexOf('/') >= 0) {\n                     war = war.substring(war.lastIndexOf('/') + 1);\n                 }\n                 // Identify the appBase of the owning Host of this Context\n                 // (if any)\n                 basename = war.substring(0, war.toLowerCase().indexOf(\".war\"));\n                 File file = new File(getAppBase(), war);\n                 if (file.exists()) {\n                     message = sm.getString\n                         (\"htmlManagerServlet.deployUploadWarExists\",war);\n                     break;\n                 }\n                 String path = null;\n                 if (basename.equals(\"ROOT\")) {\n                     path = \"\";\n                 } else {\n                     path = \"/\" + basename.replace('#', '/');\n                 }\n \n                 if ((host.findChild(path) != null) && !isDeployed(path)) {\n                     message = sm.getString\n                         (\"htmlManagerServlet.deployUploadInServerXml\", war);\n                     break;\n                 }\n \n                 if (!isServiced(path)) {\n                     addServiced(path);\n                     try {\n                         warUpload.write(file);\n                         // Perform new deployment\n                         check(path);\n                     } finally {\n                         removeServiced(path);\n                     }\n                 }\n                 break;\n             }\n         } catch(Exception e) {\n             message = sm.getString\n                 (\"htmlManagerServlet.deployUploadFail\", e.getMessage());\n             log(message, e);\n         } finally {\n             if (warUpload != null) {\n                 warUpload.delete();\n             }\n             warUpload = null;\n         }\n \n         list(request, response, message);\n     }\n\\ No newline at end of file\n",
            "actualSource": "    public void doPost(HttpServletRequest request,\n                      HttpServletResponse response)\n        throws IOException, ServletException {\n\n        // Identify the request parameters that we need\n        String command = request.getPathInfo();\n\n        if (command == null || !command.equals(\"/upload\")) {\n            doGet(request,response);\n            return;\n        }\n\n        // Prepare our output writer to generate the response message\n        response.setContentType(\"text/html; charset=\" + Constants.CHARSET);\n\n        String message = \"\";\n\n        // Create a new file upload handler\n        DiskFileUpload upload = new DiskFileUpload();\n\n        // Get the tempdir\n        File tempdir = (File) getServletContext().getAttribute\n            (ServletContext.TEMPDIR);\n        // Set upload parameters\n        upload.setSizeMax(-1);\n        upload.setRepositoryPath(tempdir.getCanonicalPath());\n    \n        // Parse the request\n        String basename = null;\n        String war = null;\n        FileItem warUpload = null;\n        try {\n            List<FileItem> items = upload.parseRequest(request);\n        \n            // Process the uploaded fields\n            Iterator<FileItem> iter = items.iterator();\n            while (iter.hasNext()) {\n                FileItem item = iter.next();\n        \n                if (!item.isFormField()) {\n                    if (item.getFieldName().equals(\"deployWar\") &&\n                        warUpload == null) {\n                        warUpload = item;\n                    } else {\n                        item.delete();\n                    }\n                }\n            }\n            while (true) {\n                if (warUpload == null) {\n                    message = sm.getString\n                        (\"htmlManagerServlet.deployUploadNoFile\");\n                    break;\n                }\n                war = warUpload.getName();\n                if (!war.toLowerCase().endsWith(\".war\")) {\n                    message = sm.getString\n                        (\"htmlManagerServlet.deployUploadNotWar\",war);\n                    break;\n                }\n                // Get the filename if uploaded name includes a path\n                if (war.lastIndexOf('\\\\') >= 0) {\n                    war = war.substring(war.lastIndexOf('\\\\') + 1);\n                }\n                if (war.lastIndexOf('/') >= 0) {\n                    war = war.substring(war.lastIndexOf('/') + 1);\n                }\n                // Identify the appBase of the owning Host of this Context\n                // (if any)\n                basename = war.substring(0, war.toLowerCase().indexOf(\".war\"));\n                File file = new File(getAppBase(), war);\n                if (file.exists()) {\n                    message = sm.getString\n                        (\"htmlManagerServlet.deployUploadWarExists\",war);\n                    break;\n                }\n                String path = null;\n                if (basename.equals(\"ROOT\")) {\n                    path = \"\";\n                } else {\n                    path = \"/\" + basename.replace('#', '/');\n                }\n\n                if ((host.findChild(path) != null) && !isDeployed(path)) {\n                    message = sm.getString\n                        (\"htmlManagerServlet.deployUploadInServerXml\", war);\n                    break;\n                }\n\n                if (!isServiced(path)) {\n                    addServiced(path);\n                    try {\n                        warUpload.write(file);\n                        // Perform new deployment\n                        check(path);\n                    } finally {\n                        removeServiced(path);\n                    }\n                }\n                break;\n            }\n        } catch(Exception e) {\n            message = sm.getString\n                (\"htmlManagerServlet.deployUploadFail\", e.getMessage());\n            log(message, e);\n        } finally {\n            if (warUpload != null) {\n                warUpload.delete();\n            }\n            warUpload = null;\n        }\n\n        list(request, response, message);\n    }",
            "path": "java/org/apache/catalina/manager/HTMLManagerServlet.java",
            "extendedDetails": {},
            "BugCommit": "0",
            "TangledWMoveandFileRename": "5"
        },
        "2b6b1a887c0137eb52a5a2fed127112fb238885f": {
            "type": "Ybodychange",
            "commitMessage": "Generics for o.a.c.manager\nFix various Eclipse warnings (unused code, etc)\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@729633 13f79535-47bb-0310-9956-ffa450edef68\n",
            "commitDate": "27/12/08 7:39 AM",
            "commitName": "2b6b1a887c0137eb52a5a2fed127112fb238885f",
            "commitAuthor": "Mark Emlyn David Thomas",
            "commitDateOld": "26/12/08 5:50 PM",
            "commitNameOld": "85fc30c1bfa5869971ca7513248c4bc67e1f33e4",
            "commitAuthorOld": "Mark Emlyn David Thomas",
            "daysBetweenCommits": 0.58,
            "commitsBetweenForRepo": 2,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,114 +1,114 @@\n     public void doPost(HttpServletRequest request,\n                       HttpServletResponse response)\n         throws IOException, ServletException {\n \n         // Identify the request parameters that we need\n         String command = request.getPathInfo();\n \n         if (command == null || !command.equals(\"/upload\")) {\n             doGet(request,response);\n             return;\n         }\n \n         // Prepare our output writer to generate the response message\n         response.setContentType(\"text/html; charset=\" + Constants.CHARSET);\n \n         String message = \"\";\n \n         // Create a new file upload handler\n         DiskFileUpload upload = new DiskFileUpload();\n \n         // Get the tempdir\n         File tempdir = (File) getServletContext().getAttribute\n             (\"javax.servlet.context.tempdir\");\n         // Set upload parameters\n         upload.setSizeMax(-1);\n         upload.setRepositoryPath(tempdir.getCanonicalPath());\n     \n         // Parse the request\n         String basename = null;\n         String war = null;\n         FileItem warUpload = null;\n         try {\n-            List items = upload.parseRequest(request);\n+            List<FileItem> items = upload.parseRequest(request);\n         \n             // Process the uploaded fields\n-            Iterator iter = items.iterator();\n+            Iterator<FileItem> iter = items.iterator();\n             while (iter.hasNext()) {\n-                FileItem item = (FileItem) iter.next();\n+                FileItem item = iter.next();\n         \n                 if (!item.isFormField()) {\n                     if (item.getFieldName().equals(\"deployWar\") &&\n                         warUpload == null) {\n                         warUpload = item;\n                     } else {\n                         item.delete();\n                     }\n                 }\n             }\n             while (true) {\n                 if (warUpload == null) {\n                     message = sm.getString\n                         (\"htmlManagerServlet.deployUploadNoFile\");\n                     break;\n                 }\n                 war = warUpload.getName();\n                 if (!war.toLowerCase().endsWith(\".war\")) {\n                     message = sm.getString\n                         (\"htmlManagerServlet.deployUploadNotWar\",war);\n                     break;\n                 }\n                 // Get the filename if uploaded name includes a path\n                 if (war.lastIndexOf('\\\\') >= 0) {\n                     war = war.substring(war.lastIndexOf('\\\\') + 1);\n                 }\n                 if (war.lastIndexOf('/') >= 0) {\n                     war = war.substring(war.lastIndexOf('/') + 1);\n                 }\n                 // Identify the appBase of the owning Host of this Context\n                 // (if any)\n                 basename = war.substring(0, war.toLowerCase().indexOf(\".war\"));\n                 File file = new File(getAppBase(), war);\n                 if (file.exists()) {\n                     message = sm.getString\n                         (\"htmlManagerServlet.deployUploadWarExists\",war);\n                     break;\n                 }\n                 String path = null;\n                 if (basename.equals(\"ROOT\")) {\n                     path = \"\";\n                 } else {\n                     path = \"/\" + basename.replace('#', '/');\n                 }\n \n                 if ((host.findChild(path) != null) && !isDeployed(path)) {\n                     message = sm.getString\n                         (\"htmlManagerServlet.deployUploadInServerXml\", war);\n                     break;\n                 }\n \n                 if (!isServiced(path)) {\n                     addServiced(path);\n                     try {\n                         warUpload.write(file);\n                         // Perform new deployment\n                         check(path);\n                     } finally {\n                         removeServiced(path);\n                     }\n                 }\n                 break;\n             }\n         } catch(Exception e) {\n             message = sm.getString\n                 (\"htmlManagerServlet.deployUploadFail\", e.getMessage());\n             log(message, e);\n         } finally {\n             if (warUpload != null) {\n                 warUpload.delete();\n             }\n             warUpload = null;\n         }\n \n         list(request, response, message);\n     }\n\\ No newline at end of file\n",
            "actualSource": "    public void doPost(HttpServletRequest request,\n                      HttpServletResponse response)\n        throws IOException, ServletException {\n\n        // Identify the request parameters that we need\n        String command = request.getPathInfo();\n\n        if (command == null || !command.equals(\"/upload\")) {\n            doGet(request,response);\n            return;\n        }\n\n        // Prepare our output writer to generate the response message\n        response.setContentType(\"text/html; charset=\" + Constants.CHARSET);\n\n        String message = \"\";\n\n        // Create a new file upload handler\n        DiskFileUpload upload = new DiskFileUpload();\n\n        // Get the tempdir\n        File tempdir = (File) getServletContext().getAttribute\n            (\"javax.servlet.context.tempdir\");\n        // Set upload parameters\n        upload.setSizeMax(-1);\n        upload.setRepositoryPath(tempdir.getCanonicalPath());\n    \n        // Parse the request\n        String basename = null;\n        String war = null;\n        FileItem warUpload = null;\n        try {\n            List<FileItem> items = upload.parseRequest(request);\n        \n            // Process the uploaded fields\n            Iterator<FileItem> iter = items.iterator();\n            while (iter.hasNext()) {\n                FileItem item = iter.next();\n        \n                if (!item.isFormField()) {\n                    if (item.getFieldName().equals(\"deployWar\") &&\n                        warUpload == null) {\n                        warUpload = item;\n                    } else {\n                        item.delete();\n                    }\n                }\n            }\n            while (true) {\n                if (warUpload == null) {\n                    message = sm.getString\n                        (\"htmlManagerServlet.deployUploadNoFile\");\n                    break;\n                }\n                war = warUpload.getName();\n                if (!war.toLowerCase().endsWith(\".war\")) {\n                    message = sm.getString\n                        (\"htmlManagerServlet.deployUploadNotWar\",war);\n                    break;\n                }\n                // Get the filename if uploaded name includes a path\n                if (war.lastIndexOf('\\\\') >= 0) {\n                    war = war.substring(war.lastIndexOf('\\\\') + 1);\n                }\n                if (war.lastIndexOf('/') >= 0) {\n                    war = war.substring(war.lastIndexOf('/') + 1);\n                }\n                // Identify the appBase of the owning Host of this Context\n                // (if any)\n                basename = war.substring(0, war.toLowerCase().indexOf(\".war\"));\n                File file = new File(getAppBase(), war);\n                if (file.exists()) {\n                    message = sm.getString\n                        (\"htmlManagerServlet.deployUploadWarExists\",war);\n                    break;\n                }\n                String path = null;\n                if (basename.equals(\"ROOT\")) {\n                    path = \"\";\n                } else {\n                    path = \"/\" + basename.replace('#', '/');\n                }\n\n                if ((host.findChild(path) != null) && !isDeployed(path)) {\n                    message = sm.getString\n                        (\"htmlManagerServlet.deployUploadInServerXml\", war);\n                    break;\n                }\n\n                if (!isServiced(path)) {\n                    addServiced(path);\n                    try {\n                        warUpload.write(file);\n                        // Perform new deployment\n                        check(path);\n                    } finally {\n                        removeServiced(path);\n                    }\n                }\n                break;\n            }\n        } catch(Exception e) {\n            message = sm.getString\n                (\"htmlManagerServlet.deployUploadFail\", e.getMessage());\n            log(message, e);\n        } finally {\n            if (warUpload != null) {\n                warUpload.delete();\n            }\n            warUpload = null;\n        }\n\n        list(request, response, message);\n    }",
            "path": "java/org/apache/catalina/manager/HTMLManagerServlet.java",
            "extendedDetails": {},
            "BugCommit": "0",
            "TangledWMoveandFileRename": "14"
        },
        "7125c9fc203b683374220322159e451c2c418cef": {
            "type": "Ybodychange",
            "commitMessage": "Fix bugs https://issues.apache.org/bugzilla/show_bug.cgi?id=43013 and https://issues.apache.org/bugzilla/show_bug.cgi?id=44021\nAdd support to manger and deployer for wars and dirs that use # to denote multi-level contexts.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@653549 13f79535-47bb-0310-9956-ffa450edef68\n",
            "commitDate": "05/05/08 1:18 PM",
            "commitName": "7125c9fc203b683374220322159e451c2c418cef",
            "commitAuthor": "Mark Emlyn David Thomas",
            "commitDateOld": "16/01/08 5:42 PM",
            "commitNameOld": "8d61a5089e4956bcdd32e9ad3c7e8ed8c70fd325",
            "commitAuthorOld": "Mark Emlyn David Thomas",
            "daysBetweenCommits": 109.77,
            "commitsBetweenForRepo": 186,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,114 +1,114 @@\n     public void doPost(HttpServletRequest request,\n                       HttpServletResponse response)\n         throws IOException, ServletException {\n \n         // Identify the request parameters that we need\n         String command = request.getPathInfo();\n \n         if (command == null || !command.equals(\"/upload\")) {\n             doGet(request,response);\n             return;\n         }\n \n         // Prepare our output writer to generate the response message\n         response.setContentType(\"text/html; charset=\" + Constants.CHARSET);\n \n         String message = \"\";\n \n         // Create a new file upload handler\n         DiskFileUpload upload = new DiskFileUpload();\n \n         // Get the tempdir\n         File tempdir = (File) getServletContext().getAttribute\n             (\"javax.servlet.context.tempdir\");\n         // Set upload parameters\n         upload.setSizeMax(-1);\n         upload.setRepositoryPath(tempdir.getCanonicalPath());\n     \n         // Parse the request\n         String basename = null;\n         String war = null;\n         FileItem warUpload = null;\n         try {\n             List items = upload.parseRequest(request);\n         \n             // Process the uploaded fields\n             Iterator iter = items.iterator();\n             while (iter.hasNext()) {\n                 FileItem item = (FileItem) iter.next();\n         \n                 if (!item.isFormField()) {\n                     if (item.getFieldName().equals(\"deployWar\") &&\n                         warUpload == null) {\n                         warUpload = item;\n                     } else {\n                         item.delete();\n                     }\n                 }\n             }\n             while (true) {\n                 if (warUpload == null) {\n                     message = sm.getString\n                         (\"htmlManagerServlet.deployUploadNoFile\");\n                     break;\n                 }\n                 war = warUpload.getName();\n                 if (!war.toLowerCase().endsWith(\".war\")) {\n                     message = sm.getString\n                         (\"htmlManagerServlet.deployUploadNotWar\",war);\n                     break;\n                 }\n                 // Get the filename if uploaded name includes a path\n                 if (war.lastIndexOf('\\\\') >= 0) {\n                     war = war.substring(war.lastIndexOf('\\\\') + 1);\n                 }\n                 if (war.lastIndexOf('/') >= 0) {\n                     war = war.substring(war.lastIndexOf('/') + 1);\n                 }\n                 // Identify the appBase of the owning Host of this Context\n                 // (if any)\n                 basename = war.substring(0, war.toLowerCase().indexOf(\".war\"));\n                 File file = new File(getAppBase(), war);\n                 if (file.exists()) {\n                     message = sm.getString\n                         (\"htmlManagerServlet.deployUploadWarExists\",war);\n                     break;\n                 }\n                 String path = null;\n                 if (basename.equals(\"ROOT\")) {\n                     path = \"\";\n                 } else {\n-                    path = \"/\" + basename;\n+                    path = \"/\" + basename.replace('#', '/');\n                 }\n \n                 if ((host.findChild(path) != null) && !isDeployed(path)) {\n                     message = sm.getString\n                         (\"htmlManagerServlet.deployUploadInServerXml\", war);\n                     break;\n                 }\n \n                 if (!isServiced(path)) {\n                     addServiced(path);\n                     try {\n                         warUpload.write(file);\n                         // Perform new deployment\n                         check(path);\n                     } finally {\n                         removeServiced(path);\n                     }\n                 }\n                 break;\n             }\n         } catch(Exception e) {\n             message = sm.getString\n                 (\"htmlManagerServlet.deployUploadFail\", e.getMessage());\n             log(message, e);\n         } finally {\n             if (warUpload != null) {\n                 warUpload.delete();\n             }\n             warUpload = null;\n         }\n \n         list(request, response, message);\n     }\n\\ No newline at end of file\n",
            "actualSource": "    public void doPost(HttpServletRequest request,\n                      HttpServletResponse response)\n        throws IOException, ServletException {\n\n        // Identify the request parameters that we need\n        String command = request.getPathInfo();\n\n        if (command == null || !command.equals(\"/upload\")) {\n            doGet(request,response);\n            return;\n        }\n\n        // Prepare our output writer to generate the response message\n        response.setContentType(\"text/html; charset=\" + Constants.CHARSET);\n\n        String message = \"\";\n\n        // Create a new file upload handler\n        DiskFileUpload upload = new DiskFileUpload();\n\n        // Get the tempdir\n        File tempdir = (File) getServletContext().getAttribute\n            (\"javax.servlet.context.tempdir\");\n        // Set upload parameters\n        upload.setSizeMax(-1);\n        upload.setRepositoryPath(tempdir.getCanonicalPath());\n    \n        // Parse the request\n        String basename = null;\n        String war = null;\n        FileItem warUpload = null;\n        try {\n            List items = upload.parseRequest(request);\n        \n            // Process the uploaded fields\n            Iterator iter = items.iterator();\n            while (iter.hasNext()) {\n                FileItem item = (FileItem) iter.next();\n        \n                if (!item.isFormField()) {\n                    if (item.getFieldName().equals(\"deployWar\") &&\n                        warUpload == null) {\n                        warUpload = item;\n                    } else {\n                        item.delete();\n                    }\n                }\n            }\n            while (true) {\n                if (warUpload == null) {\n                    message = sm.getString\n                        (\"htmlManagerServlet.deployUploadNoFile\");\n                    break;\n                }\n                war = warUpload.getName();\n                if (!war.toLowerCase().endsWith(\".war\")) {\n                    message = sm.getString\n                        (\"htmlManagerServlet.deployUploadNotWar\",war);\n                    break;\n                }\n                // Get the filename if uploaded name includes a path\n                if (war.lastIndexOf('\\\\') >= 0) {\n                    war = war.substring(war.lastIndexOf('\\\\') + 1);\n                }\n                if (war.lastIndexOf('/') >= 0) {\n                    war = war.substring(war.lastIndexOf('/') + 1);\n                }\n                // Identify the appBase of the owning Host of this Context\n                // (if any)\n                basename = war.substring(0, war.toLowerCase().indexOf(\".war\"));\n                File file = new File(getAppBase(), war);\n                if (file.exists()) {\n                    message = sm.getString\n                        (\"htmlManagerServlet.deployUploadWarExists\",war);\n                    break;\n                }\n                String path = null;\n                if (basename.equals(\"ROOT\")) {\n                    path = \"\";\n                } else {\n                    path = \"/\" + basename.replace('#', '/');\n                }\n\n                if ((host.findChild(path) != null) && !isDeployed(path)) {\n                    message = sm.getString\n                        (\"htmlManagerServlet.deployUploadInServerXml\", war);\n                    break;\n                }\n\n                if (!isServiced(path)) {\n                    addServiced(path);\n                    try {\n                        warUpload.write(file);\n                        // Perform new deployment\n                        check(path);\n                    } finally {\n                        removeServiced(path);\n                    }\n                }\n                break;\n            }\n        } catch(Exception e) {\n            message = sm.getString\n                (\"htmlManagerServlet.deployUploadFail\", e.getMessage());\n            log(message, e);\n        } finally {\n            if (warUpload != null) {\n                warUpload.delete();\n            }\n            warUpload = null;\n        }\n\n        list(request, response, message);\n    }",
            "path": "java/org/apache/catalina/manager/HTMLManagerServlet.java",
            "extendedDetails": {},
            "BugCommit": "1",
            "TangledWMoveandFileRename": "1"
        },
        "ffbbe88537b26444a4ac1396c19b13647b775a3d": {
            "type": "Ybodychange",
            "commitMessage": "Fix bug 43611. Provide an error message if user tries to upload a war for a context defined in server.xml rather than failing silently.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@600177 13f79535-47bb-0310-9956-ffa450edef68\n",
            "commitDate": "01/12/07 12:26 PM",
            "commitName": "ffbbe88537b26444a4ac1396c19b13647b775a3d",
            "commitAuthor": "Mark Emlyn David Thomas",
            "commitDateOld": "13/06/07 8:55 PM",
            "commitNameOld": "1bc3bcb2848f478fd6674487d6dad507fd5dd686",
            "commitAuthorOld": "Mark Emlyn David Thomas",
            "daysBetweenCommits": 170.69,
            "commitsBetweenForRepo": 343,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,108 +1,114 @@\n     public void doPost(HttpServletRequest request,\n                       HttpServletResponse response)\n         throws IOException, ServletException {\n \n         // Identify the request parameters that we need\n         String command = request.getPathInfo();\n \n         if (command == null || !command.equals(\"/upload\")) {\n             doGet(request,response);\n             return;\n         }\n \n         // Prepare our output writer to generate the response message\n         response.setContentType(\"text/html; charset=\" + Constants.CHARSET);\n \n         String message = \"\";\n \n         // Create a new file upload handler\n         DiskFileUpload upload = new DiskFileUpload();\n \n         // Get the tempdir\n         File tempdir = (File) getServletContext().getAttribute\n             (\"javax.servlet.context.tempdir\");\n         // Set upload parameters\n         upload.setSizeMax(-1);\n         upload.setRepositoryPath(tempdir.getCanonicalPath());\n     \n         // Parse the request\n         String basename = null;\n         String war = null;\n         FileItem warUpload = null;\n         try {\n             List items = upload.parseRequest(request);\n         \n             // Process the uploaded fields\n             Iterator iter = items.iterator();\n             while (iter.hasNext()) {\n                 FileItem item = (FileItem) iter.next();\n         \n                 if (!item.isFormField()) {\n                     if (item.getFieldName().equals(\"deployWar\") &&\n                         warUpload == null) {\n                         warUpload = item;\n                     } else {\n                         item.delete();\n                     }\n                 }\n             }\n             while (true) {\n                 if (warUpload == null) {\n                     message = sm.getString\n                         (\"htmlManagerServlet.deployUploadNoFile\");\n                     break;\n                 }\n                 war = warUpload.getName();\n                 if (!war.toLowerCase().endsWith(\".war\")) {\n                     message = sm.getString\n                         (\"htmlManagerServlet.deployUploadNotWar\",war);\n                     break;\n                 }\n                 // Get the filename if uploaded name includes a path\n                 if (war.lastIndexOf('\\\\') >= 0) {\n                     war = war.substring(war.lastIndexOf('\\\\') + 1);\n                 }\n                 if (war.lastIndexOf('/') >= 0) {\n                     war = war.substring(war.lastIndexOf('/') + 1);\n                 }\n                 // Identify the appBase of the owning Host of this Context\n                 // (if any)\n                 basename = war.substring(0, war.toLowerCase().indexOf(\".war\"));\n                 File file = new File(getAppBase(), war);\n                 if (file.exists()) {\n                     message = sm.getString\n                         (\"htmlManagerServlet.deployUploadWarExists\",war);\n                     break;\n                 }\n                 String path = null;\n                 if (basename.equals(\"ROOT\")) {\n                     path = \"\";\n                 } else {\n                     path = \"/\" + basename;\n                 }\n \n+                if ((host.findChild(path) != null) && !isDeployed(path)) {\n+                    message = sm.getString\n+                        (\"htmlManagerServlet.deployUploadInServerXml\", war);\n+                    break;\n+                }\n+\n                 if (!isServiced(path)) {\n                     addServiced(path);\n                     try {\n                         warUpload.write(file);\n                         // Perform new deployment\n                         check(path);\n                     } finally {\n                         removeServiced(path);\n                     }\n                 }\n                 break;\n             }\n         } catch(Exception e) {\n             message = sm.getString\n                 (\"htmlManagerServlet.deployUploadFail\", e.getMessage());\n             log(message, e);\n         } finally {\n             if (warUpload != null) {\n                 warUpload.delete();\n             }\n             warUpload = null;\n         }\n \n         list(request, response, message);\n     }\n\\ No newline at end of file\n",
            "actualSource": "    public void doPost(HttpServletRequest request,\n                      HttpServletResponse response)\n        throws IOException, ServletException {\n\n        // Identify the request parameters that we need\n        String command = request.getPathInfo();\n\n        if (command == null || !command.equals(\"/upload\")) {\n            doGet(request,response);\n            return;\n        }\n\n        // Prepare our output writer to generate the response message\n        response.setContentType(\"text/html; charset=\" + Constants.CHARSET);\n\n        String message = \"\";\n\n        // Create a new file upload handler\n        DiskFileUpload upload = new DiskFileUpload();\n\n        // Get the tempdir\n        File tempdir = (File) getServletContext().getAttribute\n            (\"javax.servlet.context.tempdir\");\n        // Set upload parameters\n        upload.setSizeMax(-1);\n        upload.setRepositoryPath(tempdir.getCanonicalPath());\n    \n        // Parse the request\n        String basename = null;\n        String war = null;\n        FileItem warUpload = null;\n        try {\n            List items = upload.parseRequest(request);\n        \n            // Process the uploaded fields\n            Iterator iter = items.iterator();\n            while (iter.hasNext()) {\n                FileItem item = (FileItem) iter.next();\n        \n                if (!item.isFormField()) {\n                    if (item.getFieldName().equals(\"deployWar\") &&\n                        warUpload == null) {\n                        warUpload = item;\n                    } else {\n                        item.delete();\n                    }\n                }\n            }\n            while (true) {\n                if (warUpload == null) {\n                    message = sm.getString\n                        (\"htmlManagerServlet.deployUploadNoFile\");\n                    break;\n                }\n                war = warUpload.getName();\n                if (!war.toLowerCase().endsWith(\".war\")) {\n                    message = sm.getString\n                        (\"htmlManagerServlet.deployUploadNotWar\",war);\n                    break;\n                }\n                // Get the filename if uploaded name includes a path\n                if (war.lastIndexOf('\\\\') >= 0) {\n                    war = war.substring(war.lastIndexOf('\\\\') + 1);\n                }\n                if (war.lastIndexOf('/') >= 0) {\n                    war = war.substring(war.lastIndexOf('/') + 1);\n                }\n                // Identify the appBase of the owning Host of this Context\n                // (if any)\n                basename = war.substring(0, war.toLowerCase().indexOf(\".war\"));\n                File file = new File(getAppBase(), war);\n                if (file.exists()) {\n                    message = sm.getString\n                        (\"htmlManagerServlet.deployUploadWarExists\",war);\n                    break;\n                }\n                String path = null;\n                if (basename.equals(\"ROOT\")) {\n                    path = \"\";\n                } else {\n                    path = \"/\" + basename;\n                }\n\n                if ((host.findChild(path) != null) && !isDeployed(path)) {\n                    message = sm.getString\n                        (\"htmlManagerServlet.deployUploadInServerXml\", war);\n                    break;\n                }\n\n                if (!isServiced(path)) {\n                    addServiced(path);\n                    try {\n                        warUpload.write(file);\n                        // Perform new deployment\n                        check(path);\n                    } finally {\n                        removeServiced(path);\n                    }\n                }\n                break;\n            }\n        } catch(Exception e) {\n            message = sm.getString\n                (\"htmlManagerServlet.deployUploadFail\", e.getMessage());\n            log(message, e);\n        } finally {\n            if (warUpload != null) {\n                warUpload.delete();\n            }\n            warUpload = null;\n        }\n\n        list(request, response, message);\n    }",
            "path": "java/org/apache/catalina/manager/HTMLManagerServlet.java",
            "extendedDetails": {},
            "BugCommit": "1",
            "TangledWMoveandFileRename": "1"
        },
        "f1911d8c5f0dc3774fe731ae27d4a9a9b39197c3": {
            "type": "Yintroduced",
            "commitMessage": "- Add the manager classes and a package renamed fileupload.\n- I think there should be basic multipart handling in the core, although maybe the manager doesn't\n  belong here (so I would remove it later on).\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc6.0.x/trunk@412780 13f79535-47bb-0310-9956-ffa450edef68\n",
            "commitDate": "08/06/06 10:35 AM",
            "commitName": "f1911d8c5f0dc3774fe731ae27d4a9a9b39197c3",
            "commitAuthor": "Remy Maucherat",
            "diff": "@@ -0,0 +1,108 @@\n+    public void doPost(HttpServletRequest request,\n+                      HttpServletResponse response)\n+        throws IOException, ServletException {\n+\n+        // Identify the request parameters that we need\n+        String command = request.getPathInfo();\n+\n+        if (command == null || !command.equals(\"/upload\")) {\n+            doGet(request,response);\n+            return;\n+        }\n+\n+        // Prepare our output writer to generate the response message\n+        response.setContentType(\"text/html; charset=\" + Constants.CHARSET);\n+\n+        String message = \"\";\n+\n+        // Create a new file upload handler\n+        DiskFileUpload upload = new DiskFileUpload();\n+\n+        // Get the tempdir\n+        File tempdir = (File) getServletContext().getAttribute\n+            (\"javax.servlet.context.tempdir\");\n+        // Set upload parameters\n+        upload.setSizeMax(-1);\n+        upload.setRepositoryPath(tempdir.getCanonicalPath());\n+    \n+        // Parse the request\n+        String basename = null;\n+        String war = null;\n+        FileItem warUpload = null;\n+        try {\n+            List items = upload.parseRequest(request);\n+        \n+            // Process the uploaded fields\n+            Iterator iter = items.iterator();\n+            while (iter.hasNext()) {\n+                FileItem item = (FileItem) iter.next();\n+        \n+                if (!item.isFormField()) {\n+                    if (item.getFieldName().equals(\"deployWar\") &&\n+                        warUpload == null) {\n+                        warUpload = item;\n+                    } else {\n+                        item.delete();\n+                    }\n+                }\n+            }\n+            while (true) {\n+                if (warUpload == null) {\n+                    message = sm.getString\n+                        (\"htmlManagerServlet.deployUploadNoFile\");\n+                    break;\n+                }\n+                war = warUpload.getName();\n+                if (!war.toLowerCase().endsWith(\".war\")) {\n+                    message = sm.getString\n+                        (\"htmlManagerServlet.deployUploadNotWar\",war);\n+                    break;\n+                }\n+                // Get the filename if uploaded name includes a path\n+                if (war.lastIndexOf('\\\\') >= 0) {\n+                    war = war.substring(war.lastIndexOf('\\\\') + 1);\n+                }\n+                if (war.lastIndexOf('/') >= 0) {\n+                    war = war.substring(war.lastIndexOf('/') + 1);\n+                }\n+                // Identify the appBase of the owning Host of this Context\n+                // (if any)\n+                basename = war.substring(0, war.toLowerCase().indexOf(\".war\"));\n+                File file = new File(getAppBase(), war);\n+                if (file.exists()) {\n+                    message = sm.getString\n+                        (\"htmlManagerServlet.deployUploadWarExists\",war);\n+                    break;\n+                }\n+                String path = null;\n+                if (basename.equals(\"ROOT\")) {\n+                    path = \"\";\n+                } else {\n+                    path = \"/\" + basename;\n+                }\n+\n+                if (!isServiced(path)) {\n+                    addServiced(path);\n+                    try {\n+                        warUpload.write(file);\n+                        // Perform new deployment\n+                        check(path);\n+                    } finally {\n+                        removeServiced(path);\n+                    }\n+                }\n+                break;\n+            }\n+        } catch(Exception e) {\n+            message = sm.getString\n+                (\"htmlManagerServlet.deployUploadFail\", e.getMessage());\n+            log(message, e);\n+        } finally {\n+            if (warUpload != null) {\n+                warUpload.delete();\n+            }\n+            warUpload = null;\n+        }\n+\n+        list(request, response, message);\n+    }\n\\ No newline at end of file\n",
            "actualSource": "    public void doPost(HttpServletRequest request,\n                      HttpServletResponse response)\n        throws IOException, ServletException {\n\n        // Identify the request parameters that we need\n        String command = request.getPathInfo();\n\n        if (command == null || !command.equals(\"/upload\")) {\n            doGet(request,response);\n            return;\n        }\n\n        // Prepare our output writer to generate the response message\n        response.setContentType(\"text/html; charset=\" + Constants.CHARSET);\n\n        String message = \"\";\n\n        // Create a new file upload handler\n        DiskFileUpload upload = new DiskFileUpload();\n\n        // Get the tempdir\n        File tempdir = (File) getServletContext().getAttribute\n            (\"javax.servlet.context.tempdir\");\n        // Set upload parameters\n        upload.setSizeMax(-1);\n        upload.setRepositoryPath(tempdir.getCanonicalPath());\n    \n        // Parse the request\n        String basename = null;\n        String war = null;\n        FileItem warUpload = null;\n        try {\n            List items = upload.parseRequest(request);\n        \n            // Process the uploaded fields\n            Iterator iter = items.iterator();\n            while (iter.hasNext()) {\n                FileItem item = (FileItem) iter.next();\n        \n                if (!item.isFormField()) {\n                    if (item.getFieldName().equals(\"deployWar\") &&\n                        warUpload == null) {\n                        warUpload = item;\n                    } else {\n                        item.delete();\n                    }\n                }\n            }\n            while (true) {\n                if (warUpload == null) {\n                    message = sm.getString\n                        (\"htmlManagerServlet.deployUploadNoFile\");\n                    break;\n                }\n                war = warUpload.getName();\n                if (!war.toLowerCase().endsWith(\".war\")) {\n                    message = sm.getString\n                        (\"htmlManagerServlet.deployUploadNotWar\",war);\n                    break;\n                }\n                // Get the filename if uploaded name includes a path\n                if (war.lastIndexOf('\\\\') >= 0) {\n                    war = war.substring(war.lastIndexOf('\\\\') + 1);\n                }\n                if (war.lastIndexOf('/') >= 0) {\n                    war = war.substring(war.lastIndexOf('/') + 1);\n                }\n                // Identify the appBase of the owning Host of this Context\n                // (if any)\n                basename = war.substring(0, war.toLowerCase().indexOf(\".war\"));\n                File file = new File(getAppBase(), war);\n                if (file.exists()) {\n                    message = sm.getString\n                        (\"htmlManagerServlet.deployUploadWarExists\",war);\n                    break;\n                }\n                String path = null;\n                if (basename.equals(\"ROOT\")) {\n                    path = \"\";\n                } else {\n                    path = \"/\" + basename;\n                }\n\n                if (!isServiced(path)) {\n                    addServiced(path);\n                    try {\n                        warUpload.write(file);\n                        // Perform new deployment\n                        check(path);\n                    } finally {\n                        removeServiced(path);\n                    }\n                }\n                break;\n            }\n        } catch(Exception e) {\n            message = sm.getString\n                (\"htmlManagerServlet.deployUploadFail\", e.getMessage());\n            log(message, e);\n        } finally {\n            if (warUpload != null) {\n                warUpload.delete();\n            }\n            warUpload = null;\n        }\n\n        list(request, response, message);\n    }",
            "path": "java/org/apache/catalina/manager/HTMLManagerServlet.java",
            "BugCommit": "0",
            "TangledWMoveandFileRename": "0"
        }
    },
    "file": "2087.json"
}