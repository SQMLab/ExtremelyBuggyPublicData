{
    "origin": "codeshovel",
    "repositoryName": "mage",
    "repositoryPath": "/home/student/fries432/Research/BugResearch/Repos/mage/.git",
    "startCommitName": "HEAD",
    "sourceFileName": "ManaEffect.java",
    "functionName": "apply",
    "functionId": "apply___game-Game__source-Ability",
    "sourceFilePath": "Mage/src/main/java/mage/abilities/effects/mana/ManaEffect.java",
    "functionStartLine": 31,
    "functionEndLine": 51,
    "numCommitsSeen": 38,
    "timeTaken": 8410,
    "changeHistory": [
        "9053e72f248c1d26b883e85ae89717efe8a5f25c",
        "b62dadf95d45444ffcefb067debd23e792c273cb",
        "46eb6c0525dcc59c65133e31fb85198539991616",
        "0125f88611aec6682e55b931f114b51ff3ad8474",
        "2d13deff3a55d89fbbe717543015d9f052d7a46d",
        "d85637336e5a40b03b36284d07a9eac79a8d7ee7",
        "b752eacfaad06505aa6751c7c935f9bf50f0ba3a",
        "21e5591e297a0e87785563aeb8a5b5e5d746b6c5",
        "2e72503b8cb13fef1894d40268fb7452cdee6251",
        "df341bd0d6674282cdb398f707183c6c624e9e43",
        "48fbd30f2d23ff3f237980d753dfc108b958d759",
        "bcb5be77be9422982dd5797d5f1b3078ccdad120",
        "89249888b529ae65ae8716b33c975794b9470a6a",
        "768f1bec4fa1cbe1d41c4964f0e52a2a8c750c2a",
        "85cad4ff1ed633b86b2c5dac4d8750e0ae0ce2d5"
    ],
    "changeHistoryShort": {
        "85cad4ff1ed633b86b2c5dac4d8750e0ae0ce2d5": "Ybodychange",
        "768f1bec4fa1cbe1d41c4964f0e52a2a8c750c2a": "Yfilerename",
        "89249888b529ae65ae8716b33c975794b9470a6a": "Ybodychange",
        "bcb5be77be9422982dd5797d5f1b3078ccdad120": "Ybodychange",
        "48fbd30f2d23ff3f237980d753dfc108b958d759": "Ymultichange(Ymovefromfile,Ybodychange)",
        "df341bd0d6674282cdb398f707183c6c624e9e43": "Ybodychange",
        "2e72503b8cb13fef1894d40268fb7452cdee6251": "Ybodychange",
        "21e5591e297a0e87785563aeb8a5b5e5d746b6c5": "Ybodychange",
        "b752eacfaad06505aa6751c7c935f9bf50f0ba3a": "Ybodychange",
        "d85637336e5a40b03b36284d07a9eac79a8d7ee7": "Ybodychange",
        "2d13deff3a55d89fbbe717543015d9f052d7a46d": "Ybodychange",
        "0125f88611aec6682e55b931f114b51ff3ad8474": "Ybodychange",
        "46eb6c0525dcc59c65133e31fb85198539991616": "Yfilerename",
        "b62dadf95d45444ffcefb067debd23e792c273cb": "Ybodychange",
        "9053e72f248c1d26b883e85ae89717efe8a5f25c": "Yintroduced"
    },
    "changeHistoryDetails": {
        "85cad4ff1ed633b86b2c5dac4d8750e0ae0ce2d5": {
            "type": "Ybodychange",
            "commitMessage": "cleanup AbilityType for easier check that an ability is an activated ability (#12153)\n\n* cleanup AbilityType\r\n\r\n* further cleanup\r\n\r\n* cleanup instanceof\r\n\r\n* tweak formatting\r\n\r\n* rework Rex\r\n\r\n* fix mistake in PlayerImpl\r\n\r\n* cleanup 'instanceof' for 'ActivatedManaAbilityImpl'",
            "commitDate": "03/05/24 9:13 PM",
            "commitName": "85cad4ff1ed633b86b2c5dac4d8750e0ae0ce2d5",
            "commitAuthor": "Susucre",
            "commitDateOld": "04/08/23 6:34 PM",
            "commitNameOld": "f75b1c9f0aa8f17c6df4e2570c39739a9a2691b7",
            "commitAuthorOld": "Susucre",
            "daysBetweenCommits": 273.11,
            "commitsBetweenForRepo": 2961,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,21 +1,21 @@\n     public boolean apply(Game game, Ability source) {\n         Player player = getPlayer(game, source);\n         if (player == null) {\n             return false;\n         }\n         if (game.inCheckPlayableState()) {\n             // During calculation of the available mana for a player the \"TappedForMana\" event is fired to simulate triggered mana production.\n             // By checking the inCheckPlayableState these events are handled to give back only the available mana of instead really producing mana\n             // So it's important if ManaEffects overwrite the apply method to take care for this.\n-            if (source instanceof TriggeredAbility) {\n+            if (source.isTriggeredAbility()) {\n                 player.addAvailableTriggeredMana(getNetMana(game, source));\n             }\n             return true; // No need to add mana to pool during checkPlayable   \n         }\n         Mana manaToAdd = produceMana(game, source);\n         if (manaToAdd != null && manaToAdd.count() > 0) {\n             checkToFirePossibleEvents(manaToAdd, game, source);\n             addManaToPool(player, manaToAdd, game, source);\n         }\n         return true;\n     }\n\\ No newline at end of file\n",
            "actualSource": "    public boolean apply(Game game, Ability source) {\n        Player player = getPlayer(game, source);\n        if (player == null) {\n            return false;\n        }\n        if (game.inCheckPlayableState()) {\n            // During calculation of the available mana for a player the \"TappedForMana\" event is fired to simulate triggered mana production.\n            // By checking the inCheckPlayableState these events are handled to give back only the available mana of instead really producing mana\n            // So it's important if ManaEffects overwrite the apply method to take care for this.\n            if (source.isTriggeredAbility()) {\n                player.addAvailableTriggeredMana(getNetMana(game, source));\n            }\n            return true; // No need to add mana to pool during checkPlayable   \n        }\n        Mana manaToAdd = produceMana(game, source);\n        if (manaToAdd != null && manaToAdd.count() > 0) {\n            checkToFirePossibleEvents(manaToAdd, game, source);\n            addManaToPool(player, manaToAdd, game, source);\n        }\n        return true;\n    }",
            "path": "Mage/src/main/java/mage/abilities/effects/mana/ManaEffect.java",
            "extendedDetails": {}
        },
        "768f1bec4fa1cbe1d41c4964f0e52a2a8c750c2a": {
            "type": "Yfilerename",
            "commitMessage": "* Fixed available mana calculation for Cryptic Trilobite and Titans' Nest. Added some improvements for available mana calculation of conditional mana.",
            "commitDate": "15/08/20 6:16 PM",
            "commitName": "768f1bec4fa1cbe1d41c4964f0e52a2a8c750c2a",
            "commitAuthor": "LevelX2",
            "commitDateOld": "15/08/20 3:55 PM",
            "commitNameOld": "3d989b24ac782effaacc2d58976a39dc284b7c8d",
            "commitAuthorOld": "Erik",
            "daysBetweenCommits": 0.1,
            "commitsBetweenForRepo": 1,
            "commitsBetweenForFile": 1,
            "diff": "",
            "actualSource": "    public boolean apply(Game game, Ability source) {\n        Player player = getPlayer(game, source);\n        if (player == null) {\n            return false;\n        }\n        if (game.inCheckPlayableState()) {\n            // During calculation of the available mana for a player the \"TappedForMana\" event is fired to simulate triggered mana production.\n            // By checking the inCheckPlayableState these events are handled to give back only the available mana of instead really producing mana\n            // So it's important if ManaEffects overwrite the apply method to take care for this.\n            if (source instanceof TriggeredAbility) {\n                player.addAvailableTriggeredMana(getNetMana(game, source));\n            }\n            return true; // No need to add mana to pool during checkPlayable   \n        }\n        Mana manaToAdd = produceMana(game, source);\n        if (manaToAdd != null && manaToAdd.count() > 0) {\n            checkToFirePossibleEvents(manaToAdd, game, source);\n            addManaToPool(player, manaToAdd, game, source);\n        }\n        return true;\n    }",
            "path": "Mage/src/main/java/mage/abilities/effects/mana/ManaEffect.java",
            "extendedDetails": {
                "oldPath": "Mage/src/main/java/mage/abilities/effects/common/ManaEffect.java",
                "newPath": "Mage/src/main/java/mage/abilities/effects/mana/ManaEffect.java"
            }
        },
        "89249888b529ae65ae8716b33c975794b9470a6a": {
            "type": "Ybodychange",
            "commitMessage": "* Added handling of triggered mana to available mana calculation (fixes #585).",
            "commitDate": "10/07/20 5:53 PM",
            "commitName": "89249888b529ae65ae8716b33c975794b9470a6a",
            "commitAuthor": "LevelX2",
            "commitDateOld": "25/02/20 2:41 AM",
            "commitNameOld": "169d9bf761bbb3a4201ad7163520d962a8ae4e8a",
            "commitAuthorOld": "Oleg Agafonov",
            "daysBetweenCommits": 136.59,
            "commitsBetweenForRepo": 1293,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,12 +1,21 @@\n     public boolean apply(Game game, Ability source) {\n         Player player = getPlayer(game, source);\n         if (player == null) {\n             return false;\n         }\n+        if (game.inCheckPlayableState()) {\n+            // During calculation of the available mana for a player the \"TappedForMana\" event is fired to simulate triggered mana production.\n+            // By checking the inCheckPlayableState these events are handled to give back only the available mana of instead really producing mana\n+            // So it's important if ManaEffects overwrite the apply method to take care for this.\n+            if (source instanceof TriggeredAbility) {\n+                player.addAvailableTriggeredMana(getNetMana(game, source));\n+            }\n+            return true; // No need to add mana to pool during checkPlayable   \n+        }\n         Mana manaToAdd = produceMana(game, source);\n         if (manaToAdd != null && manaToAdd.count() > 0) {\n             checkToFirePossibleEvents(manaToAdd, game, source);\n             addManaToPool(player, manaToAdd, game, source);\n         }\n         return true;\n     }\n\\ No newline at end of file\n",
            "actualSource": "    public boolean apply(Game game, Ability source) {\n        Player player = getPlayer(game, source);\n        if (player == null) {\n            return false;\n        }\n        if (game.inCheckPlayableState()) {\n            // During calculation of the available mana for a player the \"TappedForMana\" event is fired to simulate triggered mana production.\n            // By checking the inCheckPlayableState these events are handled to give back only the available mana of instead really producing mana\n            // So it's important if ManaEffects overwrite the apply method to take care for this.\n            if (source instanceof TriggeredAbility) {\n                player.addAvailableTriggeredMana(getNetMana(game, source));\n            }\n            return true; // No need to add mana to pool during checkPlayable   \n        }\n        Mana manaToAdd = produceMana(game, source);\n        if (manaToAdd != null && manaToAdd.count() > 0) {\n            checkToFirePossibleEvents(manaToAdd, game, source);\n            addManaToPool(player, manaToAdd, game, source);\n        }\n        return true;\n    }",
            "path": "Mage/src/main/java/mage/abilities/effects/common/ManaEffect.java",
            "extendedDetails": {}
        },
        "bcb5be77be9422982dd5797d5f1b3078ccdad120": {
            "type": "Ybodychange",
            "commitMessage": "Fixed NPE on empty net mana returns (from some effects);\n",
            "commitDate": "14/01/20 5:50 PM",
            "commitName": "bcb5be77be9422982dd5797d5f1b3078ccdad120",
            "commitAuthor": "Oleg Agafonov",
            "commitDateOld": "12/01/20 12:09 AM",
            "commitNameOld": "860c57d9d93909a272d8cedcc4bfa2080bbd7761",
            "commitAuthorOld": "Oleg Agafonov",
            "daysBetweenCommits": 2.74,
            "commitsBetweenForRepo": 64,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,12 +1,12 @@\n     public boolean apply(Game game, Ability source) {\n         Player player = getPlayer(game, source);\n         if (player == null) {\n             return false;\n         }\n         Mana manaToAdd = produceMana(game, source);\n-        if (manaToAdd.count() > 0) {\n+        if (manaToAdd != null && manaToAdd.count() > 0) {\n             checkToFirePossibleEvents(manaToAdd, game, source);\n             addManaToPool(player, manaToAdd, game, source);\n         }\n         return true;\n     }\n\\ No newline at end of file\n",
            "actualSource": "    public boolean apply(Game game, Ability source) {\n        Player player = getPlayer(game, source);\n        if (player == null) {\n            return false;\n        }\n        Mana manaToAdd = produceMana(game, source);\n        if (manaToAdd != null && manaToAdd.count() > 0) {\n            checkToFirePossibleEvents(manaToAdd, game, source);\n            addManaToPool(player, manaToAdd, game, source);\n        }\n        return true;\n    }",
            "path": "Mage/src/main/java/mage/abilities/effects/common/ManaEffect.java",
            "extendedDetails": {}
        },
        "48fbd30f2d23ff3f237980d753dfc108b958d759": {
            "type": "Ymultichange(Ymovefromfile,Ybodychange)",
            "commitMessage": "#5935 Fix and standardise firing of TAPPED_FOR_MANA event\n",
            "commitDate": "16/08/19 9:26 AM",
            "commitName": "48fbd30f2d23ff3f237980d753dfc108b958d759",
            "commitAuthor": "Iain Monro",
            "subchanges": [
                {
                    "type": "Ymovefromfile",
                    "commitMessage": "#5935 Fix and standardise firing of TAPPED_FOR_MANA event\n",
                    "commitDate": "16/08/19 9:26 AM",
                    "commitName": "48fbd30f2d23ff3f237980d753dfc108b958d759",
                    "commitAuthor": "Iain Monro",
                    "commitDateOld": "15/08/19 8:26 PM",
                    "commitNameOld": "0cf758ea5e6e5ff7fe244f5f17f94eb205fd1376",
                    "commitAuthorOld": "Evan Kranzler",
                    "daysBetweenCommits": 0.54,
                    "commitsBetweenForRepo": 1,
                    "commitsBetweenForFile": 1,
                    "diff": "@@ -1,12 +1,12 @@\n     public boolean apply(Game game, Ability source) {\n-        Player controller = game.getPlayer(source.getControllerId());\n-        if (controller == null) {\n+        Player player = getPlayer(game, source);\n+        if (player == null) {\n             return false;\n         }\n-        Mana mana = getMana(game, source);\n-        if (produceMana(true, game, source).getAny() > 0) {\n-            checkToFirePossibleEvents(mana, game, source);\n+        Mana manaToAdd = produceMana(game, source);\n+        if (manaToAdd.count() > 0) {\n+            checkToFirePossibleEvents(manaToAdd, game, source);\n+            addManaToPool(player, manaToAdd, game, source);\n         }\n-        controller.getManaPool().addMana(mana, game, source);\n         return true;\n     }\n\\ No newline at end of file\n",
                    "actualSource": "    public boolean apply(Game game, Ability source) {\n        Player player = getPlayer(game, source);\n        if (player == null) {\n            return false;\n        }\n        Mana manaToAdd = produceMana(game, source);\n        if (manaToAdd.count() > 0) {\n            checkToFirePossibleEvents(manaToAdd, game, source);\n            addManaToPool(player, manaToAdd, game, source);\n        }\n        return true;\n    }",
                    "path": "Mage/src/main/java/mage/abilities/effects/common/ManaEffect.java",
                    "extendedDetails": {
                        "oldPath": "Mage/src/main/java/mage/abilities/decorator/ConditionalManaEffect.java",
                        "newPath": "Mage/src/main/java/mage/abilities/effects/common/ManaEffect.java",
                        "oldMethodName": "apply",
                        "newMethodName": "apply"
                    }
                },
                {
                    "type": "Ybodychange",
                    "commitMessage": "#5935 Fix and standardise firing of TAPPED_FOR_MANA event\n",
                    "commitDate": "16/08/19 9:26 AM",
                    "commitName": "48fbd30f2d23ff3f237980d753dfc108b958d759",
                    "commitAuthor": "Iain Monro",
                    "commitDateOld": "15/08/19 8:26 PM",
                    "commitNameOld": "0cf758ea5e6e5ff7fe244f5f17f94eb205fd1376",
                    "commitAuthorOld": "Evan Kranzler",
                    "daysBetweenCommits": 0.54,
                    "commitsBetweenForRepo": 1,
                    "commitsBetweenForFile": 1,
                    "diff": "@@ -1,12 +1,12 @@\n     public boolean apply(Game game, Ability source) {\n-        Player controller = game.getPlayer(source.getControllerId());\n-        if (controller == null) {\n+        Player player = getPlayer(game, source);\n+        if (player == null) {\n             return false;\n         }\n-        Mana mana = getMana(game, source);\n-        if (produceMana(true, game, source).getAny() > 0) {\n-            checkToFirePossibleEvents(mana, game, source);\n+        Mana manaToAdd = produceMana(game, source);\n+        if (manaToAdd.count() > 0) {\n+            checkToFirePossibleEvents(manaToAdd, game, source);\n+            addManaToPool(player, manaToAdd, game, source);\n         }\n-        controller.getManaPool().addMana(mana, game, source);\n         return true;\n     }\n\\ No newline at end of file\n",
                    "actualSource": "    public boolean apply(Game game, Ability source) {\n        Player player = getPlayer(game, source);\n        if (player == null) {\n            return false;\n        }\n        Mana manaToAdd = produceMana(game, source);\n        if (manaToAdd.count() > 0) {\n            checkToFirePossibleEvents(manaToAdd, game, source);\n            addManaToPool(player, manaToAdd, game, source);\n        }\n        return true;\n    }",
                    "path": "Mage/src/main/java/mage/abilities/effects/common/ManaEffect.java",
                    "extendedDetails": {}
                }
            ]
        },
        "df341bd0d6674282cdb398f707183c6c624e9e43": {
            "type": "Ybodychange",
            "commitMessage": "* Fixed some mana handling problems of conditionalMana (GemstoneCavern) and possible exception of ChromeMox.Fixed some tests.",
            "commitDate": "05/06/18 4:59 PM",
            "commitName": "df341bd0d6674282cdb398f707183c6c624e9e43",
            "commitAuthor": "LevelX2",
            "commitDateOld": "05/06/18 11:12 AM",
            "commitNameOld": "2e72503b8cb13fef1894d40268fb7452cdee6251",
            "commitAuthorOld": "LevelX2",
            "daysBetweenCommits": 0.24,
            "commitsBetweenForRepo": 4,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,12 +1,12 @@\n     public boolean apply(Game game, Ability source) {\n         Player controller = game.getPlayer(source.getControllerId());\n         if (controller == null) {\n             return false;\n         }\n         Mana mana = getMana(game, source);\n-        controller.getManaPool().addMana(mana, game, source);\n         if (produceMana(true, game, source).getAny() > 0) {\n             checkToFirePossibleEvents(mana, game, source);\n         }\n+        controller.getManaPool().addMana(mana, game, source);\n         return true;\n     }\n\\ No newline at end of file\n",
            "actualSource": "    public boolean apply(Game game, Ability source) {\n        Player controller = game.getPlayer(source.getControllerId());\n        if (controller == null) {\n            return false;\n        }\n        Mana mana = getMana(game, source);\n        if (produceMana(true, game, source).getAny() > 0) {\n            checkToFirePossibleEvents(mana, game, source);\n        }\n        controller.getManaPool().addMana(mana, game, source);\n        return true;\n    }",
            "path": "Mage/src/main/java/mage/abilities/decorator/ConditionalManaEffect.java",
            "extendedDetails": {}
        },
        "2e72503b8cb13fef1894d40268fb7452cdee6251": {
            "type": "Ybodychange",
            "commitMessage": "* Fix of condtitional mana effect (not completed yet).",
            "commitDate": "05/06/18 11:12 AM",
            "commitName": "2e72503b8cb13fef1894d40268fb7452cdee6251",
            "commitAuthor": "LevelX2",
            "commitDateOld": "02/06/18 10:59 AM",
            "commitNameOld": "3953f3dbdd165ef5b0cc54df68e4ed2b12c3dd48",
            "commitAuthorOld": "GrayedFox",
            "daysBetweenCommits": 3.01,
            "commitsBetweenForRepo": 48,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,8 +1,12 @@\n     public boolean apply(Game game, Ability source) {\n         Player controller = game.getPlayer(source.getControllerId());\n         if (controller == null) {\n             return false;\n         }\n-        controller.getManaPool().addMana(getMana(game, source), game, source);\n+        Mana mana = getMana(game, source);\n+        controller.getManaPool().addMana(mana, game, source);\n+        if (produceMana(true, game, source).getAny() > 0) {\n+            checkToFirePossibleEvents(mana, game, source);\n+        }\n         return true;\n     }\n\\ No newline at end of file\n",
            "actualSource": "    public boolean apply(Game game, Ability source) {\n        Player controller = game.getPlayer(source.getControllerId());\n        if (controller == null) {\n            return false;\n        }\n        Mana mana = getMana(game, source);\n        controller.getManaPool().addMana(mana, game, source);\n        if (produceMana(true, game, source).getAny() > 0) {\n            checkToFirePossibleEvents(mana, game, source);\n        }\n        return true;\n    }",
            "path": "Mage/src/main/java/mage/abilities/decorator/ConditionalManaEffect.java",
            "extendedDetails": {}
        },
        "21e5591e297a0e87785563aeb8a5b5e5d746b6c5": {
            "type": "Ybodychange",
            "commitMessage": "* Some rework of handling of mana effects.",
            "commitDate": "13/05/18 3:52 PM",
            "commitName": "21e5591e297a0e87785563aeb8a5b5e5d746b6c5",
            "commitAuthor": "LevelX2",
            "commitDateOld": "04/02/18 10:51 AM",
            "commitNameOld": "b752eacfaad06505aa6751c7c935f9bf50f0ba3a",
            "commitAuthorOld": "LevelX2",
            "daysBetweenCommits": 98.17,
            "commitsBetweenForRepo": 1158,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,32 +1,8 @@\n     public boolean apply(Game game, Ability source) {\n         Player controller = game.getPlayer(source.getControllerId());\n         if (controller == null) {\n             return false;\n         }\n-        if (condition.apply(game, source)) {\n-            effect.setTargetPointer(this.targetPointer);\n-        } else if (otherwiseEffect != null) {\n-            otherwiseEffect.setTargetPointer(this.targetPointer);\n-        }\n-        Mana mana = getMana(game, source);\n-        if (mana == null) {\n-            return false;\n-        }\n-        if (mana.getAny() > 0) {\n-            int amount = mana.getAny();\n-\n-            ChoiceColor choice = new ChoiceColor(true);\n-            Mana createdMana = null;\n-            if (controller.choose(outcome, choice, game)) {\n-                createdMana = choice.getMana(amount);\n-            }\n-            if (createdMana == null) {\n-                return false;\n-            }\n-            mana = createdMana;\n-            // because the mana type is now choosen, fire the event with the mana information\n-            checkToFirePossibleEvents(mana, game, source);\n-        }\n-        controller.getManaPool().addMana(mana, game, source);\n+        controller.getManaPool().addMana(getMana(game, source), game, source);\n         return true;\n     }\n\\ No newline at end of file\n",
            "actualSource": "    public boolean apply(Game game, Ability source) {\n        Player controller = game.getPlayer(source.getControllerId());\n        if (controller == null) {\n            return false;\n        }\n        controller.getManaPool().addMana(getMana(game, source), game, source);\n        return true;\n    }",
            "path": "Mage/src/main/java/mage/abilities/decorator/ConditionalManaEffect.java",
            "extendedDetails": {}
        },
        "b752eacfaad06505aa6751c7c935f9bf50f0ba3a": {
            "type": "Ybodychange",
            "commitMessage": "* Optimized handling and call of player.choose choice to prevent problems if a player disconnects or left a game (#4263).",
            "commitDate": "04/02/18 10:51 AM",
            "commitName": "b752eacfaad06505aa6751c7c935f9bf50f0ba3a",
            "commitAuthor": "LevelX2",
            "commitDateOld": "28/12/17 5:57 AM",
            "commitNameOld": "d85637336e5a40b03b36284d07a9eac79a8d7ee7",
            "commitAuthorOld": "LevelX2",
            "daysBetweenCommits": 38.2,
            "commitsBetweenForRepo": 470,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,36 +1,32 @@\n     public boolean apply(Game game, Ability source) {\n         Player controller = game.getPlayer(source.getControllerId());\n         if (controller == null) {\n             return false;\n         }\n         if (condition.apply(game, source)) {\n             effect.setTargetPointer(this.targetPointer);\n         } else if (otherwiseEffect != null) {\n             otherwiseEffect.setTargetPointer(this.targetPointer);\n         }\n         Mana mana = getMana(game, source);\n         if (mana == null) {\n             return false;\n         }\n         if (mana.getAny() > 0) {\n             int amount = mana.getAny();\n \n             ChoiceColor choice = new ChoiceColor(true);\n             Mana createdMana = null;\n             if (controller.choose(outcome, choice, game)) {\n-                if (choice.getColor() == null) {\n-                    return false; // it happens, don't know how\n-                }\n-\n                 createdMana = choice.getMana(amount);\n             }\n             if (createdMana == null) {\n                 return false;\n             }\n             mana = createdMana;\n             // because the mana type is now choosen, fire the event with the mana information\n             checkToFirePossibleEvents(mana, game, source);\n         }\n         controller.getManaPool().addMana(mana, game, source);\n         return true;\n     }\n\\ No newline at end of file\n",
            "actualSource": "    public boolean apply(Game game, Ability source) {\n        Player controller = game.getPlayer(source.getControllerId());\n        if (controller == null) {\n            return false;\n        }\n        if (condition.apply(game, source)) {\n            effect.setTargetPointer(this.targetPointer);\n        } else if (otherwiseEffect != null) {\n            otherwiseEffect.setTargetPointer(this.targetPointer);\n        }\n        Mana mana = getMana(game, source);\n        if (mana == null) {\n            return false;\n        }\n        if (mana.getAny() > 0) {\n            int amount = mana.getAny();\n\n            ChoiceColor choice = new ChoiceColor(true);\n            Mana createdMana = null;\n            if (controller.choose(outcome, choice, game)) {\n                createdMana = choice.getMana(amount);\n            }\n            if (createdMana == null) {\n                return false;\n            }\n            mana = createdMana;\n            // because the mana type is now choosen, fire the event with the mana information\n            checkToFirePossibleEvents(mana, game, source);\n        }\n        controller.getManaPool().addMana(mana, game, source);\n        return true;\n    }",
            "path": "Mage/src/main/java/mage/abilities/decorator/ConditionalManaEffect.java",
            "extendedDetails": {},
            "BugCommit": "0",
            "TangledWMoveandFileRename": "116"
        },
        "d85637336e5a40b03b36284d07a9eac79a8d7ee7": {
            "type": "Ybodychange",
            "commitMessage": "* Cabal Ritual, Gemstone Caverns, River of Tears - Fixed a problem that the tap for mana event was sent twice for theses lands (fixes #4288).\n",
            "commitDate": "28/12/17 5:57 AM",
            "commitName": "d85637336e5a40b03b36284d07a9eac79a8d7ee7",
            "commitAuthor": "LevelX2",
            "commitDateOld": "14/01/17 5:25 AM",
            "commitNameOld": "2d13deff3a55d89fbbe717543015d9f052d7a46d",
            "commitAuthorOld": "LevelX2",
            "daysBetweenCommits": 348.02,
            "commitsBetweenForRepo": 3404,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,33 +1,36 @@\n     public boolean apply(Game game, Ability source) {\n         Player controller = game.getPlayer(source.getControllerId());\n         if (controller == null) {\n             return false;\n         }\n         if (condition.apply(game, source)) {\n             effect.setTargetPointer(this.targetPointer);\n         } else if (otherwiseEffect != null) {\n             otherwiseEffect.setTargetPointer(this.targetPointer);\n         }\n         Mana mana = getMana(game, source);\n-\n-        if (mana != null && mana.getAny() > 0) {\n+        if (mana == null) {\n+            return false;\n+        }\n+        if (mana.getAny() > 0) {\n             int amount = mana.getAny();\n \n             ChoiceColor choice = new ChoiceColor(true);\n             Mana createdMana = null;\n             if (controller.choose(outcome, choice, game)) {\n                 if (choice.getColor() == null) {\n                     return false; // it happens, don't know how\n                 }\n \n                 createdMana = choice.getMana(amount);\n             }\n+            if (createdMana == null) {\n+                return false;\n+            }\n             mana = createdMana;\n-        }\n-\n-        if (mana != null) {\n+            // because the mana type is now choosen, fire the event with the mana information\n             checkToFirePossibleEvents(mana, game, source);\n-            controller.getManaPool().addMana(mana, game, source);\n         }\n+        controller.getManaPool().addMana(mana, game, source);\n         return true;\n     }\n\\ No newline at end of file\n",
            "actualSource": "    public boolean apply(Game game, Ability source) {\n        Player controller = game.getPlayer(source.getControllerId());\n        if (controller == null) {\n            return false;\n        }\n        if (condition.apply(game, source)) {\n            effect.setTargetPointer(this.targetPointer);\n        } else if (otherwiseEffect != null) {\n            otherwiseEffect.setTargetPointer(this.targetPointer);\n        }\n        Mana mana = getMana(game, source);\n        if (mana == null) {\n            return false;\n        }\n        if (mana.getAny() > 0) {\n            int amount = mana.getAny();\n\n            ChoiceColor choice = new ChoiceColor(true);\n            Mana createdMana = null;\n            if (controller.choose(outcome, choice, game)) {\n                if (choice.getColor() == null) {\n                    return false; // it happens, don't know how\n                }\n\n                createdMana = choice.getMana(amount);\n            }\n            if (createdMana == null) {\n                return false;\n            }\n            mana = createdMana;\n            // because the mana type is now choosen, fire the event with the mana information\n            checkToFirePossibleEvents(mana, game, source);\n        }\n        controller.getManaPool().addMana(mana, game, source);\n        return true;\n    }",
            "path": "Mage/src/main/java/mage/abilities/decorator/ConditionalManaEffect.java",
            "extendedDetails": {},
            "BugCommit": "1",
            "TangledWMoveandFileRename": "1"
        },
        "2d13deff3a55d89fbbe717543015d9f052d7a46d": {
            "type": "Ybodychange",
            "commitMessage": "* Vorinclex, Voice of Hunger - FIxed a bug that id did not work correctly with some conditional land mana sources (e.g. Gemstone Caverns).",
            "commitDate": "14/01/17 5:25 AM",
            "commitName": "2d13deff3a55d89fbbe717543015d9f052d7a46d",
            "commitAuthor": "LevelX2",
            "commitDateOld": "31/10/16 1:02 AM",
            "commitNameOld": "0125f88611aec6682e55b931f114b51ff3ad8474",
            "commitAuthorOld": "Neil Gentleman",
            "daysBetweenCommits": 75.22,
            "commitsBetweenForRepo": 540,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,32 +1,33 @@\n     public boolean apply(Game game, Ability source) {\n         Player controller = game.getPlayer(source.getControllerId());\n         if (controller == null) {\n             return false;\n         }\n         if (condition.apply(game, source)) {\n             effect.setTargetPointer(this.targetPointer);\n         } else if (otherwiseEffect != null) {\n             otherwiseEffect.setTargetPointer(this.targetPointer);\n         }\n         Mana mana = getMana(game, source);\n \n         if (mana != null && mana.getAny() > 0) {\n             int amount = mana.getAny();\n \n             ChoiceColor choice = new ChoiceColor(true);\n             Mana createdMana = null;\n             if (controller.choose(outcome, choice, game)) {\n                 if (choice.getColor() == null) {\n                     return false; // it happens, don't know how\n                 }\n \n                 createdMana = choice.getMana(amount);\n             }\n             mana = createdMana;\n         }\n \n         if (mana != null) {\n+            checkToFirePossibleEvents(mana, game, source);\n             controller.getManaPool().addMana(mana, game, source);\n         }\n         return true;\n     }\n\\ No newline at end of file\n",
            "actualSource": "    public boolean apply(Game game, Ability source) {\n        Player controller = game.getPlayer(source.getControllerId());\n        if (controller == null) {\n            return false;\n        }\n        if (condition.apply(game, source)) {\n            effect.setTargetPointer(this.targetPointer);\n        } else if (otherwiseEffect != null) {\n            otherwiseEffect.setTargetPointer(this.targetPointer);\n        }\n        Mana mana = getMana(game, source);\n\n        if (mana != null && mana.getAny() > 0) {\n            int amount = mana.getAny();\n\n            ChoiceColor choice = new ChoiceColor(true);\n            Mana createdMana = null;\n            if (controller.choose(outcome, choice, game)) {\n                if (choice.getColor() == null) {\n                    return false; // it happens, don't know how\n                }\n\n                createdMana = choice.getMana(amount);\n            }\n            mana = createdMana;\n        }\n\n        if (mana != null) {\n            checkToFirePossibleEvents(mana, game, source);\n            controller.getManaPool().addMana(mana, game, source);\n        }\n        return true;\n    }",
            "path": "Mage/src/main/java/mage/abilities/decorator/ConditionalManaEffect.java",
            "extendedDetails": {},
            "BugCommit": "1",
            "TangledWMoveandFileRename": "1"
        },
        "0125f88611aec6682e55b931f114b51ff3ad8474": {
            "type": "Ybodychange",
            "commitMessage": "add mana-generation helpers to ChoiceColor\n",
            "commitDate": "31/10/16 1:02 AM",
            "commitName": "0125f88611aec6682e55b931f114b51ff3ad8474",
            "commitAuthor": "Neil Gentleman",
            "commitDateOld": "14/04/16 11:18 AM",
            "commitNameOld": "430ae503c71b8a57ac7bea07a07650717832a6f9",
            "commitAuthorOld": "Fenhl",
            "daysBetweenCommits": 199.57,
            "commitsBetweenForRepo": 1299,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,42 +1,32 @@\n     public boolean apply(Game game, Ability source) {\n         Player controller = game.getPlayer(source.getControllerId());\n         if (controller == null) {\n             return false;\n         }\n         if (condition.apply(game, source)) {\n             effect.setTargetPointer(this.targetPointer);\n         } else if (otherwiseEffect != null) {\n             otherwiseEffect.setTargetPointer(this.targetPointer);\n         }\n         Mana mana = getMana(game, source);\n \n         if (mana != null && mana.getAny() > 0) {\n             int amount = mana.getAny();\n \n             ChoiceColor choice = new ChoiceColor(true);\n             Mana createdMana = null;\n             if (controller.choose(outcome, choice, game)) {\n                 if (choice.getColor() == null) {\n                     return false; // it happens, don't know how\n                 }\n \n-                if (choice.getColor().isBlack()) {\n-                    createdMana = Mana.BlackMana(amount);\n-                } else if (choice.getColor().isBlue()) {\n-                    createdMana = Mana.BlueMana(amount);\n-                } else if (choice.getColor().isRed()) {\n-                    createdMana = Mana.RedMana(amount);\n-                } else if (choice.getColor().isGreen()) {\n-                    createdMana = Mana.GreenMana(amount);\n-                } else if (choice.getColor().isWhite()) {\n-                    createdMana = Mana.WhiteMana(amount);\n-                }\n+                createdMana = choice.getMana(amount);\n             }\n             mana = createdMana;\n         }\n \n         if (mana != null) {\n             controller.getManaPool().addMana(mana, game, source);\n         }\n         return true;\n     }\n\\ No newline at end of file\n",
            "actualSource": "    public boolean apply(Game game, Ability source) {\n        Player controller = game.getPlayer(source.getControllerId());\n        if (controller == null) {\n            return false;\n        }\n        if (condition.apply(game, source)) {\n            effect.setTargetPointer(this.targetPointer);\n        } else if (otherwiseEffect != null) {\n            otherwiseEffect.setTargetPointer(this.targetPointer);\n        }\n        Mana mana = getMana(game, source);\n\n        if (mana != null && mana.getAny() > 0) {\n            int amount = mana.getAny();\n\n            ChoiceColor choice = new ChoiceColor(true);\n            Mana createdMana = null;\n            if (controller.choose(outcome, choice, game)) {\n                if (choice.getColor() == null) {\n                    return false; // it happens, don't know how\n                }\n\n                createdMana = choice.getMana(amount);\n            }\n            mana = createdMana;\n        }\n\n        if (mana != null) {\n            controller.getManaPool().addMana(mana, game, source);\n        }\n        return true;\n    }",
            "path": "Mage/src/main/java/mage/abilities/decorator/ConditionalManaEffect.java",
            "extendedDetails": {},
            "BugCommit": "0",
            "TangledWMoveandFileRename": "8"
        },
        "46eb6c0525dcc59c65133e31fb85198539991616": {
            "type": "Yfilerename",
            "commitMessage": "Restructured Mage module\n",
            "commitDate": "29/11/15 2:56 PM",
            "commitName": "46eb6c0525dcc59c65133e31fb85198539991616",
            "commitAuthor": "poixen",
            "commitDateOld": "29/11/15 2:17 PM",
            "commitNameOld": "727d62babb29d472f4616dcf1e1e36e502cab0f4",
            "commitAuthorOld": "poixen",
            "daysBetweenCommits": 0.03,
            "commitsBetweenForRepo": 1,
            "commitsBetweenForFile": 1,
            "diff": "",
            "actualSource": "    public boolean apply(Game game, Ability source) {\n        Player controller = game.getPlayer(source.getControllerId());\n        if (controller == null) {\n            return false;\n        }\n        if (condition.apply(game, source)) {\n            effect.setTargetPointer(this.targetPointer);\n        } else if (otherwiseEffect != null) {\n            otherwiseEffect.setTargetPointer(this.targetPointer);\n        }\n        Mana mana = getMana(game, source);\n\n        if (mana != null && mana.getAny() > 0) {\n            int amount = mana.getAny();\n\n            ChoiceColor choice = new ChoiceColor(true);\n            Mana createdMana = null;\n            if (controller.choose(outcome, choice, game)) {\n                if (choice.getColor() == null) {\n                    return false; // it happens, don't know how\n                }\n\n                if (choice.getColor().isBlack()) {\n                    createdMana = Mana.BlackMana(amount);\n                } else if (choice.getColor().isBlue()) {\n                    createdMana = Mana.BlueMana(amount);\n                } else if (choice.getColor().isRed()) {\n                    createdMana = Mana.RedMana(amount);\n                } else if (choice.getColor().isGreen()) {\n                    createdMana = Mana.GreenMana(amount);\n                } else if (choice.getColor().isWhite()) {\n                    createdMana = Mana.WhiteMana(amount);\n                }\n            }\n            mana = createdMana;\n        }\n\n        if (mana != null) {\n            controller.getManaPool().addMana(mana, game, source);\n        }\n        return true;\n    }",
            "path": "Mage/src/main/java/mage/abilities/decorator/ConditionalManaEffect.java",
            "extendedDetails": {
                "oldPath": "Mage/src/mage/abilities/decorator/ConditionalManaEffect.java",
                "newPath": "Mage/src/main/java/mage/abilities/decorator/ConditionalManaEffect.java"
            },
            "BugCommit": "0",
            "TangledWMoveandFileRename": "0"
        },
        "b62dadf95d45444ffcefb067debd23e792c273cb": {
            "type": "Ybodychange",
            "commitMessage": "* Fixed that conditional mana (e.g. River of Tears) did not trigger mana adding effects like Vorinclex, Voice of Hunger.",
            "commitDate": "25/08/15 3:38 PM",
            "commitName": "b62dadf95d45444ffcefb067debd23e792c273cb",
            "commitAuthor": "LevelX2",
            "commitDateOld": "17/11/14 10:37 AM",
            "commitNameOld": "97412e3e9ef5cd7821e95ac48a645bb013fb4fcb",
            "commitAuthorOld": "LevelX2",
            "daysBetweenCommits": 281.17,
            "commitsBetweenForRepo": 2788,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,10 +1,42 @@\n     public boolean apply(Game game, Ability source) {\n+        Player controller = game.getPlayer(source.getControllerId());\n+        if (controller == null) {\n+            return false;\n+        }\n         if (condition.apply(game, source)) {\n             effect.setTargetPointer(this.targetPointer);\n-            return effect.apply(game, source);\n         } else if (otherwiseEffect != null) {\n             otherwiseEffect.setTargetPointer(this.targetPointer);\n-            return otherwiseEffect.apply(game, source);\n         }\n-        return false;\n+        Mana mana = getMana(game, source);\n+\n+        if (mana != null && mana.getAny() > 0) {\n+            int amount = mana.getAny();\n+\n+            ChoiceColor choice = new ChoiceColor(true);\n+            Mana createdMana = null;\n+            if (controller.choose(outcome, choice, game)) {\n+                if (choice.getColor() == null) {\n+                    return false; // it happens, don't know how\n+                }\n+\n+                if (choice.getColor().isBlack()) {\n+                    createdMana = Mana.BlackMana(amount);\n+                } else if (choice.getColor().isBlue()) {\n+                    createdMana = Mana.BlueMana(amount);\n+                } else if (choice.getColor().isRed()) {\n+                    createdMana = Mana.RedMana(amount);\n+                } else if (choice.getColor().isGreen()) {\n+                    createdMana = Mana.GreenMana(amount);\n+                } else if (choice.getColor().isWhite()) {\n+                    createdMana = Mana.WhiteMana(amount);\n+                }\n+            }\n+            mana = createdMana;\n+        }\n+\n+        if (mana != null) {\n+            controller.getManaPool().addMana(mana, game, source);\n+        }\n+        return true;\n     }\n\\ No newline at end of file\n",
            "actualSource": "    public boolean apply(Game game, Ability source) {\n        Player controller = game.getPlayer(source.getControllerId());\n        if (controller == null) {\n            return false;\n        }\n        if (condition.apply(game, source)) {\n            effect.setTargetPointer(this.targetPointer);\n        } else if (otherwiseEffect != null) {\n            otherwiseEffect.setTargetPointer(this.targetPointer);\n        }\n        Mana mana = getMana(game, source);\n\n        if (mana != null && mana.getAny() > 0) {\n            int amount = mana.getAny();\n\n            ChoiceColor choice = new ChoiceColor(true);\n            Mana createdMana = null;\n            if (controller.choose(outcome, choice, game)) {\n                if (choice.getColor() == null) {\n                    return false; // it happens, don't know how\n                }\n\n                if (choice.getColor().isBlack()) {\n                    createdMana = Mana.BlackMana(amount);\n                } else if (choice.getColor().isBlue()) {\n                    createdMana = Mana.BlueMana(amount);\n                } else if (choice.getColor().isRed()) {\n                    createdMana = Mana.RedMana(amount);\n                } else if (choice.getColor().isGreen()) {\n                    createdMana = Mana.GreenMana(amount);\n                } else if (choice.getColor().isWhite()) {\n                    createdMana = Mana.WhiteMana(amount);\n                }\n            }\n            mana = createdMana;\n        }\n\n        if (mana != null) {\n            controller.getManaPool().addMana(mana, game, source);\n        }\n        return true;\n    }",
            "path": "Mage/src/mage/abilities/decorator/ConditionalManaEffect.java",
            "extendedDetails": {},
            "BugCommit": "0",
            "TangledWMoveandFileRename": "1"
        },
        "9053e72f248c1d26b883e85ae89717efe8a5f25c": {
            "type": "Yintroduced",
            "commitMessage": "Added a ConditionalManaEffect.",
            "commitDate": "29/03/13 12:57 PM",
            "commitName": "9053e72f248c1d26b883e85ae89717efe8a5f25c",
            "commitAuthor": "LevelX2",
            "diff": "@@ -0,0 +1,10 @@\n+    public boolean apply(Game game, Ability source) {\n+        if (condition.apply(game, source)) {\n+            effect.setTargetPointer(this.targetPointer);\n+            return effect.apply(game, source);\n+        } else if (otherwiseEffect != null) {\n+            otherwiseEffect.setTargetPointer(this.targetPointer);\n+            return otherwiseEffect.apply(game, source);\n+        }\n+        return false;\n+    }\n\\ No newline at end of file\n",
            "actualSource": "    public boolean apply(Game game, Ability source) {\n        if (condition.apply(game, source)) {\n            effect.setTargetPointer(this.targetPointer);\n            return effect.apply(game, source);\n        } else if (otherwiseEffect != null) {\n            otherwiseEffect.setTargetPointer(this.targetPointer);\n            return otherwiseEffect.apply(game, source);\n        }\n        return false;\n    }",
            "path": "Mage/src/mage/abilities/decorator/ConditionalManaEffect.java",
            "BugCommit": "0",
            "TangledWMoveandFileRename": "0"
        }
    },
    "file": "75916.json"
}