{
    "origin": "codeshovel",
    "repositoryName": "mage",
    "repositoryPath": "/home/student/fries432/Research/BugResearch/Repos/mage/.git",
    "startCommitName": "HEAD",
    "sourceFileName": "ContinuousEffects.java",
    "functionName": "replaceEvent",
    "functionId": "replaceEvent___event-GameEvent__game-Game",
    "sourceFilePath": "Mage/src/main/java/mage/abilities/effects/ContinuousEffects.java",
    "functionStartLine": 846,
    "functionEndLine": 964,
    "numCommitsSeen": 234,
    "timeTaken": 7546,
    "changeHistory": [
        "a4ecfa58fa632ae0b1ee715ab474889c67a2f105",
        "3fa0e8b8f4444c077085ad270feafcfd238d2719",
        "5eae8136e40add7603cb73bf94a5b9df6e7098e9",
        "0cd0b7045a93aa4fd7101c9857057a7f58861a2a",
        "428609ab8b47e1127e6e1f2632f381ed941fffde",
        "2d0842f320be9ac106ea1ffc8c5d3bbf72345ef5",
        "3b643805c80a4595da8ebfab56ea078dde579422",
        "1cb25812c9d6bb82a9a98bcf8e774fe0f50e7039",
        "2e60801df6c6909ce2bc9a4852ec6b312f67abb1",
        "32dff5ae723947d3a763775f8161a469f77fcc97",
        "1e5100e0d6e3d0b5899aa9b71ec8b3642b3a263b",
        "768ef9a4fc6403e9a7492422a9490f072d7602c3",
        "b7a22aa28370ced96ceb1cec5b71cc13901b576a",
        "8b6cfc952996df8c40fcc998a5eea3f69c6a851d",
        "d8236a8d3a4834e23276d5a13bac80ce1a8b4790",
        "45618309fbd2e172015a4c6de00e02b72760c011",
        "05a2e09b2a38af8e8abf85d95f7cf74323b513f3",
        "a7fc5b9583d8f0cf41c95a9a49df5b08604f9e13",
        "df71237f46239e3ec3772c324c582465557d68c5",
        "4f1368f3de90d177bd11f463e83f156aa70a5f3a",
        "eb0544957bf17a7090cc7943cb7dc76142177c38",
        "b4894f5564ab0d9322baed947d419ff09a1361a9",
        "93dcf2d59f6dc2020e03bb3dba2e6cc49be590b4",
        "046da0f5d1f5c5250a09084bf3184b94438800ba",
        "59ef2a2889159d9b7007a57d8bcb213d64201dea",
        "46eb6c0525dcc59c65133e31fb85198539991616",
        "972ed6a3f294bd2a67d5c65b2b9b96ad4bc44512",
        "d93061c0bc67bac27aa774f291a31b58cb793826",
        "905829561e527b07644a29ac09484e5ffd75d436",
        "c2a48906031201b4781e79bd409663701c06d88b",
        "b28bf51c02531dfb058be2552f0abc863b0725ad",
        "7b2e9b390c448f6af405658163934c3276fc3b1c"
    ],
    "changeHistoryShort": {
        "7b2e9b390c448f6af405658163934c3276fc3b1c": "Ybodychange",
        "b28bf51c02531dfb058be2552f0abc863b0725ad": "Ybodychange",
        "c2a48906031201b4781e79bd409663701c06d88b": "Ybodychange",
        "905829561e527b07644a29ac09484e5ffd75d436": "Ybodychange",
        "d93061c0bc67bac27aa774f291a31b58cb793826": "Ybodychange",
        "972ed6a3f294bd2a67d5c65b2b9b96ad4bc44512": "Ybodychange",
        "46eb6c0525dcc59c65133e31fb85198539991616": "Yfilerename",
        "59ef2a2889159d9b7007a57d8bcb213d64201dea": "Ybodychange",
        "046da0f5d1f5c5250a09084bf3184b94438800ba": "Ybodychange",
        "93dcf2d59f6dc2020e03bb3dba2e6cc49be590b4": "Ybodychange",
        "b4894f5564ab0d9322baed947d419ff09a1361a9": "Ybodychange",
        "eb0544957bf17a7090cc7943cb7dc76142177c38": "Ybodychange",
        "4f1368f3de90d177bd11f463e83f156aa70a5f3a": "Ybodychange",
        "df71237f46239e3ec3772c324c582465557d68c5": "Ybodychange",
        "a7fc5b9583d8f0cf41c95a9a49df5b08604f9e13": "Ybodychange",
        "05a2e09b2a38af8e8abf85d95f7cf74323b513f3": "Ybodychange",
        "45618309fbd2e172015a4c6de00e02b72760c011": "Ybodychange",
        "d8236a8d3a4834e23276d5a13bac80ce1a8b4790": "Ybodychange",
        "8b6cfc952996df8c40fcc998a5eea3f69c6a851d": "Ybodychange",
        "b7a22aa28370ced96ceb1cec5b71cc13901b576a": "Ybodychange",
        "768ef9a4fc6403e9a7492422a9490f072d7602c3": "Ybodychange",
        "1e5100e0d6e3d0b5899aa9b71ec8b3642b3a263b": "Ybodychange",
        "32dff5ae723947d3a763775f8161a469f77fcc97": "Ybodychange",
        "2e60801df6c6909ce2bc9a4852ec6b312f67abb1": "Ybodychange",
        "1cb25812c9d6bb82a9a98bcf8e774fe0f50e7039": "Ybodychange",
        "3b643805c80a4595da8ebfab56ea078dde579422": "Ybodychange",
        "2d0842f320be9ac106ea1ffc8c5d3bbf72345ef5": "Ybodychange",
        "428609ab8b47e1127e6e1f2632f381ed941fffde": "Ybodychange",
        "0cd0b7045a93aa4fd7101c9857057a7f58861a2a": "Ybodychange",
        "5eae8136e40add7603cb73bf94a5b9df6e7098e9": "Ybodychange",
        "3fa0e8b8f4444c077085ad270feafcfd238d2719": "Ybodychange",
        "a4ecfa58fa632ae0b1ee715ab474889c67a2f105": "Yintroduced"
    },
    "changeHistoryDetails": {
        "7b2e9b390c448f6af405658163934c3276fc3b1c": {
            "type": "Ybodychange",
            "commitMessage": "GUI: added card hints in choose replacement effect dialog\n",
            "commitDate": "18/07/24 3:06 PM",
            "commitName": "7b2e9b390c448f6af405658163934c3276fc3b1c",
            "commitAuthor": "Oleg Agafonov",
            "commitDateOld": "25/01/24 7:30 PM",
            "commitNameOld": "5a809f6fe4108b201e3a5507d402269c26ab5bc4",
            "commitAuthorOld": "Evan Kranzler",
            "daysBetweenCommits": 174.77,
            "commitsBetweenForRepo": 1974,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,116 +1,119 @@\n     public boolean replaceEvent(GameEvent event, Game game) {\n         boolean caught = false;\n         Map<UUID, Set<UUID>> consumed = new HashMap<>();\n         do {\n             Map<ReplacementEffect, Set<Ability>> rEffects = getApplicableReplacementEffects(event, game);\n             // Remove all consumed effects (ability dependant)\n             for (Iterator<ReplacementEffect> it1 = rEffects.keySet().iterator(); it1.hasNext(); ) {\n                 ReplacementEffect entry = it1.next();\n                 if (consumed.containsKey(entry.getId()) /*&& !(entry instanceof CommanderReplacementEffect) */) { // 903.9.\n                     Set<UUID> consumedAbilitiesIds = consumed.get(entry.getId());\n                     if (rEffects.get(entry) == null || consumedAbilitiesIds.size() == rEffects.get(entry).size()) {\n                         it1.remove();\n                     } else {\n                         Iterator it = rEffects.get(entry).iterator();\n                         while (it.hasNext()) {\n                             Ability ability = (Ability) it.next();\n                             if (consumedAbilitiesIds.contains(ability.getId())) {\n                                 it.remove();\n                             }\n                         }\n                     }\n                 }\n             }\n             // no effects left, quit\n             if (rEffects.isEmpty()) {\n                 break;\n             }\n             int index;\n             boolean onlyOne = false;\n             if (rEffects.size() == 1) {\n                 ReplacementEffect effect = rEffects.keySet().iterator().next();\n                 Set<Ability> abilities;\n                 if (effect.getEffectType() == EffectType.REPLACEMENT) {\n                     abilities = replacementEffects.getAbility(effect.getId());\n                 } else {\n                     abilities = preventionEffects.getAbility(effect.getId());\n                 }\n                 if (abilities == null || abilities.size() == 1) {\n                     onlyOne = true;\n                 }\n             }\n             if (onlyOne) {\n                 index = 0;\n             } else {\n                 //20100716 - 616.1c\n                 Player player = game.getPlayer(event.getPlayerId());\n-                index = player.chooseReplacementEffect(getReplacementEffectsTexts(rEffects, game), game);\n+                Map<String, String> effectsMap = new LinkedHashMap<>();\n+                Map<String, MageObject> objectsMap = new LinkedHashMap<>();\n+                prepareReplacementEffectMaps(rEffects, game, effectsMap, objectsMap);\n+                index = player.chooseReplacementEffect(effectsMap, objectsMap, game);\n             }\n             // get the selected effect\n             int checked = 0;\n             ReplacementEffect rEffect = null;\n             Ability rAbility = null;\n             for (Map.Entry<ReplacementEffect, Set<Ability>> entry : rEffects.entrySet()) {\n                 if (entry.getValue() == null) {\n                     if (checked == index) {\n                         rEffect = entry.getKey();\n                         break;\n                     } else {\n                         checked++;\n                     }\n                 } else {\n                     Set<Ability> abilities = entry.getValue();\n                     int size = abilities.size();\n                     if (index > (checked + size - 1)) {\n                         checked += size;\n                     } else {\n                         rEffect = entry.getKey();\n                         Iterator it = abilities.iterator();\n                         while (it.hasNext() && rAbility == null) {\n                             if (checked == index) {\n                                 rAbility = (Ability) it.next();\n                             } else {\n                                 it.next();\n                                 checked++;\n                             }\n                         }\n                         break;\n                     }\n                 }\n             }\n \n             if (rEffect != null) {\n                 event.getAppliedEffects().add(rEffect.getId());\n                 caught = rEffect.replaceEvent(event, rAbility, game);\n                 if (Duration.OneUse.equals(rEffect.getDuration())) {\n                     rEffect.discard();\n                 }\n             }\n             if (caught) { // Event was completely replaced -> stop applying effects to it\n                 break;\n             }\n \n             // add the applied effect to the consumed effects\n             if (rEffect != null) {\n                 if (consumed.containsKey(rEffect.getId())) {\n                     Set<UUID> set = consumed.get(rEffect.getId());\n                     if (rAbility != null) {\n                         set.add(rAbility.getId());\n \n                     }\n                 } else {\n                     Set<UUID> set = new HashSet<>();\n                     if (rAbility != null) { // in case of AuraReplacementEffect or PlaneswalkerReplacementEffect there is no Ability\n                         set.add(rAbility.getId());\n                     }\n                     consumed.put(rEffect.getId(), set);\n                 }\n             }\n             // Must be called here for some effects to be able to work correctly\n             // For example: Vesuva copying a Dark Depth (VesuvaTest:testDarkDepth)\n             // This call should be removed if possible as replacement effects of EntersTheBattlefield events\n             // do no longer work correctly because the entering permanents are not yet on the battlefield (before they were).\n             // game.applyEffects();\n         } while (true);\n         return caught;\n     }\n\\ No newline at end of file\n",
            "actualSource": "    public boolean replaceEvent(GameEvent event, Game game) {\n        boolean caught = false;\n        Map<UUID, Set<UUID>> consumed = new HashMap<>();\n        do {\n            Map<ReplacementEffect, Set<Ability>> rEffects = getApplicableReplacementEffects(event, game);\n            // Remove all consumed effects (ability dependant)\n            for (Iterator<ReplacementEffect> it1 = rEffects.keySet().iterator(); it1.hasNext(); ) {\n                ReplacementEffect entry = it1.next();\n                if (consumed.containsKey(entry.getId()) /*&& !(entry instanceof CommanderReplacementEffect) */) { // 903.9.\n                    Set<UUID> consumedAbilitiesIds = consumed.get(entry.getId());\n                    if (rEffects.get(entry) == null || consumedAbilitiesIds.size() == rEffects.get(entry).size()) {\n                        it1.remove();\n                    } else {\n                        Iterator it = rEffects.get(entry).iterator();\n                        while (it.hasNext()) {\n                            Ability ability = (Ability) it.next();\n                            if (consumedAbilitiesIds.contains(ability.getId())) {\n                                it.remove();\n                            }\n                        }\n                    }\n                }\n            }\n            // no effects left, quit\n            if (rEffects.isEmpty()) {\n                break;\n            }\n            int index;\n            boolean onlyOne = false;\n            if (rEffects.size() == 1) {\n                ReplacementEffect effect = rEffects.keySet().iterator().next();\n                Set<Ability> abilities;\n                if (effect.getEffectType() == EffectType.REPLACEMENT) {\n                    abilities = replacementEffects.getAbility(effect.getId());\n                } else {\n                    abilities = preventionEffects.getAbility(effect.getId());\n                }\n                if (abilities == null || abilities.size() == 1) {\n                    onlyOne = true;\n                }\n            }\n            if (onlyOne) {\n                index = 0;\n            } else {\n                //20100716 - 616.1c\n                Player player = game.getPlayer(event.getPlayerId());\n                Map<String, String> effectsMap = new LinkedHashMap<>();\n                Map<String, MageObject> objectsMap = new LinkedHashMap<>();\n                prepareReplacementEffectMaps(rEffects, game, effectsMap, objectsMap);\n                index = player.chooseReplacementEffect(effectsMap, objectsMap, game);\n            }\n            // get the selected effect\n            int checked = 0;\n            ReplacementEffect rEffect = null;\n            Ability rAbility = null;\n            for (Map.Entry<ReplacementEffect, Set<Ability>> entry : rEffects.entrySet()) {\n                if (entry.getValue() == null) {\n                    if (checked == index) {\n                        rEffect = entry.getKey();\n                        break;\n                    } else {\n                        checked++;\n                    }\n                } else {\n                    Set<Ability> abilities = entry.getValue();\n                    int size = abilities.size();\n                    if (index > (checked + size - 1)) {\n                        checked += size;\n                    } else {\n                        rEffect = entry.getKey();\n                        Iterator it = abilities.iterator();\n                        while (it.hasNext() && rAbility == null) {\n                            if (checked == index) {\n                                rAbility = (Ability) it.next();\n                            } else {\n                                it.next();\n                                checked++;\n                            }\n                        }\n                        break;\n                    }\n                }\n            }\n\n            if (rEffect != null) {\n                event.getAppliedEffects().add(rEffect.getId());\n                caught = rEffect.replaceEvent(event, rAbility, game);\n                if (Duration.OneUse.equals(rEffect.getDuration())) {\n                    rEffect.discard();\n                }\n            }\n            if (caught) { // Event was completely replaced -> stop applying effects to it\n                break;\n            }\n\n            // add the applied effect to the consumed effects\n            if (rEffect != null) {\n                if (consumed.containsKey(rEffect.getId())) {\n                    Set<UUID> set = consumed.get(rEffect.getId());\n                    if (rAbility != null) {\n                        set.add(rAbility.getId());\n\n                    }\n                } else {\n                    Set<UUID> set = new HashSet<>();\n                    if (rAbility != null) { // in case of AuraReplacementEffect or PlaneswalkerReplacementEffect there is no Ability\n                        set.add(rAbility.getId());\n                    }\n                    consumed.put(rEffect.getId(), set);\n                }\n            }\n            // Must be called here for some effects to be able to work correctly\n            // For example: Vesuva copying a Dark Depth (VesuvaTest:testDarkDepth)\n            // This call should be removed if possible as replacement effects of EntersTheBattlefield events\n            // do no longer work correctly because the entering permanents are not yet on the battlefield (before they were).\n            // game.applyEffects();\n        } while (true);\n        return caught;\n    }",
            "path": "Mage/src/main/java/mage/abilities/effects/ContinuousEffects.java",
            "extendedDetails": {}
        },
        "b28bf51c02531dfb058be2552f0abc863b0725ad": {
            "type": "Ybodychange",
            "commitMessage": "* Reworked some more card movement handling (#4866).",
            "commitDate": "26/05/18 3:39 PM",
            "commitName": "b28bf51c02531dfb058be2552f0abc863b0725ad",
            "commitAuthor": "LevelX2",
            "commitDateOld": "25/05/18 6:22 PM",
            "commitNameOld": "fcc6174e5e7660e048b22cdd89a2e78ce201c499",
            "commitAuthorOld": "LevelX2",
            "daysBetweenCommits": 0.89,
            "commitsBetweenForRepo": 3,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,113 +1,116 @@\n     public boolean replaceEvent(GameEvent event, Game game) {\n         boolean caught = false;\n         Map<UUID, Set<UUID>> consumed = new HashMap<>();\n         do {\n             Map<ReplacementEffect, Set<Ability>> rEffects = getApplicableReplacementEffects(event, game);\n             // Remove all consumed effects (ability dependant)\n             for (Iterator<ReplacementEffect> it1 = rEffects.keySet().iterator(); it1.hasNext();) {\n                 ReplacementEffect entry = it1.next();\n                 if (consumed.containsKey(entry.getId()) /*&& !(entry instanceof CommanderReplacementEffect) */) { // 903.9.\n                     Set<UUID> consumedAbilitiesIds = consumed.get(entry.getId());\n                     if (rEffects.get(entry) == null || consumedAbilitiesIds.size() == rEffects.get(entry).size()) {\n                         it1.remove();\n                     } else {\n                         Iterator it = rEffects.get(entry).iterator();\n                         while (it.hasNext()) {\n                             Ability ability = (Ability) it.next();\n                             if (consumedAbilitiesIds.contains(ability.getId())) {\n                                 it.remove();\n                             }\n                         }\n                     }\n                 }\n             }\n             // no effects left, quit\n             if (rEffects.isEmpty()) {\n                 break;\n             }\n             int index;\n             boolean onlyOne = false;\n             if (rEffects.size() == 1) {\n                 ReplacementEffect effect = rEffects.keySet().iterator().next();\n                 Set<Ability> abilities;\n                 if (effect.getEffectType() == EffectType.REPLACEMENT) {\n                     abilities = replacementEffects.getAbility(effect.getId());\n                 } else {\n                     abilities = preventionEffects.getAbility(effect.getId());\n                 }\n                 if (abilities == null || abilities.size() == 1) {\n                     onlyOne = true;\n                 }\n             }\n             if (onlyOne) {\n                 index = 0;\n             } else {\n                 //20100716 - 616.1c\n                 Player player = game.getPlayer(event.getPlayerId());\n                 index = player.chooseReplacementEffect(getReplacementEffectsTexts(rEffects, game), game);\n             }\n             // get the selected effect\n             int checked = 0;\n             ReplacementEffect rEffect = null;\n             Ability rAbility = null;\n             for (Map.Entry<ReplacementEffect, Set<Ability>> entry : rEffects.entrySet()) {\n                 if (entry.getValue() == null) {\n                     if (checked == index) {\n                         rEffect = entry.getKey();\n                         break;\n                     } else {\n                         checked++;\n                     }\n                 } else {\n                     Set<Ability> abilities = entry.getValue();\n                     int size = abilities.size();\n                     if (index > (checked + size - 1)) {\n                         checked += size;\n                     } else {\n                         rEffect = entry.getKey();\n                         Iterator it = abilities.iterator();\n                         while (it.hasNext() && rAbility == null) {\n                             if (checked == index) {\n                                 rAbility = (Ability) it.next();\n                             } else {\n                                 it.next();\n                                 checked++;\n                             }\n                         }\n                         break;\n                     }\n                 }\n             }\n \n             if (rEffect != null) {\n                 event.getAppliedEffects().add(rEffect.getId());\n                 caught = rEffect.replaceEvent(event, rAbility, game);\n+                if (Duration.OneUse.equals(rEffect.getDuration())) {\n+                    rEffect.discard();\n+                }\n             }\n             if (caught) { // Event was completely replaced -> stop applying effects to it\n                 break;\n             }\n \n             // add the applied effect to the consumed effects\n             if (rEffect != null) {\n                 if (consumed.containsKey(rEffect.getId())) {\n                     Set<UUID> set = consumed.get(rEffect.getId());\n                     if (rAbility != null) {\n                         set.add(rAbility.getId());\n \n                     }\n                 } else {\n                     Set<UUID> set = new HashSet<>();\n                     if (rAbility != null) { // in case of AuraReplacementEffect or PlaneswalkerReplacementEffect there is no Ability\n                         set.add(rAbility.getId());\n                     }\n                     consumed.put(rEffect.getId(), set);\n                 }\n             }\n             // Must be called here for some effects to be able to work correctly\n             // For example: Vesuva copying a Dark Depth (VesuvaTest:testDarkDepth)\n             // This call should be removed if possible as replacement effects of EntersTheBattlefield events\n             // do no longer work correctly because the entering permanents are not yet on the battlefield (before they were).\n             // game.applyEffects();\n         } while (true);\n         return caught;\n     }\n\\ No newline at end of file\n",
            "actualSource": "    public boolean replaceEvent(GameEvent event, Game game) {\n        boolean caught = false;\n        Map<UUID, Set<UUID>> consumed = new HashMap<>();\n        do {\n            Map<ReplacementEffect, Set<Ability>> rEffects = getApplicableReplacementEffects(event, game);\n            // Remove all consumed effects (ability dependant)\n            for (Iterator<ReplacementEffect> it1 = rEffects.keySet().iterator(); it1.hasNext();) {\n                ReplacementEffect entry = it1.next();\n                if (consumed.containsKey(entry.getId()) /*&& !(entry instanceof CommanderReplacementEffect) */) { // 903.9.\n                    Set<UUID> consumedAbilitiesIds = consumed.get(entry.getId());\n                    if (rEffects.get(entry) == null || consumedAbilitiesIds.size() == rEffects.get(entry).size()) {\n                        it1.remove();\n                    } else {\n                        Iterator it = rEffects.get(entry).iterator();\n                        while (it.hasNext()) {\n                            Ability ability = (Ability) it.next();\n                            if (consumedAbilitiesIds.contains(ability.getId())) {\n                                it.remove();\n                            }\n                        }\n                    }\n                }\n            }\n            // no effects left, quit\n            if (rEffects.isEmpty()) {\n                break;\n            }\n            int index;\n            boolean onlyOne = false;\n            if (rEffects.size() == 1) {\n                ReplacementEffect effect = rEffects.keySet().iterator().next();\n                Set<Ability> abilities;\n                if (effect.getEffectType() == EffectType.REPLACEMENT) {\n                    abilities = replacementEffects.getAbility(effect.getId());\n                } else {\n                    abilities = preventionEffects.getAbility(effect.getId());\n                }\n                if (abilities == null || abilities.size() == 1) {\n                    onlyOne = true;\n                }\n            }\n            if (onlyOne) {\n                index = 0;\n            } else {\n                //20100716 - 616.1c\n                Player player = game.getPlayer(event.getPlayerId());\n                index = player.chooseReplacementEffect(getReplacementEffectsTexts(rEffects, game), game);\n            }\n            // get the selected effect\n            int checked = 0;\n            ReplacementEffect rEffect = null;\n            Ability rAbility = null;\n            for (Map.Entry<ReplacementEffect, Set<Ability>> entry : rEffects.entrySet()) {\n                if (entry.getValue() == null) {\n                    if (checked == index) {\n                        rEffect = entry.getKey();\n                        break;\n                    } else {\n                        checked++;\n                    }\n                } else {\n                    Set<Ability> abilities = entry.getValue();\n                    int size = abilities.size();\n                    if (index > (checked + size - 1)) {\n                        checked += size;\n                    } else {\n                        rEffect = entry.getKey();\n                        Iterator it = abilities.iterator();\n                        while (it.hasNext() && rAbility == null) {\n                            if (checked == index) {\n                                rAbility = (Ability) it.next();\n                            } else {\n                                it.next();\n                                checked++;\n                            }\n                        }\n                        break;\n                    }\n                }\n            }\n\n            if (rEffect != null) {\n                event.getAppliedEffects().add(rEffect.getId());\n                caught = rEffect.replaceEvent(event, rAbility, game);\n                if (Duration.OneUse.equals(rEffect.getDuration())) {\n                    rEffect.discard();\n                }\n            }\n            if (caught) { // Event was completely replaced -> stop applying effects to it\n                break;\n            }\n\n            // add the applied effect to the consumed effects\n            if (rEffect != null) {\n                if (consumed.containsKey(rEffect.getId())) {\n                    Set<UUID> set = consumed.get(rEffect.getId());\n                    if (rAbility != null) {\n                        set.add(rAbility.getId());\n\n                    }\n                } else {\n                    Set<UUID> set = new HashSet<>();\n                    if (rAbility != null) { // in case of AuraReplacementEffect or PlaneswalkerReplacementEffect there is no Ability\n                        set.add(rAbility.getId());\n                    }\n                    consumed.put(rEffect.getId(), set);\n                }\n            }\n            // Must be called here for some effects to be able to work correctly\n            // For example: Vesuva copying a Dark Depth (VesuvaTest:testDarkDepth)\n            // This call should be removed if possible as replacement effects of EntersTheBattlefield events\n            // do no longer work correctly because the entering permanents are not yet on the battlefield (before they were).\n            // game.applyEffects();\n        } while (true);\n        return caught;\n    }",
            "path": "Mage/src/main/java/mage/abilities/effects/ContinuousEffects.java",
            "extendedDetails": {}
        },
        "c2a48906031201b4781e79bd409663701c06d88b": {
            "type": "Ybodychange",
            "commitMessage": "* Fixed that commander replacement effect was wrongly only applied once (903.9). Simplified some replacement effects that move objects to other zones. (fixes #4585).",
            "commitDate": "11/03/18 3:48 PM",
            "commitName": "c2a48906031201b4781e79bd409663701c06d88b",
            "commitAuthor": "LevelX2",
            "commitDateOld": "27/01/18 3:26 AM",
            "commitNameOld": "1b191a5f938ef82f2b5ee51e5b08404bd3fdc76e",
            "commitAuthorOld": "Oleg Agafonov",
            "daysBetweenCommits": 43.47,
            "commitsBetweenForRepo": 399,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,113 +1,113 @@\n     public boolean replaceEvent(GameEvent event, Game game) {\n         boolean caught = false;\n         Map<UUID, Set<UUID>> consumed = new HashMap<>();\n         do {\n             Map<ReplacementEffect, Set<Ability>> rEffects = getApplicableReplacementEffects(event, game);\n             // Remove all consumed effects (ability dependant)\n             for (Iterator<ReplacementEffect> it1 = rEffects.keySet().iterator(); it1.hasNext();) {\n                 ReplacementEffect entry = it1.next();\n-                if (consumed.containsKey(entry.getId())) {\n+                if (consumed.containsKey(entry.getId()) /*&& !(entry instanceof CommanderReplacementEffect) */) { // 903.9. \n                     Set<UUID> consumedAbilitiesIds = consumed.get(entry.getId());\n                     if (rEffects.get(entry) == null || consumedAbilitiesIds.size() == rEffects.get(entry).size()) {\n                         it1.remove();\n                     } else {\n                         Iterator it = rEffects.get(entry).iterator();\n                         while (it.hasNext()) {\n                             Ability ability = (Ability) it.next();\n                             if (consumedAbilitiesIds.contains(ability.getId())) {\n                                 it.remove();\n                             }\n                         }\n                     }\n                 }\n             }\n             // no effects left, quit\n             if (rEffects.isEmpty()) {\n                 break;\n             }\n             int index;\n             boolean onlyOne = false;\n             if (rEffects.size() == 1) {\n                 ReplacementEffect effect = rEffects.keySet().iterator().next();\n                 Set<Ability> abilities;\n                 if (effect.getEffectType() == EffectType.REPLACEMENT) {\n                     abilities = replacementEffects.getAbility(effect.getId());\n                 } else {\n                     abilities = preventionEffects.getAbility(effect.getId());\n                 }\n                 if (abilities == null || abilities.size() == 1) {\n                     onlyOne = true;\n                 }\n             }\n             if (onlyOne) {\n                 index = 0;\n             } else {\n                 //20100716 - 616.1c\n                 Player player = game.getPlayer(event.getPlayerId());\n                 index = player.chooseReplacementEffect(getReplacementEffectsTexts(rEffects, game), game);\n             }\n             // get the selected effect\n             int checked = 0;\n             ReplacementEffect rEffect = null;\n             Ability rAbility = null;\n             for (Map.Entry<ReplacementEffect, Set<Ability>> entry : rEffects.entrySet()) {\n                 if (entry.getValue() == null) {\n                     if (checked == index) {\n                         rEffect = entry.getKey();\n                         break;\n                     } else {\n                         checked++;\n                     }\n                 } else {\n                     Set<Ability> abilities = entry.getValue();\n                     int size = abilities.size();\n                     if (index > (checked + size - 1)) {\n                         checked += size;\n                     } else {\n                         rEffect = entry.getKey();\n                         Iterator it = abilities.iterator();\n                         while (it.hasNext() && rAbility == null) {\n                             if (checked == index) {\n                                 rAbility = (Ability) it.next();\n                             } else {\n                                 it.next();\n                                 checked++;\n                             }\n                         }\n                         break;\n                     }\n                 }\n             }\n \n             if (rEffect != null) {\n                 event.getAppliedEffects().add(rEffect.getId());\n                 caught = rEffect.replaceEvent(event, rAbility, game);\n             }\n             if (caught) { // Event was completely replaced -> stop applying effects to it\n                 break;\n             }\n \n             // add the applied effect to the consumed effects\n             if (rEffect != null) {\n                 if (consumed.containsKey(rEffect.getId())) {\n                     Set<UUID> set = consumed.get(rEffect.getId());\n                     if (rAbility != null) {\n                         set.add(rAbility.getId());\n \n                     }\n                 } else {\n                     Set<UUID> set = new HashSet<>();\n                     if (rAbility != null) { // in case of AuraReplacementEffect or PlaneswalkerReplacementEffect there is no Ability\n                         set.add(rAbility.getId());\n                     }\n                     consumed.put(rEffect.getId(), set);\n                 }\n             }\n             // Must be called here for some effects to be able to work correctly\n             // For example: Vesuva copying a Dark Depth (VesuvaTest:testDarkDepth)\n             // This call should be removed if possible as replacement effects of EntersTheBattlefield events\n             // do no longer work correctly because the entering permanents are not yet on the battlefield (before they were).\n             // game.applyEffects();\n         } while (true);\n         return caught;\n     }\n\\ No newline at end of file\n",
            "actualSource": "    public boolean replaceEvent(GameEvent event, Game game) {\n        boolean caught = false;\n        Map<UUID, Set<UUID>> consumed = new HashMap<>();\n        do {\n            Map<ReplacementEffect, Set<Ability>> rEffects = getApplicableReplacementEffects(event, game);\n            // Remove all consumed effects (ability dependant)\n            for (Iterator<ReplacementEffect> it1 = rEffects.keySet().iterator(); it1.hasNext();) {\n                ReplacementEffect entry = it1.next();\n                if (consumed.containsKey(entry.getId()) /*&& !(entry instanceof CommanderReplacementEffect) */) { // 903.9. \n                    Set<UUID> consumedAbilitiesIds = consumed.get(entry.getId());\n                    if (rEffects.get(entry) == null || consumedAbilitiesIds.size() == rEffects.get(entry).size()) {\n                        it1.remove();\n                    } else {\n                        Iterator it = rEffects.get(entry).iterator();\n                        while (it.hasNext()) {\n                            Ability ability = (Ability) it.next();\n                            if (consumedAbilitiesIds.contains(ability.getId())) {\n                                it.remove();\n                            }\n                        }\n                    }\n                }\n            }\n            // no effects left, quit\n            if (rEffects.isEmpty()) {\n                break;\n            }\n            int index;\n            boolean onlyOne = false;\n            if (rEffects.size() == 1) {\n                ReplacementEffect effect = rEffects.keySet().iterator().next();\n                Set<Ability> abilities;\n                if (effect.getEffectType() == EffectType.REPLACEMENT) {\n                    abilities = replacementEffects.getAbility(effect.getId());\n                } else {\n                    abilities = preventionEffects.getAbility(effect.getId());\n                }\n                if (abilities == null || abilities.size() == 1) {\n                    onlyOne = true;\n                }\n            }\n            if (onlyOne) {\n                index = 0;\n            } else {\n                //20100716 - 616.1c\n                Player player = game.getPlayer(event.getPlayerId());\n                index = player.chooseReplacementEffect(getReplacementEffectsTexts(rEffects, game), game);\n            }\n            // get the selected effect\n            int checked = 0;\n            ReplacementEffect rEffect = null;\n            Ability rAbility = null;\n            for (Map.Entry<ReplacementEffect, Set<Ability>> entry : rEffects.entrySet()) {\n                if (entry.getValue() == null) {\n                    if (checked == index) {\n                        rEffect = entry.getKey();\n                        break;\n                    } else {\n                        checked++;\n                    }\n                } else {\n                    Set<Ability> abilities = entry.getValue();\n                    int size = abilities.size();\n                    if (index > (checked + size - 1)) {\n                        checked += size;\n                    } else {\n                        rEffect = entry.getKey();\n                        Iterator it = abilities.iterator();\n                        while (it.hasNext() && rAbility == null) {\n                            if (checked == index) {\n                                rAbility = (Ability) it.next();\n                            } else {\n                                it.next();\n                                checked++;\n                            }\n                        }\n                        break;\n                    }\n                }\n            }\n\n            if (rEffect != null) {\n                event.getAppliedEffects().add(rEffect.getId());\n                caught = rEffect.replaceEvent(event, rAbility, game);\n            }\n            if (caught) { // Event was completely replaced -> stop applying effects to it\n                break;\n            }\n\n            // add the applied effect to the consumed effects\n            if (rEffect != null) {\n                if (consumed.containsKey(rEffect.getId())) {\n                    Set<UUID> set = consumed.get(rEffect.getId());\n                    if (rAbility != null) {\n                        set.add(rAbility.getId());\n\n                    }\n                } else {\n                    Set<UUID> set = new HashSet<>();\n                    if (rAbility != null) { // in case of AuraReplacementEffect or PlaneswalkerReplacementEffect there is no Ability\n                        set.add(rAbility.getId());\n                    }\n                    consumed.put(rEffect.getId(), set);\n                }\n            }\n            // Must be called here for some effects to be able to work correctly\n            // For example: Vesuva copying a Dark Depth (VesuvaTest:testDarkDepth)\n            // This call should be removed if possible as replacement effects of EntersTheBattlefield events\n            // do no longer work correctly because the entering permanents are not yet on the battlefield (before they were).\n            // game.applyEffects();\n        } while (true);\n        return caught;\n    }",
            "path": "Mage/src/main/java/mage/abilities/effects/ContinuousEffects.java",
            "extendedDetails": {}
        },
        "905829561e527b07644a29ac09484e5ffd75d436": {
            "type": "Ybodychange",
            "commitMessage": "talk to interfaces rather than implementations\n",
            "commitDate": "16/07/17 4:08 AM",
            "commitName": "905829561e527b07644a29ac09484e5ffd75d436",
            "commitAuthor": "igoudt",
            "commitDateOld": "28/05/17 5:24 AM",
            "commitNameOld": "83c3dc05b2b535f5055c46f4388f68606f32132c",
            "commitAuthorOld": "igoudt",
            "daysBetweenCommits": 48.95,
            "commitsBetweenForRepo": 338,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,113 +1,113 @@\n     public boolean replaceEvent(GameEvent event, Game game) {\n         boolean caught = false;\n-        HashMap<UUID, HashSet<UUID>> consumed = new HashMap<>();\n+        Map<UUID, Set<UUID>> consumed = new HashMap<>();\n         do {\n-            HashMap<ReplacementEffect, HashSet<Ability>> rEffects = getApplicableReplacementEffects(event, game);\n+            Map<ReplacementEffect, Set<Ability>> rEffects = getApplicableReplacementEffects(event, game);\n             // Remove all consumed effects (ability dependant)\n             for (Iterator<ReplacementEffect> it1 = rEffects.keySet().iterator(); it1.hasNext();) {\n                 ReplacementEffect entry = it1.next();\n                 if (consumed.containsKey(entry.getId())) {\n-                    HashSet<UUID> consumedAbilitiesIds = consumed.get(entry.getId());\n+                    Set<UUID> consumedAbilitiesIds = consumed.get(entry.getId());\n                     if (rEffects.get(entry) == null || consumedAbilitiesIds.size() == rEffects.get(entry).size()) {\n                         it1.remove();\n                     } else {\n                         Iterator it = rEffects.get(entry).iterator();\n                         while (it.hasNext()) {\n                             Ability ability = (Ability) it.next();\n                             if (consumedAbilitiesIds.contains(ability.getId())) {\n                                 it.remove();\n                             }\n                         }\n                     }\n                 }\n             }\n             // no effects left, quit\n             if (rEffects.isEmpty()) {\n                 break;\n             }\n             int index;\n             boolean onlyOne = false;\n             if (rEffects.size() == 1) {\n                 ReplacementEffect effect = rEffects.keySet().iterator().next();\n-                HashSet<Ability> abilities;\n+                Set<Ability> abilities;\n                 if (effect.getEffectType() == EffectType.REPLACEMENT) {\n                     abilities = replacementEffects.getAbility(effect.getId());\n                 } else {\n                     abilities = preventionEffects.getAbility(effect.getId());\n                 }\n                 if (abilities == null || abilities.size() == 1) {\n                     onlyOne = true;\n                 }\n             }\n             if (onlyOne) {\n                 index = 0;\n             } else {\n                 //20100716 - 616.1c\n                 Player player = game.getPlayer(event.getPlayerId());\n                 index = player.chooseReplacementEffect(getReplacementEffectsTexts(rEffects, game), game);\n             }\n             // get the selected effect\n             int checked = 0;\n             ReplacementEffect rEffect = null;\n             Ability rAbility = null;\n-            for (Map.Entry<ReplacementEffect, HashSet<Ability>> entry : rEffects.entrySet()) {\n+            for (Map.Entry<ReplacementEffect, Set<Ability>> entry : rEffects.entrySet()) {\n                 if (entry.getValue() == null) {\n                     if (checked == index) {\n                         rEffect = entry.getKey();\n                         break;\n                     } else {\n                         checked++;\n                     }\n                 } else {\n-                    HashSet<Ability> abilities = entry.getValue();\n+                    Set<Ability> abilities = entry.getValue();\n                     int size = abilities.size();\n                     if (index > (checked + size - 1)) {\n                         checked += size;\n                     } else {\n                         rEffect = entry.getKey();\n                         Iterator it = abilities.iterator();\n                         while (it.hasNext() && rAbility == null) {\n                             if (checked == index) {\n                                 rAbility = (Ability) it.next();\n                             } else {\n                                 it.next();\n                                 checked++;\n                             }\n                         }\n                         break;\n                     }\n                 }\n             }\n \n             if (rEffect != null) {\n                 event.getAppliedEffects().add(rEffect.getId());\n                 caught = rEffect.replaceEvent(event, rAbility, game);\n             }\n             if (caught) { // Event was completely replaced -> stop applying effects to it\n                 break;\n             }\n \n             // add the applied effect to the consumed effects\n             if (rEffect != null) {\n                 if (consumed.containsKey(rEffect.getId())) {\n-                    HashSet<UUID> set = consumed.get(rEffect.getId());\n+                    Set<UUID> set = consumed.get(rEffect.getId());\n                     if (rAbility != null) {\n                         set.add(rAbility.getId());\n \n                     }\n                 } else {\n-                    HashSet<UUID> set = new HashSet<>();\n+                    Set<UUID> set = new HashSet<>();\n                     if (rAbility != null) { // in case of AuraReplacementEffect or PlaneswalkerReplacementEffect there is no Ability\n                         set.add(rAbility.getId());\n                     }\n                     consumed.put(rEffect.getId(), set);\n                 }\n             }\n             // Must be called here for some effects to be able to work correctly\n             // For example: Vesuva copying a Dark Depth (VesuvaTest:testDarkDepth)\n             // This call should be removed if possible as replacement effects of EntersTheBattlefield events\n             // do no longer work correctly because the entering permanents are not yet on the battlefield (before they were).\n             // game.applyEffects();\n         } while (true);\n         return caught;\n     }\n\\ No newline at end of file\n",
            "actualSource": "    public boolean replaceEvent(GameEvent event, Game game) {\n        boolean caught = false;\n        Map<UUID, Set<UUID>> consumed = new HashMap<>();\n        do {\n            Map<ReplacementEffect, Set<Ability>> rEffects = getApplicableReplacementEffects(event, game);\n            // Remove all consumed effects (ability dependant)\n            for (Iterator<ReplacementEffect> it1 = rEffects.keySet().iterator(); it1.hasNext();) {\n                ReplacementEffect entry = it1.next();\n                if (consumed.containsKey(entry.getId())) {\n                    Set<UUID> consumedAbilitiesIds = consumed.get(entry.getId());\n                    if (rEffects.get(entry) == null || consumedAbilitiesIds.size() == rEffects.get(entry).size()) {\n                        it1.remove();\n                    } else {\n                        Iterator it = rEffects.get(entry).iterator();\n                        while (it.hasNext()) {\n                            Ability ability = (Ability) it.next();\n                            if (consumedAbilitiesIds.contains(ability.getId())) {\n                                it.remove();\n                            }\n                        }\n                    }\n                }\n            }\n            // no effects left, quit\n            if (rEffects.isEmpty()) {\n                break;\n            }\n            int index;\n            boolean onlyOne = false;\n            if (rEffects.size() == 1) {\n                ReplacementEffect effect = rEffects.keySet().iterator().next();\n                Set<Ability> abilities;\n                if (effect.getEffectType() == EffectType.REPLACEMENT) {\n                    abilities = replacementEffects.getAbility(effect.getId());\n                } else {\n                    abilities = preventionEffects.getAbility(effect.getId());\n                }\n                if (abilities == null || abilities.size() == 1) {\n                    onlyOne = true;\n                }\n            }\n            if (onlyOne) {\n                index = 0;\n            } else {\n                //20100716 - 616.1c\n                Player player = game.getPlayer(event.getPlayerId());\n                index = player.chooseReplacementEffect(getReplacementEffectsTexts(rEffects, game), game);\n            }\n            // get the selected effect\n            int checked = 0;\n            ReplacementEffect rEffect = null;\n            Ability rAbility = null;\n            for (Map.Entry<ReplacementEffect, Set<Ability>> entry : rEffects.entrySet()) {\n                if (entry.getValue() == null) {\n                    if (checked == index) {\n                        rEffect = entry.getKey();\n                        break;\n                    } else {\n                        checked++;\n                    }\n                } else {\n                    Set<Ability> abilities = entry.getValue();\n                    int size = abilities.size();\n                    if (index > (checked + size - 1)) {\n                        checked += size;\n                    } else {\n                        rEffect = entry.getKey();\n                        Iterator it = abilities.iterator();\n                        while (it.hasNext() && rAbility == null) {\n                            if (checked == index) {\n                                rAbility = (Ability) it.next();\n                            } else {\n                                it.next();\n                                checked++;\n                            }\n                        }\n                        break;\n                    }\n                }\n            }\n\n            if (rEffect != null) {\n                event.getAppliedEffects().add(rEffect.getId());\n                caught = rEffect.replaceEvent(event, rAbility, game);\n            }\n            if (caught) { // Event was completely replaced -> stop applying effects to it\n                break;\n            }\n\n            // add the applied effect to the consumed effects\n            if (rEffect != null) {\n                if (consumed.containsKey(rEffect.getId())) {\n                    Set<UUID> set = consumed.get(rEffect.getId());\n                    if (rAbility != null) {\n                        set.add(rAbility.getId());\n\n                    }\n                } else {\n                    Set<UUID> set = new HashSet<>();\n                    if (rAbility != null) { // in case of AuraReplacementEffect or PlaneswalkerReplacementEffect there is no Ability\n                        set.add(rAbility.getId());\n                    }\n                    consumed.put(rEffect.getId(), set);\n                }\n            }\n            // Must be called here for some effects to be able to work correctly\n            // For example: Vesuva copying a Dark Depth (VesuvaTest:testDarkDepth)\n            // This call should be removed if possible as replacement effects of EntersTheBattlefield events\n            // do no longer work correctly because the entering permanents are not yet on the battlefield (before they were).\n            // game.applyEffects();\n        } while (true);\n        return caught;\n    }",
            "path": "Mage/src/main/java/mage/abilities/effects/ContinuousEffects.java",
            "extendedDetails": {}
        },
        "d93061c0bc67bac27aa774f291a31b58cb793826": {
            "type": "Ybodychange",
            "commitMessage": "Equals should be compared with == but not equals()\n",
            "commitDate": "22/03/17 6:50 AM",
            "commitName": "d93061c0bc67bac27aa774f291a31b58cb793826",
            "commitAuthor": "vraskulin",
            "commitDateOld": "28/02/17 4:46 AM",
            "commitNameOld": "11dc1e10f14a4dc34cd72c7404789146b394322f",
            "commitAuthorOld": "vraskulin",
            "daysBetweenCommits": 22.04,
            "commitsBetweenForRepo": 164,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,113 +1,113 @@\n     public boolean replaceEvent(GameEvent event, Game game) {\n         boolean caught = false;\n         HashMap<UUID, HashSet<UUID>> consumed = new HashMap<>();\n         do {\n             HashMap<ReplacementEffect, HashSet<Ability>> rEffects = getApplicableReplacementEffects(event, game);\n             // Remove all consumed effects (ability dependant)\n             for (Iterator<ReplacementEffect> it1 = rEffects.keySet().iterator(); it1.hasNext(); ) {\n                 ReplacementEffect entry = it1.next();\n                 if (consumed.containsKey(entry.getId())) {\n                     HashSet<UUID> consumedAbilitiesIds = consumed.get(entry.getId());\n                     if (rEffects.get(entry) == null || consumedAbilitiesIds.size() == rEffects.get(entry).size()) {\n                         it1.remove();\n                     } else {\n                         Iterator it = rEffects.get(entry).iterator();\n                         while (it.hasNext()) {\n                             Ability ability = (Ability) it.next();\n                             if (consumedAbilitiesIds.contains(ability.getId())) {\n                                 it.remove();\n                             }\n                         }\n                     }\n                 }\n             }\n             // no effects left, quit\n             if (rEffects.isEmpty()) {\n                 break;\n             }\n             int index;\n             boolean onlyOne = false;\n             if (rEffects.size() == 1) {\n                 ReplacementEffect effect = rEffects.keySet().iterator().next();\n                 HashSet<Ability> abilities;\n-                if (effect.getEffectType().equals(EffectType.REPLACEMENT)) {\n+                if (effect.getEffectType() == EffectType.REPLACEMENT) {\n                     abilities = replacementEffects.getAbility(effect.getId());\n                 } else {\n                     abilities = preventionEffects.getAbility(effect.getId());\n                 }\n                 if (abilities == null || abilities.size() == 1) {\n                     onlyOne = true;\n                 }\n             }\n             if (onlyOne) {\n                 index = 0;\n             } else {\n                 //20100716 - 616.1c\n                 Player player = game.getPlayer(event.getPlayerId());\n                 index = player.chooseReplacementEffect(getReplacementEffectsTexts(rEffects, game), game);\n             }\n             // get the selected effect\n             int checked = 0;\n             ReplacementEffect rEffect = null;\n             Ability rAbility = null;\n             for (Map.Entry<ReplacementEffect, HashSet<Ability>> entry : rEffects.entrySet()) {\n                 if (entry.getValue() == null) {\n                     if (checked == index) {\n                         rEffect = entry.getKey();\n                         break;\n                     } else {\n                         checked++;\n                     }\n                 } else {\n                     HashSet<Ability> abilities = entry.getValue();\n                     int size = abilities.size();\n                     if (index > (checked + size - 1)) {\n                         checked += size;\n                     } else {\n                         rEffect = entry.getKey();\n                         Iterator it = abilities.iterator();\n                         while (it.hasNext() && rAbility == null) {\n                             if (checked == index) {\n                                 rAbility = (Ability) it.next();\n                             } else {\n                                 it.next();\n                                 checked++;\n                             }\n                         }\n                         break;\n                     }\n                 }\n             }\n \n             if (rEffect != null) {\n                 event.getAppliedEffects().add(rEffect.getId());\n                 caught = rEffect.replaceEvent(event, rAbility, game);\n             }\n             if (caught) { // Event was completely replaced -> stop applying effects to it\n                 break;\n             }\n \n             // add the applied effect to the consumed effects\n             if (rEffect != null) {\n                 if (consumed.containsKey(rEffect.getId())) {\n                     HashSet<UUID> set = consumed.get(rEffect.getId());\n                     if (rAbility != null) {\n                         set.add(rAbility.getId());\n \n                     }\n                 } else {\n                     HashSet<UUID> set = new HashSet<>();\n                     if (rAbility != null) { // in case of AuraReplacementEffect or PlaneswalkerReplacementEffect there is no Ability\n                         set.add(rAbility.getId());\n                     }\n                     consumed.put(rEffect.getId(), set);\n                 }\n             }\n             // Must be called here for some effects to be able to work correctly\n             // For example: Vesuva copying a Dark Depth (VesuvaTest:testDarkDepth)\n             // This call should be removed if possible as replacement effects of EntersTheBattlefield events\n             // do no longer work correctly because the entering permanents are not yet on the battlefield (before they were).\n             // game.applyEffects();\n         } while (true);\n         return caught;\n     }\n\\ No newline at end of file\n",
            "actualSource": "    public boolean replaceEvent(GameEvent event, Game game) {\n        boolean caught = false;\n        HashMap<UUID, HashSet<UUID>> consumed = new HashMap<>();\n        do {\n            HashMap<ReplacementEffect, HashSet<Ability>> rEffects = getApplicableReplacementEffects(event, game);\n            // Remove all consumed effects (ability dependant)\n            for (Iterator<ReplacementEffect> it1 = rEffects.keySet().iterator(); it1.hasNext(); ) {\n                ReplacementEffect entry = it1.next();\n                if (consumed.containsKey(entry.getId())) {\n                    HashSet<UUID> consumedAbilitiesIds = consumed.get(entry.getId());\n                    if (rEffects.get(entry) == null || consumedAbilitiesIds.size() == rEffects.get(entry).size()) {\n                        it1.remove();\n                    } else {\n                        Iterator it = rEffects.get(entry).iterator();\n                        while (it.hasNext()) {\n                            Ability ability = (Ability) it.next();\n                            if (consumedAbilitiesIds.contains(ability.getId())) {\n                                it.remove();\n                            }\n                        }\n                    }\n                }\n            }\n            // no effects left, quit\n            if (rEffects.isEmpty()) {\n                break;\n            }\n            int index;\n            boolean onlyOne = false;\n            if (rEffects.size() == 1) {\n                ReplacementEffect effect = rEffects.keySet().iterator().next();\n                HashSet<Ability> abilities;\n                if (effect.getEffectType() == EffectType.REPLACEMENT) {\n                    abilities = replacementEffects.getAbility(effect.getId());\n                } else {\n                    abilities = preventionEffects.getAbility(effect.getId());\n                }\n                if (abilities == null || abilities.size() == 1) {\n                    onlyOne = true;\n                }\n            }\n            if (onlyOne) {\n                index = 0;\n            } else {\n                //20100716 - 616.1c\n                Player player = game.getPlayer(event.getPlayerId());\n                index = player.chooseReplacementEffect(getReplacementEffectsTexts(rEffects, game), game);\n            }\n            // get the selected effect\n            int checked = 0;\n            ReplacementEffect rEffect = null;\n            Ability rAbility = null;\n            for (Map.Entry<ReplacementEffect, HashSet<Ability>> entry : rEffects.entrySet()) {\n                if (entry.getValue() == null) {\n                    if (checked == index) {\n                        rEffect = entry.getKey();\n                        break;\n                    } else {\n                        checked++;\n                    }\n                } else {\n                    HashSet<Ability> abilities = entry.getValue();\n                    int size = abilities.size();\n                    if (index > (checked + size - 1)) {\n                        checked += size;\n                    } else {\n                        rEffect = entry.getKey();\n                        Iterator it = abilities.iterator();\n                        while (it.hasNext() && rAbility == null) {\n                            if (checked == index) {\n                                rAbility = (Ability) it.next();\n                            } else {\n                                it.next();\n                                checked++;\n                            }\n                        }\n                        break;\n                    }\n                }\n            }\n\n            if (rEffect != null) {\n                event.getAppliedEffects().add(rEffect.getId());\n                caught = rEffect.replaceEvent(event, rAbility, game);\n            }\n            if (caught) { // Event was completely replaced -> stop applying effects to it\n                break;\n            }\n\n            // add the applied effect to the consumed effects\n            if (rEffect != null) {\n                if (consumed.containsKey(rEffect.getId())) {\n                    HashSet<UUID> set = consumed.get(rEffect.getId());\n                    if (rAbility != null) {\n                        set.add(rAbility.getId());\n\n                    }\n                } else {\n                    HashSet<UUID> set = new HashSet<>();\n                    if (rAbility != null) { // in case of AuraReplacementEffect or PlaneswalkerReplacementEffect there is no Ability\n                        set.add(rAbility.getId());\n                    }\n                    consumed.put(rEffect.getId(), set);\n                }\n            }\n            // Must be called here for some effects to be able to work correctly\n            // For example: Vesuva copying a Dark Depth (VesuvaTest:testDarkDepth)\n            // This call should be removed if possible as replacement effects of EntersTheBattlefield events\n            // do no longer work correctly because the entering permanents are not yet on the battlefield (before they were).\n            // game.applyEffects();\n        } while (true);\n        return caught;\n    }",
            "path": "Mage/src/main/java/mage/abilities/effects/ContinuousEffects.java",
            "extendedDetails": {}
        },
        "972ed6a3f294bd2a67d5c65b2b9b96ad4bc44512": {
            "type": "Ybodychange",
            "commitMessage": "changed enum comparison to ==.\nisDependentTo returns empty set rather than null\n",
            "commitDate": "19/02/17 4:38 PM",
            "commitName": "972ed6a3f294bd2a67d5c65b2b9b96ad4bc44512",
            "commitAuthor": "ingmargoudt",
            "commitDateOld": "06/02/17 5:32 AM",
            "commitNameOld": "0557b5e89cbed0490adeb673be6a42375513ffcd",
            "commitAuthorOld": "vraskulin",
            "daysBetweenCommits": 13.46,
            "commitsBetweenForRepo": 57,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,114 +1,113 @@\n     public boolean replaceEvent(GameEvent event, Game game) {\n         boolean caught = false;\n         HashMap<UUID, HashSet<UUID>> consumed = new HashMap<>();\n         do {\n             HashMap<ReplacementEffect, HashSet<Ability>> rEffects = getApplicableReplacementEffects(event, game);\n             // Remove all consumed effects (ability dependant)\n-            for (Iterator<ReplacementEffect> it1 = rEffects.keySet().iterator(); it1.hasNext();) {\n+            for (Iterator<ReplacementEffect> it1 = rEffects.keySet().iterator(); it1.hasNext(); ) {\n                 ReplacementEffect entry = it1.next();\n                 if (consumed.containsKey(entry.getId())) {\n                     HashSet<UUID> consumedAbilitiesIds = consumed.get(entry.getId());\n                     if (rEffects.get(entry) == null || consumedAbilitiesIds.size() == rEffects.get(entry).size()) {\n                         it1.remove();\n                     } else {\n                         Iterator it = rEffects.get(entry).iterator();\n                         while (it.hasNext()) {\n                             Ability ability = (Ability) it.next();\n                             if (consumedAbilitiesIds.contains(ability.getId())) {\n                                 it.remove();\n                             }\n                         }\n                     }\n                 }\n             }\n             // no effects left, quit\n             if (rEffects.isEmpty()) {\n                 break;\n             }\n             int index;\n             boolean onlyOne = false;\n             if (rEffects.size() == 1) {\n                 ReplacementEffect effect = rEffects.keySet().iterator().next();\n                 HashSet<Ability> abilities;\n                 if (effect.getEffectType().equals(EffectType.REPLACEMENT)) {\n                     abilities = replacementEffects.getAbility(effect.getId());\n                 } else {\n                     abilities = preventionEffects.getAbility(effect.getId());\n                 }\n                 if (abilities == null || abilities.size() == 1) {\n                     onlyOne = true;\n                 }\n             }\n             if (onlyOne) {\n                 index = 0;\n             } else {\n                 //20100716 - 616.1c\n                 Player player = game.getPlayer(event.getPlayerId());\n                 index = player.chooseReplacementEffect(getReplacementEffectsTexts(rEffects, game), game);\n             }\n             // get the selected effect\n             int checked = 0;\n             ReplacementEffect rEffect = null;\n             Ability rAbility = null;\n             for (Map.Entry<ReplacementEffect, HashSet<Ability>> entry : rEffects.entrySet()) {\n                 if (entry.getValue() == null) {\n                     if (checked == index) {\n                         rEffect = entry.getKey();\n                         break;\n                     } else {\n                         checked++;\n                     }\n                 } else {\n                     HashSet<Ability> abilities = entry.getValue();\n                     int size = abilities.size();\n                     if (index > (checked + size - 1)) {\n                         checked += size;\n                     } else {\n                         rEffect = entry.getKey();\n                         Iterator it = abilities.iterator();\n                         while (it.hasNext() && rAbility == null) {\n                             if (checked == index) {\n                                 rAbility = (Ability) it.next();\n                             } else {\n                                 it.next();\n                                 checked++;\n                             }\n                         }\n                         break;\n                     }\n                 }\n             }\n \n             if (rEffect != null) {\n                 event.getAppliedEffects().add(rEffect.getId());\n                 caught = rEffect.replaceEvent(event, rAbility, game);\n             }\n             if (caught) { // Event was completely replaced -> stop applying effects to it\n                 break;\n             }\n \n             // add the applied effect to the consumed effects\n             if (rEffect != null) {\n                 if (consumed.containsKey(rEffect.getId())) {\n                     HashSet<UUID> set = consumed.get(rEffect.getId());\n                     if (rAbility != null) {\n-                        if (!set.contains(rAbility.getId())) {\n-                            set.add(rAbility.getId());\n-                        }\n+                        set.add(rAbility.getId());\n+\n                     }\n                 } else {\n                     HashSet<UUID> set = new HashSet<>();\n                     if (rAbility != null) { // in case of AuraReplacementEffect or PlaneswalkerReplacementEffect there is no Ability\n                         set.add(rAbility.getId());\n                     }\n                     consumed.put(rEffect.getId(), set);\n                 }\n             }\n             // Must be called here for some effects to be able to work correctly\n             // For example: Vesuva copying a Dark Depth (VesuvaTest:testDarkDepth)\n             // This call should be removed if possible as replacement effects of EntersTheBattlefield events\n             // do no longer work correctly because the entering permanents are not yet on the battlefield (before they were).\n             // game.applyEffects();\n         } while (true);\n         return caught;\n     }\n\\ No newline at end of file\n",
            "actualSource": "    public boolean replaceEvent(GameEvent event, Game game) {\n        boolean caught = false;\n        HashMap<UUID, HashSet<UUID>> consumed = new HashMap<>();\n        do {\n            HashMap<ReplacementEffect, HashSet<Ability>> rEffects = getApplicableReplacementEffects(event, game);\n            // Remove all consumed effects (ability dependant)\n            for (Iterator<ReplacementEffect> it1 = rEffects.keySet().iterator(); it1.hasNext(); ) {\n                ReplacementEffect entry = it1.next();\n                if (consumed.containsKey(entry.getId())) {\n                    HashSet<UUID> consumedAbilitiesIds = consumed.get(entry.getId());\n                    if (rEffects.get(entry) == null || consumedAbilitiesIds.size() == rEffects.get(entry).size()) {\n                        it1.remove();\n                    } else {\n                        Iterator it = rEffects.get(entry).iterator();\n                        while (it.hasNext()) {\n                            Ability ability = (Ability) it.next();\n                            if (consumedAbilitiesIds.contains(ability.getId())) {\n                                it.remove();\n                            }\n                        }\n                    }\n                }\n            }\n            // no effects left, quit\n            if (rEffects.isEmpty()) {\n                break;\n            }\n            int index;\n            boolean onlyOne = false;\n            if (rEffects.size() == 1) {\n                ReplacementEffect effect = rEffects.keySet().iterator().next();\n                HashSet<Ability> abilities;\n                if (effect.getEffectType().equals(EffectType.REPLACEMENT)) {\n                    abilities = replacementEffects.getAbility(effect.getId());\n                } else {\n                    abilities = preventionEffects.getAbility(effect.getId());\n                }\n                if (abilities == null || abilities.size() == 1) {\n                    onlyOne = true;\n                }\n            }\n            if (onlyOne) {\n                index = 0;\n            } else {\n                //20100716 - 616.1c\n                Player player = game.getPlayer(event.getPlayerId());\n                index = player.chooseReplacementEffect(getReplacementEffectsTexts(rEffects, game), game);\n            }\n            // get the selected effect\n            int checked = 0;\n            ReplacementEffect rEffect = null;\n            Ability rAbility = null;\n            for (Map.Entry<ReplacementEffect, HashSet<Ability>> entry : rEffects.entrySet()) {\n                if (entry.getValue() == null) {\n                    if (checked == index) {\n                        rEffect = entry.getKey();\n                        break;\n                    } else {\n                        checked++;\n                    }\n                } else {\n                    HashSet<Ability> abilities = entry.getValue();\n                    int size = abilities.size();\n                    if (index > (checked + size - 1)) {\n                        checked += size;\n                    } else {\n                        rEffect = entry.getKey();\n                        Iterator it = abilities.iterator();\n                        while (it.hasNext() && rAbility == null) {\n                            if (checked == index) {\n                                rAbility = (Ability) it.next();\n                            } else {\n                                it.next();\n                                checked++;\n                            }\n                        }\n                        break;\n                    }\n                }\n            }\n\n            if (rEffect != null) {\n                event.getAppliedEffects().add(rEffect.getId());\n                caught = rEffect.replaceEvent(event, rAbility, game);\n            }\n            if (caught) { // Event was completely replaced -> stop applying effects to it\n                break;\n            }\n\n            // add the applied effect to the consumed effects\n            if (rEffect != null) {\n                if (consumed.containsKey(rEffect.getId())) {\n                    HashSet<UUID> set = consumed.get(rEffect.getId());\n                    if (rAbility != null) {\n                        set.add(rAbility.getId());\n\n                    }\n                } else {\n                    HashSet<UUID> set = new HashSet<>();\n                    if (rAbility != null) { // in case of AuraReplacementEffect or PlaneswalkerReplacementEffect there is no Ability\n                        set.add(rAbility.getId());\n                    }\n                    consumed.put(rEffect.getId(), set);\n                }\n            }\n            // Must be called here for some effects to be able to work correctly\n            // For example: Vesuva copying a Dark Depth (VesuvaTest:testDarkDepth)\n            // This call should be removed if possible as replacement effects of EntersTheBattlefield events\n            // do no longer work correctly because the entering permanents are not yet on the battlefield (before they were).\n            // game.applyEffects();\n        } while (true);\n        return caught;\n    }",
            "path": "Mage/src/main/java/mage/abilities/effects/ContinuousEffects.java",
            "extendedDetails": {}
        },
        "46eb6c0525dcc59c65133e31fb85198539991616": {
            "type": "Yfilerename",
            "commitMessage": "Restructured Mage module\n",
            "commitDate": "29/11/15 2:56 PM",
            "commitName": "46eb6c0525dcc59c65133e31fb85198539991616",
            "commitAuthor": "poixen",
            "commitDateOld": "29/11/15 2:17 PM",
            "commitNameOld": "727d62babb29d472f4616dcf1e1e36e502cab0f4",
            "commitAuthorOld": "poixen",
            "daysBetweenCommits": 0.03,
            "commitsBetweenForRepo": 1,
            "commitsBetweenForFile": 1,
            "diff": "",
            "actualSource": "    public boolean replaceEvent(GameEvent event, Game game) {\n        boolean caught = false;\n        HashMap<UUID, HashSet<UUID>> consumed = new HashMap<>();\n        do {\n            HashMap<ReplacementEffect, HashSet<Ability>> rEffects = getApplicableReplacementEffects(event, game);\n            // Remove all consumed effects (ability dependant)\n            for (Iterator<ReplacementEffect> it1 = rEffects.keySet().iterator(); it1.hasNext();) {\n                ReplacementEffect entry = it1.next();\n                if (consumed.containsKey(entry.getId())) {\n                    HashSet<UUID> consumedAbilitiesIds = consumed.get(entry.getId());\n                    if (rEffects.get(entry) == null || consumedAbilitiesIds.size() == rEffects.get(entry).size()) {\n                        it1.remove();\n                    } else {\n                        Iterator it = rEffects.get(entry).iterator();\n                        while (it.hasNext()) {\n                            Ability ability = (Ability) it.next();\n                            if (consumedAbilitiesIds.contains(ability.getId())) {\n                                it.remove();\n                            }\n                        }\n                    }\n                }\n            }\n            // no effects left, quit\n            if (rEffects.isEmpty()) {\n                break;\n            }\n            int index;\n            boolean onlyOne = false;\n            if (rEffects.size() == 1) {\n                ReplacementEffect effect = rEffects.keySet().iterator().next();\n                HashSet<Ability> abilities;\n                if (effect.getEffectType().equals(EffectType.REPLACEMENT)) {\n                    abilities = replacementEffects.getAbility(effect.getId());\n                } else {\n                    abilities = preventionEffects.getAbility(effect.getId());\n                }\n                if (abilities == null || abilities.size() == 1) {\n                    onlyOne = true;\n                }\n            }\n            if (onlyOne) {\n                index = 0;\n            } else {\n                //20100716 - 616.1c\n                Player player = game.getPlayer(event.getPlayerId());\n                index = player.chooseReplacementEffect(getReplacementEffectsTexts(rEffects, game), game);\n            }\n            // get the selected effect\n            int checked = 0;\n            ReplacementEffect rEffect = null;\n            Ability rAbility = null;\n            for (Map.Entry<ReplacementEffect, HashSet<Ability>> entry : rEffects.entrySet()) {\n                if (entry.getValue() == null) {\n                    if (checked == index) {\n                        rEffect = entry.getKey();\n                        break;\n                    } else {\n                        checked++;\n                    }\n                } else {\n                    HashSet<Ability> abilities = entry.getValue();\n                    int size = abilities.size();\n                    if (index > (checked + size - 1)) {\n                        checked += size;\n                    } else {\n                        rEffect = entry.getKey();\n                        Iterator it = abilities.iterator();\n                        while (it.hasNext() && rAbility == null) {\n                            if (checked == index) {\n                                rAbility = (Ability) it.next();\n                            } else {\n                                it.next();\n                                checked++;\n                            }\n                        }\n                        break;\n                    }\n                }\n            }\n\n            if (rEffect != null) {\n                event.getAppliedEffects().add(rEffect.getId());\n                caught = rEffect.replaceEvent(event, rAbility, game);\n            }\n            if (caught) { // Event was completely replaced -> stop applying effects to it\n                break;\n            }\n\n            // add the applied effect to the consumed effects\n            if (rEffect != null) {\n                if (consumed.containsKey(rEffect.getId())) {\n                    HashSet<UUID> set = consumed.get(rEffect.getId());\n                    if (rAbility != null) {\n                        if (!set.contains(rAbility.getId())) {\n                            set.add(rAbility.getId());\n                        }\n                    }\n                } else {\n                    HashSet<UUID> set = new HashSet<>();\n                    if (rAbility != null) { // in case of AuraReplacementEffect or PlaneswalkerReplacementEffect there is no Ability\n                        set.add(rAbility.getId());\n                    }\n                    consumed.put(rEffect.getId(), set);\n                }\n            }\n            // Must be called here for some effects to be able to work correctly\n            // For example: Vesuva copying a Dark Depth (VesuvaTest:testDarkDepth)\n            // This call should be removed if possible as replacement effects of EntersTheBattlefield events\n            // do no longer work correctly because the entering permanents are not yet on the battlefield (before they were).\n            // game.applyEffects();\n        } while (true);\n        return caught;\n    }",
            "path": "Mage/src/main/java/mage/abilities/effects/ContinuousEffects.java",
            "extendedDetails": {
                "oldPath": "Mage/src/mage/abilities/effects/ContinuousEffects.java",
                "newPath": "Mage/src/main/java/mage/abilities/effects/ContinuousEffects.java"
            }
        },
        "59ef2a2889159d9b7007a57d8bcb213d64201dea": {
            "type": "Ybodychange",
            "commitMessage": "* Reworked ENTERS_THE_BATTLEFIELD event for replacement effects. Some rework to card movement.",
            "commitDate": "17/10/15 9:30 AM",
            "commitName": "59ef2a2889159d9b7007a57d8bcb213d64201dea",
            "commitAuthor": "LevelX2",
            "commitDateOld": "15/10/15 1:32 AM",
            "commitNameOld": "046da0f5d1f5c5250a09084bf3184b94438800ba",
            "commitAuthorOld": "LevelX2",
            "daysBetweenCommits": 2.33,
            "commitsBetweenForRepo": 12,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,114 +1,114 @@\n     public boolean replaceEvent(GameEvent event, Game game) {\n         boolean caught = false;\n         HashMap<UUID, HashSet<UUID>> consumed = new HashMap<>();\n         do {\n             HashMap<ReplacementEffect, HashSet<Ability>> rEffects = getApplicableReplacementEffects(event, game);\n             // Remove all consumed effects (ability dependant)\n             for (Iterator<ReplacementEffect> it1 = rEffects.keySet().iterator(); it1.hasNext();) {\n                 ReplacementEffect entry = it1.next();\n                 if (consumed.containsKey(entry.getId())) {\n                     HashSet<UUID> consumedAbilitiesIds = consumed.get(entry.getId());\n                     if (rEffects.get(entry) == null || consumedAbilitiesIds.size() == rEffects.get(entry).size()) {\n                         it1.remove();\n                     } else {\n                         Iterator it = rEffects.get(entry).iterator();\n                         while (it.hasNext()) {\n                             Ability ability = (Ability) it.next();\n                             if (consumedAbilitiesIds.contains(ability.getId())) {\n                                 it.remove();\n                             }\n                         }\n                     }\n                 }\n             }\n             // no effects left, quit\n             if (rEffects.isEmpty()) {\n                 break;\n             }\n             int index;\n             boolean onlyOne = false;\n             if (rEffects.size() == 1) {\n                 ReplacementEffect effect = rEffects.keySet().iterator().next();\n                 HashSet<Ability> abilities;\n                 if (effect.getEffectType().equals(EffectType.REPLACEMENT)) {\n                     abilities = replacementEffects.getAbility(effect.getId());\n                 } else {\n                     abilities = preventionEffects.getAbility(effect.getId());\n                 }\n                 if (abilities == null || abilities.size() == 1) {\n                     onlyOne = true;\n                 }\n             }\n             if (onlyOne) {\n                 index = 0;\n             } else {\n                 //20100716 - 616.1c\n                 Player player = game.getPlayer(event.getPlayerId());\n                 index = player.chooseReplacementEffect(getReplacementEffectsTexts(rEffects, game), game);\n             }\n             // get the selected effect\n             int checked = 0;\n             ReplacementEffect rEffect = null;\n             Ability rAbility = null;\n             for (Map.Entry<ReplacementEffect, HashSet<Ability>> entry : rEffects.entrySet()) {\n                 if (entry.getValue() == null) {\n                     if (checked == index) {\n                         rEffect = entry.getKey();\n                         break;\n                     } else {\n                         checked++;\n                     }\n                 } else {\n                     HashSet<Ability> abilities = entry.getValue();\n                     int size = abilities.size();\n                     if (index > (checked + size - 1)) {\n                         checked += size;\n                     } else {\n                         rEffect = entry.getKey();\n                         Iterator it = abilities.iterator();\n                         while (it.hasNext() && rAbility == null) {\n                             if (checked == index) {\n                                 rAbility = (Ability) it.next();\n                             } else {\n                                 it.next();\n                                 checked++;\n                             }\n                         }\n                         break;\n                     }\n                 }\n             }\n \n             if (rEffect != null) {\n                 event.getAppliedEffects().add(rEffect.getId());\n                 caught = rEffect.replaceEvent(event, rAbility, game);\n             }\n             if (caught) { // Event was completely replaced -> stop applying effects to it\n                 break;\n             }\n \n             // add the applied effect to the consumed effects\n             if (rEffect != null) {\n                 if (consumed.containsKey(rEffect.getId())) {\n                     HashSet<UUID> set = consumed.get(rEffect.getId());\n                     if (rAbility != null) {\n                         if (!set.contains(rAbility.getId())) {\n                             set.add(rAbility.getId());\n                         }\n                     }\n                 } else {\n                     HashSet<UUID> set = new HashSet<>();\n                     if (rAbility != null) { // in case of AuraReplacementEffect or PlaneswalkerReplacementEffect there is no Ability\n                         set.add(rAbility.getId());\n                     }\n                     consumed.put(rEffect.getId(), set);\n                 }\n             }\n             // Must be called here for some effects to be able to work correctly\n             // For example: Vesuva copying a Dark Depth (VesuvaTest:testDarkDepth)\n             // This call should be removed if possible as replacement effects of EntersTheBattlefield events\n             // do no longer work correctly because the entering permanents are not yet on the battlefield (before they were).\n-            game.applyEffects();\n+            // game.applyEffects();\n         } while (true);\n         return caught;\n     }\n\\ No newline at end of file\n",
            "actualSource": "    public boolean replaceEvent(GameEvent event, Game game) {\n        boolean caught = false;\n        HashMap<UUID, HashSet<UUID>> consumed = new HashMap<>();\n        do {\n            HashMap<ReplacementEffect, HashSet<Ability>> rEffects = getApplicableReplacementEffects(event, game);\n            // Remove all consumed effects (ability dependant)\n            for (Iterator<ReplacementEffect> it1 = rEffects.keySet().iterator(); it1.hasNext();) {\n                ReplacementEffect entry = it1.next();\n                if (consumed.containsKey(entry.getId())) {\n                    HashSet<UUID> consumedAbilitiesIds = consumed.get(entry.getId());\n                    if (rEffects.get(entry) == null || consumedAbilitiesIds.size() == rEffects.get(entry).size()) {\n                        it1.remove();\n                    } else {\n                        Iterator it = rEffects.get(entry).iterator();\n                        while (it.hasNext()) {\n                            Ability ability = (Ability) it.next();\n                            if (consumedAbilitiesIds.contains(ability.getId())) {\n                                it.remove();\n                            }\n                        }\n                    }\n                }\n            }\n            // no effects left, quit\n            if (rEffects.isEmpty()) {\n                break;\n            }\n            int index;\n            boolean onlyOne = false;\n            if (rEffects.size() == 1) {\n                ReplacementEffect effect = rEffects.keySet().iterator().next();\n                HashSet<Ability> abilities;\n                if (effect.getEffectType().equals(EffectType.REPLACEMENT)) {\n                    abilities = replacementEffects.getAbility(effect.getId());\n                } else {\n                    abilities = preventionEffects.getAbility(effect.getId());\n                }\n                if (abilities == null || abilities.size() == 1) {\n                    onlyOne = true;\n                }\n            }\n            if (onlyOne) {\n                index = 0;\n            } else {\n                //20100716 - 616.1c\n                Player player = game.getPlayer(event.getPlayerId());\n                index = player.chooseReplacementEffect(getReplacementEffectsTexts(rEffects, game), game);\n            }\n            // get the selected effect\n            int checked = 0;\n            ReplacementEffect rEffect = null;\n            Ability rAbility = null;\n            for (Map.Entry<ReplacementEffect, HashSet<Ability>> entry : rEffects.entrySet()) {\n                if (entry.getValue() == null) {\n                    if (checked == index) {\n                        rEffect = entry.getKey();\n                        break;\n                    } else {\n                        checked++;\n                    }\n                } else {\n                    HashSet<Ability> abilities = entry.getValue();\n                    int size = abilities.size();\n                    if (index > (checked + size - 1)) {\n                        checked += size;\n                    } else {\n                        rEffect = entry.getKey();\n                        Iterator it = abilities.iterator();\n                        while (it.hasNext() && rAbility == null) {\n                            if (checked == index) {\n                                rAbility = (Ability) it.next();\n                            } else {\n                                it.next();\n                                checked++;\n                            }\n                        }\n                        break;\n                    }\n                }\n            }\n\n            if (rEffect != null) {\n                event.getAppliedEffects().add(rEffect.getId());\n                caught = rEffect.replaceEvent(event, rAbility, game);\n            }\n            if (caught) { // Event was completely replaced -> stop applying effects to it\n                break;\n            }\n\n            // add the applied effect to the consumed effects\n            if (rEffect != null) {\n                if (consumed.containsKey(rEffect.getId())) {\n                    HashSet<UUID> set = consumed.get(rEffect.getId());\n                    if (rAbility != null) {\n                        if (!set.contains(rAbility.getId())) {\n                            set.add(rAbility.getId());\n                        }\n                    }\n                } else {\n                    HashSet<UUID> set = new HashSet<>();\n                    if (rAbility != null) { // in case of AuraReplacementEffect or PlaneswalkerReplacementEffect there is no Ability\n                        set.add(rAbility.getId());\n                    }\n                    consumed.put(rEffect.getId(), set);\n                }\n            }\n            // Must be called here for some effects to be able to work correctly\n            // For example: Vesuva copying a Dark Depth (VesuvaTest:testDarkDepth)\n            // This call should be removed if possible as replacement effects of EntersTheBattlefield events\n            // do no longer work correctly because the entering permanents are not yet on the battlefield (before they were).\n            // game.applyEffects();\n        } while (true);\n        return caught;\n    }",
            "path": "Mage/src/mage/abilities/effects/ContinuousEffects.java",
            "extendedDetails": {}
        },
        "046da0f5d1f5c5250a09084bf3184b94438800ba": {
            "type": "Ybodychange",
            "commitMessage": "* Some changed to card moving (not finished)",
            "commitDate": "15/10/15 1:32 AM",
            "commitName": "046da0f5d1f5c5250a09084bf3184b94438800ba",
            "commitAuthor": "LevelX2",
            "commitDateOld": "14/10/15 10:54 AM",
            "commitNameOld": "52d0adcac10c2a9aaae4b5cfd83679acba565c96",
            "commitAuthorOld": "LevelX2",
            "daysBetweenCommits": 0.61,
            "commitsBetweenForRepo": 6,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,112 +1,114 @@\n     public boolean replaceEvent(GameEvent event, Game game) {\n         boolean caught = false;\n         HashMap<UUID, HashSet<UUID>> consumed = new HashMap<>();\n         do {\n             HashMap<ReplacementEffect, HashSet<Ability>> rEffects = getApplicableReplacementEffects(event, game);\n             // Remove all consumed effects (ability dependant)\n             for (Iterator<ReplacementEffect> it1 = rEffects.keySet().iterator(); it1.hasNext();) {\n                 ReplacementEffect entry = it1.next();\n                 if (consumed.containsKey(entry.getId())) {\n                     HashSet<UUID> consumedAbilitiesIds = consumed.get(entry.getId());\n                     if (rEffects.get(entry) == null || consumedAbilitiesIds.size() == rEffects.get(entry).size()) {\n                         it1.remove();\n                     } else {\n                         Iterator it = rEffects.get(entry).iterator();\n                         while (it.hasNext()) {\n                             Ability ability = (Ability) it.next();\n                             if (consumedAbilitiesIds.contains(ability.getId())) {\n                                 it.remove();\n                             }\n                         }\n                     }\n                 }\n             }\n             // no effects left, quit\n             if (rEffects.isEmpty()) {\n                 break;\n             }\n             int index;\n             boolean onlyOne = false;\n             if (rEffects.size() == 1) {\n                 ReplacementEffect effect = rEffects.keySet().iterator().next();\n                 HashSet<Ability> abilities;\n                 if (effect.getEffectType().equals(EffectType.REPLACEMENT)) {\n                     abilities = replacementEffects.getAbility(effect.getId());\n                 } else {\n                     abilities = preventionEffects.getAbility(effect.getId());\n                 }\n                 if (abilities == null || abilities.size() == 1) {\n                     onlyOne = true;\n                 }\n             }\n             if (onlyOne) {\n                 index = 0;\n             } else {\n                 //20100716 - 616.1c\n                 Player player = game.getPlayer(event.getPlayerId());\n                 index = player.chooseReplacementEffect(getReplacementEffectsTexts(rEffects, game), game);\n             }\n             // get the selected effect\n             int checked = 0;\n             ReplacementEffect rEffect = null;\n             Ability rAbility = null;\n             for (Map.Entry<ReplacementEffect, HashSet<Ability>> entry : rEffects.entrySet()) {\n                 if (entry.getValue() == null) {\n                     if (checked == index) {\n                         rEffect = entry.getKey();\n                         break;\n                     } else {\n                         checked++;\n                     }\n                 } else {\n                     HashSet<Ability> abilities = entry.getValue();\n                     int size = abilities.size();\n                     if (index > (checked + size - 1)) {\n                         checked += size;\n                     } else {\n                         rEffect = entry.getKey();\n                         Iterator it = abilities.iterator();\n                         while (it.hasNext() && rAbility == null) {\n                             if (checked == index) {\n                                 rAbility = (Ability) it.next();\n                             } else {\n                                 it.next();\n                                 checked++;\n                             }\n                         }\n                         break;\n                     }\n                 }\n             }\n \n             if (rEffect != null) {\n                 event.getAppliedEffects().add(rEffect.getId());\n                 caught = rEffect.replaceEvent(event, rAbility, game);\n             }\n             if (caught) { // Event was completely replaced -> stop applying effects to it\n                 break;\n             }\n \n             // add the applied effect to the consumed effects\n             if (rEffect != null) {\n                 if (consumed.containsKey(rEffect.getId())) {\n                     HashSet<UUID> set = consumed.get(rEffect.getId());\n                     if (rAbility != null) {\n                         if (!set.contains(rAbility.getId())) {\n                             set.add(rAbility.getId());\n                         }\n                     }\n                 } else {\n                     HashSet<UUID> set = new HashSet<>();\n                     if (rAbility != null) { // in case of AuraReplacementEffect or PlaneswalkerReplacementEffect there is no Ability\n                         set.add(rAbility.getId());\n                     }\n                     consumed.put(rEffect.getId(), set);\n                 }\n             }\n             // Must be called here for some effects to be able to work correctly\n-            // TODO: add info which effects need that call\n+            // For example: Vesuva copying a Dark Depth (VesuvaTest:testDarkDepth)\n+            // This call should be removed if possible as replacement effects of EntersTheBattlefield events\n+            // do no longer work correctly because the entering permanents are not yet on the battlefield (before they were).\n             game.applyEffects();\n         } while (true);\n         return caught;\n     }\n\\ No newline at end of file\n",
            "actualSource": "    public boolean replaceEvent(GameEvent event, Game game) {\n        boolean caught = false;\n        HashMap<UUID, HashSet<UUID>> consumed = new HashMap<>();\n        do {\n            HashMap<ReplacementEffect, HashSet<Ability>> rEffects = getApplicableReplacementEffects(event, game);\n            // Remove all consumed effects (ability dependant)\n            for (Iterator<ReplacementEffect> it1 = rEffects.keySet().iterator(); it1.hasNext();) {\n                ReplacementEffect entry = it1.next();\n                if (consumed.containsKey(entry.getId())) {\n                    HashSet<UUID> consumedAbilitiesIds = consumed.get(entry.getId());\n                    if (rEffects.get(entry) == null || consumedAbilitiesIds.size() == rEffects.get(entry).size()) {\n                        it1.remove();\n                    } else {\n                        Iterator it = rEffects.get(entry).iterator();\n                        while (it.hasNext()) {\n                            Ability ability = (Ability) it.next();\n                            if (consumedAbilitiesIds.contains(ability.getId())) {\n                                it.remove();\n                            }\n                        }\n                    }\n                }\n            }\n            // no effects left, quit\n            if (rEffects.isEmpty()) {\n                break;\n            }\n            int index;\n            boolean onlyOne = false;\n            if (rEffects.size() == 1) {\n                ReplacementEffect effect = rEffects.keySet().iterator().next();\n                HashSet<Ability> abilities;\n                if (effect.getEffectType().equals(EffectType.REPLACEMENT)) {\n                    abilities = replacementEffects.getAbility(effect.getId());\n                } else {\n                    abilities = preventionEffects.getAbility(effect.getId());\n                }\n                if (abilities == null || abilities.size() == 1) {\n                    onlyOne = true;\n                }\n            }\n            if (onlyOne) {\n                index = 0;\n            } else {\n                //20100716 - 616.1c\n                Player player = game.getPlayer(event.getPlayerId());\n                index = player.chooseReplacementEffect(getReplacementEffectsTexts(rEffects, game), game);\n            }\n            // get the selected effect\n            int checked = 0;\n            ReplacementEffect rEffect = null;\n            Ability rAbility = null;\n            for (Map.Entry<ReplacementEffect, HashSet<Ability>> entry : rEffects.entrySet()) {\n                if (entry.getValue() == null) {\n                    if (checked == index) {\n                        rEffect = entry.getKey();\n                        break;\n                    } else {\n                        checked++;\n                    }\n                } else {\n                    HashSet<Ability> abilities = entry.getValue();\n                    int size = abilities.size();\n                    if (index > (checked + size - 1)) {\n                        checked += size;\n                    } else {\n                        rEffect = entry.getKey();\n                        Iterator it = abilities.iterator();\n                        while (it.hasNext() && rAbility == null) {\n                            if (checked == index) {\n                                rAbility = (Ability) it.next();\n                            } else {\n                                it.next();\n                                checked++;\n                            }\n                        }\n                        break;\n                    }\n                }\n            }\n\n            if (rEffect != null) {\n                event.getAppliedEffects().add(rEffect.getId());\n                caught = rEffect.replaceEvent(event, rAbility, game);\n            }\n            if (caught) { // Event was completely replaced -> stop applying effects to it\n                break;\n            }\n\n            // add the applied effect to the consumed effects\n            if (rEffect != null) {\n                if (consumed.containsKey(rEffect.getId())) {\n                    HashSet<UUID> set = consumed.get(rEffect.getId());\n                    if (rAbility != null) {\n                        if (!set.contains(rAbility.getId())) {\n                            set.add(rAbility.getId());\n                        }\n                    }\n                } else {\n                    HashSet<UUID> set = new HashSet<>();\n                    if (rAbility != null) { // in case of AuraReplacementEffect or PlaneswalkerReplacementEffect there is no Ability\n                        set.add(rAbility.getId());\n                    }\n                    consumed.put(rEffect.getId(), set);\n                }\n            }\n            // Must be called here for some effects to be able to work correctly\n            // For example: Vesuva copying a Dark Depth (VesuvaTest:testDarkDepth)\n            // This call should be removed if possible as replacement effects of EntersTheBattlefield events\n            // do no longer work correctly because the entering permanents are not yet on the battlefield (before they were).\n            game.applyEffects();\n        } while (true);\n        return caught;\n    }",
            "path": "Mage/src/mage/abilities/effects/ContinuousEffects.java",
            "extendedDetails": {}
        },
        "93dcf2d59f6dc2020e03bb3dba2e6cc49be590b4": {
            "type": "Ybodychange",
            "commitMessage": "* Finished card attribute change handling for color of cards (card subtype not supported yet) related to #408",
            "commitDate": "10/06/15 7:00 AM",
            "commitName": "93dcf2d59f6dc2020e03bb3dba2e6cc49be590b4",
            "commitAuthor": "LevelX2",
            "commitDateOld": "29/05/15 11:43 AM",
            "commitNameOld": "5a428f10ab15c3f3bc5291366b646dbdea7440fa",
            "commitAuthorOld": "LevelX2",
            "daysBetweenCommits": 11.8,
            "commitsBetweenForRepo": 82,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,112 +1,112 @@\n     public boolean replaceEvent(GameEvent event, Game game) {\n         boolean caught = false;\n         HashMap<UUID, HashSet<UUID>> consumed = new HashMap<>();\n         do {\n             HashMap<ReplacementEffect, HashSet<Ability>> rEffects = getApplicableReplacementEffects(event, game);\n             // Remove all consumed effects (ability dependant)\n             for (Iterator<ReplacementEffect> it1 = rEffects.keySet().iterator(); it1.hasNext();){\n                 ReplacementEffect entry = it1.next();\n                 if (consumed.containsKey(entry.getId())) {\n                     HashSet<UUID> consumedAbilitiesIds = consumed.get(entry.getId());\n                     if (rEffects.get(entry) == null || consumedAbilitiesIds.size() == rEffects.get(entry).size()) {\n                         it1.remove();\n                     } else {\n                         Iterator it = rEffects.get(entry).iterator();\n                         while (it.hasNext()) {\n                             Ability ability = (Ability) it.next();\n                             if (consumedAbilitiesIds.contains(ability.getId())) {\n                                 it.remove();\n                             }\n                         }\n                     }\n                 }\n             }\n             // no effects left, quit\n             if (rEffects.isEmpty()) {\n                 break;\n             }\n             int index;\n             boolean onlyOne = false;\n             if (rEffects.size() == 1) {\n                 ReplacementEffect effect = rEffects.keySet().iterator().next();\n                 HashSet<Ability> abilities;\n                 if (effect.getEffectType().equals(EffectType.REPLACEMENT)) {\n                     abilities = replacementEffects.getAbility(effect.getId());\n                 } else {\n                     abilities = preventionEffects.getAbility(effect.getId());\n                 }\n                 if (abilities == null || abilities.size() == 1) {\n                     onlyOne = true;\n                 }\n             }\n             if (onlyOne) {\n                 index = 0;\n             } else {\n                 //20100716 - 616.1c\n                 Player player = game.getPlayer(event.getPlayerId());\n                 index = player.chooseReplacementEffect(getReplacementEffectsTexts(rEffects, game), game);\n             }\n             // get the selected effect\n             int checked = 0;\n             ReplacementEffect rEffect = null;\n             Ability rAbility = null;\n             for (Map.Entry<ReplacementEffect, HashSet<Ability>> entry : rEffects.entrySet()) {\n                 if (entry.getValue() == null) {\n                     if (checked == index) {\n                         rEffect = entry.getKey();\n                         break;\n                     } else {\n                         checked++;\n                     }\n                 } else {\n                     HashSet<Ability> abilities = entry.getValue();\n                     int size = abilities.size();\n                     if (index > (checked + size - 1)) {\n                         checked += size;\n                     } else {\n                         rEffect = entry.getKey();\n                         Iterator it = abilities.iterator();\n                         while (it.hasNext() && rAbility == null) {\n                             if (checked == index) {\n                                 rAbility = (Ability) it.next();\n                             } else {\n                                 it.next();\n                                 checked++;\n                             }\n                         }\n                         break;\n                     }\n                 }                \n             }\n \n             if (rEffect != null) {\n                 event.getAppliedEffects().add(rEffect.getId());\n                 caught = rEffect.replaceEvent(event, rAbility, game);\n             }\n             if (caught) { // Event was completely replaced -> stop applying effects to it\n                 break;\n             }\n \n             // add the applied effect to the consumed effects\n             if (rEffect != null) {\n                 if (consumed.containsKey(rEffect.getId())) {\n                     HashSet<UUID> set = consumed.get(rEffect.getId());\n                     if (rAbility != null) {\n                         if (!set.contains(rAbility.getId())) {\n                             set.add(rAbility.getId());\n                         }\n                     }\n                 } else {\n                     HashSet<UUID> set = new HashSet<>();\n                     if (rAbility != null) { // in case of AuraReplacementEffect or PlaneswalkerReplacementEffect there is no Ability\n                         set.add(rAbility.getId());\n                     }\n                     consumed.put(rEffect.getId(), set);\n                 }\n             }\n             // Must be called here for some effects to be able to work correctly\n-            // TODO: add info which effects that need\n+            // TODO: add info which effects need that call\n             game.applyEffects();\n         } while (true);\n         return caught;\n     }\n\\ No newline at end of file\n",
            "actualSource": "    public boolean replaceEvent(GameEvent event, Game game) {\n        boolean caught = false;\n        HashMap<UUID, HashSet<UUID>> consumed = new HashMap<>();\n        do {\n            HashMap<ReplacementEffect, HashSet<Ability>> rEffects = getApplicableReplacementEffects(event, game);\n            // Remove all consumed effects (ability dependant)\n            for (Iterator<ReplacementEffect> it1 = rEffects.keySet().iterator(); it1.hasNext();){\n                ReplacementEffect entry = it1.next();\n                if (consumed.containsKey(entry.getId())) {\n                    HashSet<UUID> consumedAbilitiesIds = consumed.get(entry.getId());\n                    if (rEffects.get(entry) == null || consumedAbilitiesIds.size() == rEffects.get(entry).size()) {\n                        it1.remove();\n                    } else {\n                        Iterator it = rEffects.get(entry).iterator();\n                        while (it.hasNext()) {\n                            Ability ability = (Ability) it.next();\n                            if (consumedAbilitiesIds.contains(ability.getId())) {\n                                it.remove();\n                            }\n                        }\n                    }\n                }\n            }\n            // no effects left, quit\n            if (rEffects.isEmpty()) {\n                break;\n            }\n            int index;\n            boolean onlyOne = false;\n            if (rEffects.size() == 1) {\n                ReplacementEffect effect = rEffects.keySet().iterator().next();\n                HashSet<Ability> abilities;\n                if (effect.getEffectType().equals(EffectType.REPLACEMENT)) {\n                    abilities = replacementEffects.getAbility(effect.getId());\n                } else {\n                    abilities = preventionEffects.getAbility(effect.getId());\n                }\n                if (abilities == null || abilities.size() == 1) {\n                    onlyOne = true;\n                }\n            }\n            if (onlyOne) {\n                index = 0;\n            } else {\n                //20100716 - 616.1c\n                Player player = game.getPlayer(event.getPlayerId());\n                index = player.chooseReplacementEffect(getReplacementEffectsTexts(rEffects, game), game);\n            }\n            // get the selected effect\n            int checked = 0;\n            ReplacementEffect rEffect = null;\n            Ability rAbility = null;\n            for (Map.Entry<ReplacementEffect, HashSet<Ability>> entry : rEffects.entrySet()) {\n                if (entry.getValue() == null) {\n                    if (checked == index) {\n                        rEffect = entry.getKey();\n                        break;\n                    } else {\n                        checked++;\n                    }\n                } else {\n                    HashSet<Ability> abilities = entry.getValue();\n                    int size = abilities.size();\n                    if (index > (checked + size - 1)) {\n                        checked += size;\n                    } else {\n                        rEffect = entry.getKey();\n                        Iterator it = abilities.iterator();\n                        while (it.hasNext() && rAbility == null) {\n                            if (checked == index) {\n                                rAbility = (Ability) it.next();\n                            } else {\n                                it.next();\n                                checked++;\n                            }\n                        }\n                        break;\n                    }\n                }                \n            }\n\n            if (rEffect != null) {\n                event.getAppliedEffects().add(rEffect.getId());\n                caught = rEffect.replaceEvent(event, rAbility, game);\n            }\n            if (caught) { // Event was completely replaced -> stop applying effects to it\n                break;\n            }\n\n            // add the applied effect to the consumed effects\n            if (rEffect != null) {\n                if (consumed.containsKey(rEffect.getId())) {\n                    HashSet<UUID> set = consumed.get(rEffect.getId());\n                    if (rAbility != null) {\n                        if (!set.contains(rAbility.getId())) {\n                            set.add(rAbility.getId());\n                        }\n                    }\n                } else {\n                    HashSet<UUID> set = new HashSet<>();\n                    if (rAbility != null) { // in case of AuraReplacementEffect or PlaneswalkerReplacementEffect there is no Ability\n                        set.add(rAbility.getId());\n                    }\n                    consumed.put(rEffect.getId(), set);\n                }\n            }\n            // Must be called here for some effects to be able to work correctly\n            // TODO: add info which effects need that call\n            game.applyEffects();\n        } while (true);\n        return caught;\n    }",
            "path": "Mage/src/mage/abilities/effects/ContinuousEffects.java",
            "extendedDetails": {}
        },
        "b4894f5564ab0d9322baed947d419ff09a1361a9": {
            "type": "Ybodychange",
            "commitMessage": "* Fixed a bug that could cause endless loop of applying replacement/prevention effects (e.g. prevent effect of Hedron-Field Purists) locking the UI.",
            "commitDate": "07/03/15 9:42 AM",
            "commitName": "b4894f5564ab0d9322baed947d419ff09a1361a9",
            "commitAuthor": "LevelX2",
            "commitDateOld": "05/03/15 12:00 PM",
            "commitNameOld": "78f98e49c1d3f6338a5dcf9418425e19d19d01d7",
            "commitAuthorOld": "LevelX2",
            "daysBetweenCommits": 1.9,
            "commitsBetweenForRepo": 21,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,106 +1,112 @@\n     public boolean replaceEvent(GameEvent event, Game game) {\n         boolean caught = false;\n         HashMap<UUID, HashSet<UUID>> consumed = new HashMap<>();\n         do {\n             HashMap<ReplacementEffect, HashSet<Ability>> rEffects = getApplicableReplacementEffects(event, game);\n             // Remove all consumed effects (ability dependant)\n             for (Iterator<ReplacementEffect> it1 = rEffects.keySet().iterator(); it1.hasNext();){\n                 ReplacementEffect entry = it1.next();\n                 if (consumed.containsKey(entry.getId())) {\n                     HashSet<UUID> consumedAbilitiesIds = consumed.get(entry.getId());\n                     if (rEffects.get(entry) == null || consumedAbilitiesIds.size() == rEffects.get(entry).size()) {\n                         it1.remove();\n                     } else {\n                         Iterator it = rEffects.get(entry).iterator();\n                         while (it.hasNext()) {\n                             Ability ability = (Ability) it.next();\n                             if (consumedAbilitiesIds.contains(ability.getId())) {\n                                 it.remove();\n                             }\n                         }\n                     }\n                 }\n             }\n             // no effects left, quit\n             if (rEffects.isEmpty()) {\n                 break;\n             }\n             int index;\n             boolean onlyOne = false;\n             if (rEffects.size() == 1) {\n                 ReplacementEffect effect = rEffects.keySet().iterator().next();\n-                HashSet<Ability> abilities = replacementEffects.getAbility(effect.getId());\n+                HashSet<Ability> abilities;\n+                if (effect.getEffectType().equals(EffectType.REPLACEMENT)) {\n+                    abilities = replacementEffects.getAbility(effect.getId());\n+                } else {\n+                    abilities = preventionEffects.getAbility(effect.getId());\n+                }\n                 if (abilities == null || abilities.size() == 1) {\n                     onlyOne = true;\n                 }\n             }\n             if (onlyOne) {\n                 index = 0;\n             } else {\n                 //20100716 - 616.1c\n                 Player player = game.getPlayer(event.getPlayerId());\n                 index = player.chooseReplacementEffect(getReplacementEffectsTexts(rEffects, game), game);\n             }\n             // get the selected effect\n             int checked = 0;\n             ReplacementEffect rEffect = null;\n             Ability rAbility = null;\n             for (Map.Entry<ReplacementEffect, HashSet<Ability>> entry : rEffects.entrySet()) {\n                 if (entry.getValue() == null) {\n                     if (checked == index) {\n                         rEffect = entry.getKey();\n                         break;\n                     } else {\n                         checked++;\n                     }\n                 } else {\n                     HashSet<Ability> abilities = entry.getValue();\n                     int size = abilities.size();\n                     if (index > (checked + size - 1)) {\n                         checked += size;\n                     } else {\n                         rEffect = entry.getKey();\n                         Iterator it = abilities.iterator();\n                         while (it.hasNext() && rAbility == null) {\n                             if (checked == index) {\n                                 rAbility = (Ability) it.next();\n                             } else {\n                                 it.next();\n                                 checked++;\n                             }\n                         }\n                         break;\n                     }\n                 }                \n             }\n \n             if (rEffect != null) {\n                 event.getAppliedEffects().add(rEffect.getId());\n                 caught = rEffect.replaceEvent(event, rAbility, game);\n             }\n             if (caught) { // Event was completely replaced -> stop applying effects to it\n                 break;\n             }\n \n             // add the applied effect to the consumed effects\n             if (rEffect != null) {\n                 if (consumed.containsKey(rEffect.getId())) {\n                     HashSet<UUID> set = consumed.get(rEffect.getId());\n                     if (rAbility != null) {\n                         if (!set.contains(rAbility.getId())) {\n                             set.add(rAbility.getId());\n                         }\n                     }\n                 } else {\n                     HashSet<UUID> set = new HashSet<>();\n                     if (rAbility != null) { // in case of AuraReplacementEffect or PlaneswalkerReplacementEffect there is no Ability\n                         set.add(rAbility.getId());\n                     }\n                     consumed.put(rEffect.getId(), set);\n                 }\n             }\n             // Must be called here for some effects to be able to work correctly\n+            // TODO: add info which effects that need\n             game.applyEffects();\n         } while (true);\n         return caught;\n     }\n\\ No newline at end of file\n",
            "actualSource": "    public boolean replaceEvent(GameEvent event, Game game) {\n        boolean caught = false;\n        HashMap<UUID, HashSet<UUID>> consumed = new HashMap<>();\n        do {\n            HashMap<ReplacementEffect, HashSet<Ability>> rEffects = getApplicableReplacementEffects(event, game);\n            // Remove all consumed effects (ability dependant)\n            for (Iterator<ReplacementEffect> it1 = rEffects.keySet().iterator(); it1.hasNext();){\n                ReplacementEffect entry = it1.next();\n                if (consumed.containsKey(entry.getId())) {\n                    HashSet<UUID> consumedAbilitiesIds = consumed.get(entry.getId());\n                    if (rEffects.get(entry) == null || consumedAbilitiesIds.size() == rEffects.get(entry).size()) {\n                        it1.remove();\n                    } else {\n                        Iterator it = rEffects.get(entry).iterator();\n                        while (it.hasNext()) {\n                            Ability ability = (Ability) it.next();\n                            if (consumedAbilitiesIds.contains(ability.getId())) {\n                                it.remove();\n                            }\n                        }\n                    }\n                }\n            }\n            // no effects left, quit\n            if (rEffects.isEmpty()) {\n                break;\n            }\n            int index;\n            boolean onlyOne = false;\n            if (rEffects.size() == 1) {\n                ReplacementEffect effect = rEffects.keySet().iterator().next();\n                HashSet<Ability> abilities;\n                if (effect.getEffectType().equals(EffectType.REPLACEMENT)) {\n                    abilities = replacementEffects.getAbility(effect.getId());\n                } else {\n                    abilities = preventionEffects.getAbility(effect.getId());\n                }\n                if (abilities == null || abilities.size() == 1) {\n                    onlyOne = true;\n                }\n            }\n            if (onlyOne) {\n                index = 0;\n            } else {\n                //20100716 - 616.1c\n                Player player = game.getPlayer(event.getPlayerId());\n                index = player.chooseReplacementEffect(getReplacementEffectsTexts(rEffects, game), game);\n            }\n            // get the selected effect\n            int checked = 0;\n            ReplacementEffect rEffect = null;\n            Ability rAbility = null;\n            for (Map.Entry<ReplacementEffect, HashSet<Ability>> entry : rEffects.entrySet()) {\n                if (entry.getValue() == null) {\n                    if (checked == index) {\n                        rEffect = entry.getKey();\n                        break;\n                    } else {\n                        checked++;\n                    }\n                } else {\n                    HashSet<Ability> abilities = entry.getValue();\n                    int size = abilities.size();\n                    if (index > (checked + size - 1)) {\n                        checked += size;\n                    } else {\n                        rEffect = entry.getKey();\n                        Iterator it = abilities.iterator();\n                        while (it.hasNext() && rAbility == null) {\n                            if (checked == index) {\n                                rAbility = (Ability) it.next();\n                            } else {\n                                it.next();\n                                checked++;\n                            }\n                        }\n                        break;\n                    }\n                }                \n            }\n\n            if (rEffect != null) {\n                event.getAppliedEffects().add(rEffect.getId());\n                caught = rEffect.replaceEvent(event, rAbility, game);\n            }\n            if (caught) { // Event was completely replaced -> stop applying effects to it\n                break;\n            }\n\n            // add the applied effect to the consumed effects\n            if (rEffect != null) {\n                if (consumed.containsKey(rEffect.getId())) {\n                    HashSet<UUID> set = consumed.get(rEffect.getId());\n                    if (rAbility != null) {\n                        if (!set.contains(rAbility.getId())) {\n                            set.add(rAbility.getId());\n                        }\n                    }\n                } else {\n                    HashSet<UUID> set = new HashSet<>();\n                    if (rAbility != null) { // in case of AuraReplacementEffect or PlaneswalkerReplacementEffect there is no Ability\n                        set.add(rAbility.getId());\n                    }\n                    consumed.put(rEffect.getId(), set);\n                }\n            }\n            // Must be called here for some effects to be able to work correctly\n            // TODO: add info which effects that need\n            game.applyEffects();\n        } while (true);\n        return caught;\n    }",
            "path": "Mage/src/mage/abilities/effects/ContinuousEffects.java",
            "extendedDetails": {},
            "BugCommit": "0",
            "TangledWMoveandFileRename": "3"
        },
        "eb0544957bf17a7090cc7943cb7dc76142177c38": {
            "type": "Ybodychange",
            "commitMessage": "* Fix that commander replacement effects work again, some cleanup after the changes of continuous effects and triggered abilities.",
            "commitDate": "24/12/14 8:08 PM",
            "commitName": "eb0544957bf17a7090cc7943cb7dc76142177c38",
            "commitAuthor": "LevelX2",
            "commitDateOld": "24/12/14 7:07 PM",
            "commitNameOld": "4f1368f3de90d177bd11f463e83f156aa70a5f3a",
            "commitAuthorOld": "LevelX2",
            "daysBetweenCommits": 0.04,
            "commitsBetweenForRepo": 2,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,106 +1,106 @@\n     public boolean replaceEvent(GameEvent event, Game game) {\n         boolean caught = false;\n         HashMap<UUID, HashSet<UUID>> consumed = new HashMap<>();\n         do {\n             HashMap<ReplacementEffect, HashSet<Ability>> rEffects = getApplicableReplacementEffects(event, game);\n             // Remove all consumed effects (ability dependant)\n             for (Iterator<ReplacementEffect> it1 = rEffects.keySet().iterator(); it1.hasNext();){\n                 ReplacementEffect entry = it1.next();\n                 if (consumed.containsKey(entry.getId())) {\n                     HashSet<UUID> consumedAbilitiesIds = consumed.get(entry.getId());\n                     if (rEffects.get(entry) == null || consumedAbilitiesIds.size() == rEffects.get(entry).size()) {\n                         it1.remove();\n                     } else {\n                         Iterator it = rEffects.get(entry).iterator();\n                         while (it.hasNext()) {\n                             Ability ability = (Ability) it.next();\n                             if (consumedAbilitiesIds.contains(ability.getId())) {\n                                 it.remove();\n                             }\n                         }\n                     }\n                 }\n             }\n             // no effects left, quit\n             if (rEffects.isEmpty()) {\n                 break;\n             }\n             int index;\n             boolean onlyOne = false;\n             if (rEffects.size() == 1) {\n                 ReplacementEffect effect = rEffects.keySet().iterator().next();\n                 HashSet<Ability> abilities = replacementEffects.getAbility(effect.getId());\n                 if (abilities == null || abilities.size() == 1) {\n                     onlyOne = true;\n                 }\n             }\n             if (onlyOne) {\n                 index = 0;\n             } else {\n                 //20100716 - 616.1c\n                 Player player = game.getPlayer(event.getPlayerId());\n                 index = player.chooseReplacementEffect(getReplacementEffectsTexts(rEffects, game), game);\n             }\n             // get the selected effect\n             int checked = 0;\n             ReplacementEffect rEffect = null;\n             Ability rAbility = null;\n             for (Map.Entry<ReplacementEffect, HashSet<Ability>> entry : rEffects.entrySet()) {\n                 if (entry.getValue() == null) {\n                     if (checked == index) {\n                         rEffect = entry.getKey();\n                         break;\n                     } else {\n                         checked++;\n                     }\n                 } else {\n                     HashSet<Ability> abilities = entry.getValue();\n                     int size = abilities.size();\n                     if (index > (checked + size - 1)) {\n                         checked += size;\n                     } else {\n                         rEffect = entry.getKey();\n                         Iterator it = abilities.iterator();\n                         while (it.hasNext() && rAbility == null) {\n                             if (checked == index) {\n                                 rAbility = (Ability) it.next();\n                             } else {\n                                 it.next();\n                                 checked++;\n                             }\n                         }\n                         break;\n                     }\n                 }                \n             }\n \n             if (rEffect != null) {\n                 event.getAppliedEffects().add(rEffect.getId());\n                 caught = rEffect.replaceEvent(event, rAbility, game);\n             }\n             if (caught) { // Event was completely replaced -> stop applying effects to it\n                 break;\n             }\n \n             // add the applied effect to the consumed effects\n             if (rEffect != null) {\n                 if (consumed.containsKey(rEffect.getId())) {\n                     HashSet<UUID> set = consumed.get(rEffect.getId());\n                     if (rAbility != null) {\n                         if (!set.contains(rAbility.getId())) {\n                             set.add(rAbility.getId());\n                         }\n                     }\n                 } else {\n                     HashSet<UUID> set = new HashSet<>();\n                     if (rAbility != null) { // in case of AuraReplacementEffect or PlaneswalkerReplacementEffect there is no Ability\n                         set.add(rAbility.getId());\n                     }\n                     consumed.put(rEffect.getId(), set);\n                 }\n             }\n-            // Must be called here so some \n+            // Must be called here for some effects to be able to work correctly\n             game.applyEffects();\n         } while (true);\n         return caught;\n     }\n\\ No newline at end of file\n",
            "actualSource": "    public boolean replaceEvent(GameEvent event, Game game) {\n        boolean caught = false;\n        HashMap<UUID, HashSet<UUID>> consumed = new HashMap<>();\n        do {\n            HashMap<ReplacementEffect, HashSet<Ability>> rEffects = getApplicableReplacementEffects(event, game);\n            // Remove all consumed effects (ability dependant)\n            for (Iterator<ReplacementEffect> it1 = rEffects.keySet().iterator(); it1.hasNext();){\n                ReplacementEffect entry = it1.next();\n                if (consumed.containsKey(entry.getId())) {\n                    HashSet<UUID> consumedAbilitiesIds = consumed.get(entry.getId());\n                    if (rEffects.get(entry) == null || consumedAbilitiesIds.size() == rEffects.get(entry).size()) {\n                        it1.remove();\n                    } else {\n                        Iterator it = rEffects.get(entry).iterator();\n                        while (it.hasNext()) {\n                            Ability ability = (Ability) it.next();\n                            if (consumedAbilitiesIds.contains(ability.getId())) {\n                                it.remove();\n                            }\n                        }\n                    }\n                }\n            }\n            // no effects left, quit\n            if (rEffects.isEmpty()) {\n                break;\n            }\n            int index;\n            boolean onlyOne = false;\n            if (rEffects.size() == 1) {\n                ReplacementEffect effect = rEffects.keySet().iterator().next();\n                HashSet<Ability> abilities = replacementEffects.getAbility(effect.getId());\n                if (abilities == null || abilities.size() == 1) {\n                    onlyOne = true;\n                }\n            }\n            if (onlyOne) {\n                index = 0;\n            } else {\n                //20100716 - 616.1c\n                Player player = game.getPlayer(event.getPlayerId());\n                index = player.chooseReplacementEffect(getReplacementEffectsTexts(rEffects, game), game);\n            }\n            // get the selected effect\n            int checked = 0;\n            ReplacementEffect rEffect = null;\n            Ability rAbility = null;\n            for (Map.Entry<ReplacementEffect, HashSet<Ability>> entry : rEffects.entrySet()) {\n                if (entry.getValue() == null) {\n                    if (checked == index) {\n                        rEffect = entry.getKey();\n                        break;\n                    } else {\n                        checked++;\n                    }\n                } else {\n                    HashSet<Ability> abilities = entry.getValue();\n                    int size = abilities.size();\n                    if (index > (checked + size - 1)) {\n                        checked += size;\n                    } else {\n                        rEffect = entry.getKey();\n                        Iterator it = abilities.iterator();\n                        while (it.hasNext() && rAbility == null) {\n                            if (checked == index) {\n                                rAbility = (Ability) it.next();\n                            } else {\n                                it.next();\n                                checked++;\n                            }\n                        }\n                        break;\n                    }\n                }                \n            }\n\n            if (rEffect != null) {\n                event.getAppliedEffects().add(rEffect.getId());\n                caught = rEffect.replaceEvent(event, rAbility, game);\n            }\n            if (caught) { // Event was completely replaced -> stop applying effects to it\n                break;\n            }\n\n            // add the applied effect to the consumed effects\n            if (rEffect != null) {\n                if (consumed.containsKey(rEffect.getId())) {\n                    HashSet<UUID> set = consumed.get(rEffect.getId());\n                    if (rAbility != null) {\n                        if (!set.contains(rAbility.getId())) {\n                            set.add(rAbility.getId());\n                        }\n                    }\n                } else {\n                    HashSet<UUID> set = new HashSet<>();\n                    if (rAbility != null) { // in case of AuraReplacementEffect or PlaneswalkerReplacementEffect there is no Ability\n                        set.add(rAbility.getId());\n                    }\n                    consumed.put(rEffect.getId(), set);\n                }\n            }\n            // Must be called here for some effects to be able to work correctly\n            game.applyEffects();\n        } while (true);\n        return caught;\n    }",
            "path": "Mage/src/mage/abilities/effects/ContinuousEffects.java",
            "extendedDetails": {},
            "BugCommit": "0",
            "TangledWMoveandFileRename": "10"
        },
        "4f1368f3de90d177bd11f463e83f156aa70a5f3a": {
            "type": "Ybodychange",
            "commitMessage": "* Made a lot of changes to handling of continuous and triggered abilities. This should fix the problems with Mage Singletons like Flyinging / Intimidate / Reach not working. Fixed also #533 and some other problems with copy effects of cards like Clone that did not end if e.g. Clone left the battlefield.",
            "commitDate": "24/12/14 7:07 PM",
            "commitName": "4f1368f3de90d177bd11f463e83f156aa70a5f3a",
            "commitAuthor": "LevelX2",
            "commitDateOld": "06/12/14 11:29 AM",
            "commitNameOld": "2fae97be6300fcfc44826e041a7620a0cca14cb0",
            "commitAuthorOld": "LevelX2",
            "daysBetweenCommits": 18.32,
            "commitsBetweenForRepo": 103,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,106 +1,106 @@\n     public boolean replaceEvent(GameEvent event, Game game) {\n         boolean caught = false;\n         HashMap<UUID, HashSet<UUID>> consumed = new HashMap<>();\n         do {\n             HashMap<ReplacementEffect, HashSet<Ability>> rEffects = getApplicableReplacementEffects(event, game);\n             // Remove all consumed effects (ability dependant)\n             for (Iterator<ReplacementEffect> it1 = rEffects.keySet().iterator(); it1.hasNext();){\n                 ReplacementEffect entry = it1.next();\n                 if (consumed.containsKey(entry.getId())) {\n                     HashSet<UUID> consumedAbilitiesIds = consumed.get(entry.getId());\n                     if (rEffects.get(entry) == null || consumedAbilitiesIds.size() == rEffects.get(entry).size()) {\n                         it1.remove();\n                     } else {\n                         Iterator it = rEffects.get(entry).iterator();\n                         while (it.hasNext()) {\n                             Ability ability = (Ability) it.next();\n                             if (consumedAbilitiesIds.contains(ability.getId())) {\n                                 it.remove();\n                             }\n                         }\n                     }\n                 }\n             }\n             // no effects left, quit\n             if (rEffects.isEmpty()) {\n                 break;\n             }\n             int index;\n             boolean onlyOne = false;\n             if (rEffects.size() == 1) {\n                 ReplacementEffect effect = rEffects.keySet().iterator().next();\n                 HashSet<Ability> abilities = replacementEffects.getAbility(effect.getId());\n                 if (abilities == null || abilities.size() == 1) {\n                     onlyOne = true;\n                 }\n             }\n             if (onlyOne) {\n                 index = 0;\n             } else {\n                 //20100716 - 616.1c\n                 Player player = game.getPlayer(event.getPlayerId());\n                 index = player.chooseReplacementEffect(getReplacementEffectsTexts(rEffects, game), game);\n             }\n             // get the selected effect\n             int checked = 0;\n             ReplacementEffect rEffect = null;\n             Ability rAbility = null;\n             for (Map.Entry<ReplacementEffect, HashSet<Ability>> entry : rEffects.entrySet()) {\n                 if (entry.getValue() == null) {\n                     if (checked == index) {\n                         rEffect = entry.getKey();\n                         break;\n                     } else {\n                         checked++;\n                     }\n                 } else {\n                     HashSet<Ability> abilities = entry.getValue();\n                     int size = abilities.size();\n                     if (index > (checked + size - 1)) {\n                         checked += size;\n                     } else {\n                         rEffect = entry.getKey();\n                         Iterator it = abilities.iterator();\n                         while (it.hasNext() && rAbility == null) {\n                             if (checked == index) {\n                                 rAbility = (Ability) it.next();\n                             } else {\n                                 it.next();\n                                 checked++;\n                             }\n                         }\n                         break;\n                     }\n                 }                \n             }\n \n             if (rEffect != null) {\n                 event.getAppliedEffects().add(rEffect.getId());\n                 caught = rEffect.replaceEvent(event, rAbility, game);\n             }\n             if (caught) { // Event was completely replaced -> stop applying effects to it\n                 break;\n             }\n \n-            // add used effect to consumed effects\n+            // add the applied effect to the consumed effects\n             if (rEffect != null) {\n                 if (consumed.containsKey(rEffect.getId())) {\n                     HashSet<UUID> set = consumed.get(rEffect.getId());\n                     if (rAbility != null) {\n                         if (!set.contains(rAbility.getId())) {\n                             set.add(rAbility.getId());\n                         }\n                     }\n                 } else {\n                     HashSet<UUID> set = new HashSet<>();\n                     if (rAbility != null) { // in case of AuraReplacementEffect or PlaneswalkerReplacementEffect there is no Ability\n                         set.add(rAbility.getId());\n                     }\n                     consumed.put(rEffect.getId(), set);\n                 }\n             }\n-\n+            // Must be called here so some \n             game.applyEffects();\n         } while (true);\n         return caught;\n     }\n\\ No newline at end of file\n",
            "actualSource": "    public boolean replaceEvent(GameEvent event, Game game) {\n        boolean caught = false;\n        HashMap<UUID, HashSet<UUID>> consumed = new HashMap<>();\n        do {\n            HashMap<ReplacementEffect, HashSet<Ability>> rEffects = getApplicableReplacementEffects(event, game);\n            // Remove all consumed effects (ability dependant)\n            for (Iterator<ReplacementEffect> it1 = rEffects.keySet().iterator(); it1.hasNext();){\n                ReplacementEffect entry = it1.next();\n                if (consumed.containsKey(entry.getId())) {\n                    HashSet<UUID> consumedAbilitiesIds = consumed.get(entry.getId());\n                    if (rEffects.get(entry) == null || consumedAbilitiesIds.size() == rEffects.get(entry).size()) {\n                        it1.remove();\n                    } else {\n                        Iterator it = rEffects.get(entry).iterator();\n                        while (it.hasNext()) {\n                            Ability ability = (Ability) it.next();\n                            if (consumedAbilitiesIds.contains(ability.getId())) {\n                                it.remove();\n                            }\n                        }\n                    }\n                }\n            }\n            // no effects left, quit\n            if (rEffects.isEmpty()) {\n                break;\n            }\n            int index;\n            boolean onlyOne = false;\n            if (rEffects.size() == 1) {\n                ReplacementEffect effect = rEffects.keySet().iterator().next();\n                HashSet<Ability> abilities = replacementEffects.getAbility(effect.getId());\n                if (abilities == null || abilities.size() == 1) {\n                    onlyOne = true;\n                }\n            }\n            if (onlyOne) {\n                index = 0;\n            } else {\n                //20100716 - 616.1c\n                Player player = game.getPlayer(event.getPlayerId());\n                index = player.chooseReplacementEffect(getReplacementEffectsTexts(rEffects, game), game);\n            }\n            // get the selected effect\n            int checked = 0;\n            ReplacementEffect rEffect = null;\n            Ability rAbility = null;\n            for (Map.Entry<ReplacementEffect, HashSet<Ability>> entry : rEffects.entrySet()) {\n                if (entry.getValue() == null) {\n                    if (checked == index) {\n                        rEffect = entry.getKey();\n                        break;\n                    } else {\n                        checked++;\n                    }\n                } else {\n                    HashSet<Ability> abilities = entry.getValue();\n                    int size = abilities.size();\n                    if (index > (checked + size - 1)) {\n                        checked += size;\n                    } else {\n                        rEffect = entry.getKey();\n                        Iterator it = abilities.iterator();\n                        while (it.hasNext() && rAbility == null) {\n                            if (checked == index) {\n                                rAbility = (Ability) it.next();\n                            } else {\n                                it.next();\n                                checked++;\n                            }\n                        }\n                        break;\n                    }\n                }                \n            }\n\n            if (rEffect != null) {\n                event.getAppliedEffects().add(rEffect.getId());\n                caught = rEffect.replaceEvent(event, rAbility, game);\n            }\n            if (caught) { // Event was completely replaced -> stop applying effects to it\n                break;\n            }\n\n            // add the applied effect to the consumed effects\n            if (rEffect != null) {\n                if (consumed.containsKey(rEffect.getId())) {\n                    HashSet<UUID> set = consumed.get(rEffect.getId());\n                    if (rAbility != null) {\n                        if (!set.contains(rAbility.getId())) {\n                            set.add(rAbility.getId());\n                        }\n                    }\n                } else {\n                    HashSet<UUID> set = new HashSet<>();\n                    if (rAbility != null) { // in case of AuraReplacementEffect or PlaneswalkerReplacementEffect there is no Ability\n                        set.add(rAbility.getId());\n                    }\n                    consumed.put(rEffect.getId(), set);\n                }\n            }\n            // Must be called here so some \n            game.applyEffects();\n        } while (true);\n        return caught;\n    }",
            "path": "Mage/src/mage/abilities/effects/ContinuousEffects.java",
            "extendedDetails": {},
            "BugCommit": "0",
            "TangledWMoveandFileRename": "32"
        },
        "df71237f46239e3ec3772c324c582465557d68c5": {
            "type": "Ybodychange",
            "commitMessage": "* Added logic to auto select replacement effects. Some changes to counter size and font size handling.",
            "commitDate": "30/10/14 2:40 PM",
            "commitName": "df71237f46239e3ec3772c324c582465557d68c5",
            "commitAuthor": "LevelX2",
            "commitDateOld": "25/10/14 10:32 AM",
            "commitNameOld": "26b5a277c4404a93e3b41ba477c5ec58dedcf826",
            "commitAuthorOld": "LevelX2",
            "daysBetweenCommits": 5.17,
            "commitsBetweenForRepo": 32,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,106 +1,106 @@\n     public boolean replaceEvent(GameEvent event, Game game) {\n         boolean caught = false;\n         HashMap<UUID, HashSet<UUID>> consumed = new HashMap<>();\n         do {\n             HashMap<ReplacementEffect, HashSet<Ability>> rEffects = getApplicableReplacementEffects(event, game);\n             // Remove all consumed effects (ability dependant)\n             for (Iterator<ReplacementEffect> it1 = rEffects.keySet().iterator(); it1.hasNext();){\n                 ReplacementEffect entry = it1.next();\n                 if (consumed.containsKey(entry.getId())) {\n                     HashSet<UUID> consumedAbilitiesIds = consumed.get(entry.getId());\n                     if (rEffects.get(entry) == null || consumedAbilitiesIds.size() == rEffects.get(entry).size()) {\n                         it1.remove();\n                     } else {\n                         Iterator it = rEffects.get(entry).iterator();\n                         while (it.hasNext()) {\n                             Ability ability = (Ability) it.next();\n                             if (consumedAbilitiesIds.contains(ability.getId())) {\n                                 it.remove();\n                             }\n                         }\n                     }\n                 }\n             }\n             // no effects left, quit\n             if (rEffects.isEmpty()) {\n                 break;\n             }\n             int index;\n             boolean onlyOne = false;\n             if (rEffects.size() == 1) {\n                 ReplacementEffect effect = rEffects.keySet().iterator().next();\n                 HashSet<Ability> abilities = replacementEffects.getAbility(effect.getId());\n                 if (abilities == null || abilities.size() == 1) {\n                     onlyOne = true;\n                 }\n             }\n             if (onlyOne) {\n                 index = 0;\n             } else {\n                 //20100716 - 616.1c\n                 Player player = game.getPlayer(event.getPlayerId());\n-                index = player.chooseEffect(getReplacementEffectsTexts(rEffects, game), game);\n+                index = player.chooseReplacementEffect(getReplacementEffectsTexts(rEffects, game), game);\n             }\n             // get the selected effect\n             int checked = 0;\n             ReplacementEffect rEffect = null;\n             Ability rAbility = null;\n             for (Map.Entry<ReplacementEffect, HashSet<Ability>> entry : rEffects.entrySet()) {\n                 if (entry.getValue() == null) {\n                     if (checked == index) {\n                         rEffect = entry.getKey();\n                         break;\n                     } else {\n                         checked++;\n                     }\n                 } else {\n                     HashSet<Ability> abilities = entry.getValue();\n                     int size = abilities.size();\n                     if (index > (checked + size - 1)) {\n                         checked += size;\n                     } else {\n                         rEffect = entry.getKey();\n                         Iterator it = abilities.iterator();\n                         while (it.hasNext() && rAbility == null) {\n                             if (checked == index) {\n                                 rAbility = (Ability) it.next();\n                             } else {\n                                 it.next();\n                                 checked++;\n                             }\n                         }\n                         break;\n                     }\n                 }                \n             }\n \n             if (rEffect != null) {\n                 event.getAppliedEffects().add(rEffect.getId());\n                 caught = rEffect.replaceEvent(event, rAbility, game);\n             }\n             if (caught) { // Event was completely replaced -> stop applying effects to it\n                 break;\n             }\n \n             // add used effect to consumed effects\n             if (rEffect != null) {\n                 if (consumed.containsKey(rEffect.getId())) {\n                     HashSet<UUID> set = consumed.get(rEffect.getId());\n                     if (rAbility != null) {\n                         if (!set.contains(rAbility.getId())) {\n                             set.add(rAbility.getId());\n                         }\n                     }\n                 } else {\n                     HashSet<UUID> set = new HashSet<>();\n                     if (rAbility != null) { // in case of AuraReplacementEffect or PlaneswalkerReplacementEffect there is no Ability\n                         set.add(rAbility.getId());\n                     }\n                     consumed.put(rEffect.getId(), set);\n                 }\n             }\n \n             game.applyEffects();\n         } while (true);\n         return caught;\n     }\n\\ No newline at end of file\n",
            "actualSource": "    public boolean replaceEvent(GameEvent event, Game game) {\n        boolean caught = false;\n        HashMap<UUID, HashSet<UUID>> consumed = new HashMap<>();\n        do {\n            HashMap<ReplacementEffect, HashSet<Ability>> rEffects = getApplicableReplacementEffects(event, game);\n            // Remove all consumed effects (ability dependant)\n            for (Iterator<ReplacementEffect> it1 = rEffects.keySet().iterator(); it1.hasNext();){\n                ReplacementEffect entry = it1.next();\n                if (consumed.containsKey(entry.getId())) {\n                    HashSet<UUID> consumedAbilitiesIds = consumed.get(entry.getId());\n                    if (rEffects.get(entry) == null || consumedAbilitiesIds.size() == rEffects.get(entry).size()) {\n                        it1.remove();\n                    } else {\n                        Iterator it = rEffects.get(entry).iterator();\n                        while (it.hasNext()) {\n                            Ability ability = (Ability) it.next();\n                            if (consumedAbilitiesIds.contains(ability.getId())) {\n                                it.remove();\n                            }\n                        }\n                    }\n                }\n            }\n            // no effects left, quit\n            if (rEffects.isEmpty()) {\n                break;\n            }\n            int index;\n            boolean onlyOne = false;\n            if (rEffects.size() == 1) {\n                ReplacementEffect effect = rEffects.keySet().iterator().next();\n                HashSet<Ability> abilities = replacementEffects.getAbility(effect.getId());\n                if (abilities == null || abilities.size() == 1) {\n                    onlyOne = true;\n                }\n            }\n            if (onlyOne) {\n                index = 0;\n            } else {\n                //20100716 - 616.1c\n                Player player = game.getPlayer(event.getPlayerId());\n                index = player.chooseReplacementEffect(getReplacementEffectsTexts(rEffects, game), game);\n            }\n            // get the selected effect\n            int checked = 0;\n            ReplacementEffect rEffect = null;\n            Ability rAbility = null;\n            for (Map.Entry<ReplacementEffect, HashSet<Ability>> entry : rEffects.entrySet()) {\n                if (entry.getValue() == null) {\n                    if (checked == index) {\n                        rEffect = entry.getKey();\n                        break;\n                    } else {\n                        checked++;\n                    }\n                } else {\n                    HashSet<Ability> abilities = entry.getValue();\n                    int size = abilities.size();\n                    if (index > (checked + size - 1)) {\n                        checked += size;\n                    } else {\n                        rEffect = entry.getKey();\n                        Iterator it = abilities.iterator();\n                        while (it.hasNext() && rAbility == null) {\n                            if (checked == index) {\n                                rAbility = (Ability) it.next();\n                            } else {\n                                it.next();\n                                checked++;\n                            }\n                        }\n                        break;\n                    }\n                }                \n            }\n\n            if (rEffect != null) {\n                event.getAppliedEffects().add(rEffect.getId());\n                caught = rEffect.replaceEvent(event, rAbility, game);\n            }\n            if (caught) { // Event was completely replaced -> stop applying effects to it\n                break;\n            }\n\n            // add used effect to consumed effects\n            if (rEffect != null) {\n                if (consumed.containsKey(rEffect.getId())) {\n                    HashSet<UUID> set = consumed.get(rEffect.getId());\n                    if (rAbility != null) {\n                        if (!set.contains(rAbility.getId())) {\n                            set.add(rAbility.getId());\n                        }\n                    }\n                } else {\n                    HashSet<UUID> set = new HashSet<>();\n                    if (rAbility != null) { // in case of AuraReplacementEffect or PlaneswalkerReplacementEffect there is no Ability\n                        set.add(rAbility.getId());\n                    }\n                    consumed.put(rEffect.getId(), set);\n                }\n            }\n\n            game.applyEffects();\n        } while (true);\n        return caught;\n    }",
            "path": "Mage/src/mage/abilities/effects/ContinuousEffects.java",
            "extendedDetails": {},
            "BugCommit": "0",
            "TangledWMoveandFileRename": "49"
        },
        "a7fc5b9583d8f0cf41c95a9a49df5b08604f9e13": {
            "type": "Ybodychange",
            "commitMessage": "* Hushwing Gryff - Fixed a bug that the effect was wrongly implemented as replacement effect with potential to repalce other replacement effects. ",
            "commitDate": "09/08/14 9:40 AM",
            "commitName": "a7fc5b9583d8f0cf41c95a9a49df5b08604f9e13",
            "commitAuthor": "LevelX2",
            "commitDateOld": "09/08/14 4:48 AM",
            "commitNameOld": "2ca945fabf640239e04e36ca23476b769a7e6cfc",
            "commitAuthorOld": "LevelX2",
            "daysBetweenCommits": 0.2,
            "commitsBetweenForRepo": 2,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,109 +1,106 @@\n     public boolean replaceEvent(GameEvent event, Game game) {\n-        if (preventedByRuleModification(event, game, false)) {\n-            return true;\n-        }\n         boolean caught = false;\n         HashMap<UUID, HashSet<UUID>> consumed = new HashMap<>();\n         do {\n             HashMap<ReplacementEffect, HashSet<Ability>> rEffects = getApplicableReplacementEffects(event, game);\n             // Remove all consumed effects (ability dependant)\n             for (Iterator<ReplacementEffect> it1 = rEffects.keySet().iterator(); it1.hasNext();){\n                 ReplacementEffect entry = it1.next();\n                 if (consumed.containsKey(entry.getId())) {\n                     HashSet<UUID> consumedAbilitiesIds = consumed.get(entry.getId());\n                     if (rEffects.get(entry) == null || consumedAbilitiesIds.size() == rEffects.get(entry).size()) {\n                         it1.remove();\n                     } else {\n                         Iterator it = rEffects.get(entry).iterator();\n                         while (it.hasNext()) {\n                             Ability ability = (Ability) it.next();\n                             if (consumedAbilitiesIds.contains(ability.getId())) {\n                                 it.remove();\n                             }\n                         }\n                     }\n                 }\n             }\n             // no effects left, quit\n             if (rEffects.isEmpty()) {\n                 break;\n             }\n             int index;\n             boolean onlyOne = false;\n             if (rEffects.size() == 1) {\n                 ReplacementEffect effect = rEffects.keySet().iterator().next();\n                 HashSet<Ability> abilities = replacementEffects.getAbility(effect.getId());\n                 if (abilities == null || abilities.size() == 1) {\n                     onlyOne = true;\n                 }\n             }\n             if (onlyOne) {\n                 index = 0;\n             } else {\n                 //20100716 - 616.1c\n                 Player player = game.getPlayer(event.getPlayerId());\n                 index = player.chooseEffect(getReplacementEffectsTexts(rEffects, game), game);\n             }\n             // get the selected effect\n             int checked = 0;\n             ReplacementEffect rEffect = null;\n             Ability rAbility = null;\n             for (Map.Entry<ReplacementEffect, HashSet<Ability>> entry : rEffects.entrySet()) {\n                 if (entry.getValue() == null) {\n                     if (checked == index) {\n                         rEffect = entry.getKey();\n                         break;\n                     } else {\n                         checked++;\n                     }\n                 } else {\n                     HashSet<Ability> abilities = entry.getValue();\n                     int size = abilities.size();\n                     if (index > (checked + size - 1)) {\n                         checked += size;\n                     } else {\n                         rEffect = entry.getKey();\n                         Iterator it = abilities.iterator();\n                         while (it.hasNext() && rAbility == null) {\n                             if (checked == index) {\n                                 rAbility = (Ability) it.next();\n                             } else {\n                                 it.next();\n                                 checked++;\n                             }\n                         }\n                         break;\n                     }\n                 }                \n             }\n \n             if (rEffect != null) {\n                 event.getAppliedEffects().add(rEffect.getId());\n                 caught = rEffect.replaceEvent(event, rAbility, game);\n             }\n             if (caught) { // Event was completely replaced -> stop applying effects to it\n                 break;\n             }\n \n             // add used effect to consumed effects\n             if (rEffect != null) {\n                 if (consumed.containsKey(rEffect.getId())) {\n                     HashSet<UUID> set = consumed.get(rEffect.getId());\n                     if (rAbility != null) {\n                         if (!set.contains(rAbility.getId())) {\n                             set.add(rAbility.getId());\n                         }\n                     }\n                 } else {\n                     HashSet<UUID> set = new HashSet<>();\n                     if (rAbility != null) { // in case of AuraReplacementEffect or PlaneswalkerReplacementEffect there is no Ability\n                         set.add(rAbility.getId());\n                     }\n                     consumed.put(rEffect.getId(), set);\n                 }\n             }\n \n             game.applyEffects();\n         } while (true);\n         return caught;\n     }\n\\ No newline at end of file\n",
            "actualSource": "    public boolean replaceEvent(GameEvent event, Game game) {\n        boolean caught = false;\n        HashMap<UUID, HashSet<UUID>> consumed = new HashMap<>();\n        do {\n            HashMap<ReplacementEffect, HashSet<Ability>> rEffects = getApplicableReplacementEffects(event, game);\n            // Remove all consumed effects (ability dependant)\n            for (Iterator<ReplacementEffect> it1 = rEffects.keySet().iterator(); it1.hasNext();){\n                ReplacementEffect entry = it1.next();\n                if (consumed.containsKey(entry.getId())) {\n                    HashSet<UUID> consumedAbilitiesIds = consumed.get(entry.getId());\n                    if (rEffects.get(entry) == null || consumedAbilitiesIds.size() == rEffects.get(entry).size()) {\n                        it1.remove();\n                    } else {\n                        Iterator it = rEffects.get(entry).iterator();\n                        while (it.hasNext()) {\n                            Ability ability = (Ability) it.next();\n                            if (consumedAbilitiesIds.contains(ability.getId())) {\n                                it.remove();\n                            }\n                        }\n                    }\n                }\n            }\n            // no effects left, quit\n            if (rEffects.isEmpty()) {\n                break;\n            }\n            int index;\n            boolean onlyOne = false;\n            if (rEffects.size() == 1) {\n                ReplacementEffect effect = rEffects.keySet().iterator().next();\n                HashSet<Ability> abilities = replacementEffects.getAbility(effect.getId());\n                if (abilities == null || abilities.size() == 1) {\n                    onlyOne = true;\n                }\n            }\n            if (onlyOne) {\n                index = 0;\n            } else {\n                //20100716 - 616.1c\n                Player player = game.getPlayer(event.getPlayerId());\n                index = player.chooseEffect(getReplacementEffectsTexts(rEffects, game), game);\n            }\n            // get the selected effect\n            int checked = 0;\n            ReplacementEffect rEffect = null;\n            Ability rAbility = null;\n            for (Map.Entry<ReplacementEffect, HashSet<Ability>> entry : rEffects.entrySet()) {\n                if (entry.getValue() == null) {\n                    if (checked == index) {\n                        rEffect = entry.getKey();\n                        break;\n                    } else {\n                        checked++;\n                    }\n                } else {\n                    HashSet<Ability> abilities = entry.getValue();\n                    int size = abilities.size();\n                    if (index > (checked + size - 1)) {\n                        checked += size;\n                    } else {\n                        rEffect = entry.getKey();\n                        Iterator it = abilities.iterator();\n                        while (it.hasNext() && rAbility == null) {\n                            if (checked == index) {\n                                rAbility = (Ability) it.next();\n                            } else {\n                                it.next();\n                                checked++;\n                            }\n                        }\n                        break;\n                    }\n                }                \n            }\n\n            if (rEffect != null) {\n                event.getAppliedEffects().add(rEffect.getId());\n                caught = rEffect.replaceEvent(event, rAbility, game);\n            }\n            if (caught) { // Event was completely replaced -> stop applying effects to it\n                break;\n            }\n\n            // add used effect to consumed effects\n            if (rEffect != null) {\n                if (consumed.containsKey(rEffect.getId())) {\n                    HashSet<UUID> set = consumed.get(rEffect.getId());\n                    if (rAbility != null) {\n                        if (!set.contains(rAbility.getId())) {\n                            set.add(rAbility.getId());\n                        }\n                    }\n                } else {\n                    HashSet<UUID> set = new HashSet<>();\n                    if (rAbility != null) { // in case of AuraReplacementEffect or PlaneswalkerReplacementEffect there is no Ability\n                        set.add(rAbility.getId());\n                    }\n                    consumed.put(rEffect.getId(), set);\n                }\n            }\n\n            game.applyEffects();\n        } while (true);\n        return caught;\n    }",
            "path": "Mage/src/mage/abilities/effects/ContinuousEffects.java",
            "extendedDetails": {},
            "BugCommit": "0",
            "TangledWMoveandFileRename": "3"
        },
        "05a2e09b2a38af8e8abf85d95f7cf74323b513f3": {
            "type": "Ybodychange",
            "commitMessage": "Adeded ContinuousRuleModifyingEffect and handling for it. This effects will also be taken into account when checking if a spell gets yellow frame if it can be cast.",
            "commitDate": "25/07/14 6:09 AM",
            "commitName": "05a2e09b2a38af8e8abf85d95f7cf74323b513f3",
            "commitAuthor": "LevelX2",
            "commitDateOld": "23/07/14 10:42 AM",
            "commitNameOld": "45618309fbd2e172015a4c6de00e02b72760c011",
            "commitAuthorOld": "LevelX2",
            "daysBetweenCommits": 1.81,
            "commitsBetweenForRepo": 11,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,106 +1,109 @@\n     public boolean replaceEvent(GameEvent event, Game game) {\n+        if (preventedByRuleModification(event, game, false)) {\n+            return true;\n+        }\n         boolean caught = false;\n         HashMap<UUID, HashSet<UUID>> consumed = new HashMap<>();\n         do {\n             HashMap<ReplacementEffect, HashSet<Ability>> rEffects = getApplicableReplacementEffects(event, game);\n             // Remove all consumed effects (ability dependant)\n             for (Iterator<ReplacementEffect> it1 = rEffects.keySet().iterator(); it1.hasNext();){\n                 ReplacementEffect entry = it1.next();\n                 if (consumed.containsKey(entry.getId())) {\n                     HashSet<UUID> consumedAbilitiesIds = consumed.get(entry.getId());\n                     if (rEffects.get(entry) == null || consumedAbilitiesIds.size() == rEffects.get(entry).size()) {\n                         it1.remove();\n                     } else {\n                         Iterator it = rEffects.get(entry).iterator();\n                         while (it.hasNext()) {\n                             Ability ability = (Ability) it.next();\n                             if (consumedAbilitiesIds.contains(ability.getId())) {\n                                 it.remove();\n                             }\n                         }\n                     }\n                 }\n             }\n             // no effects left, quit\n             if (rEffects.isEmpty()) {\n                 break;\n             }\n             int index;\n             boolean onlyOne = false;\n             if (rEffects.size() == 1) {\n                 ReplacementEffect effect = rEffects.keySet().iterator().next();\n                 HashSet<Ability> abilities = replacementEffects.getAbility(effect.getId());\n                 if (abilities == null || abilities.size() == 1) {\n                     onlyOne = true;\n                 }\n             }\n             if (onlyOne) {\n                 index = 0;\n             } else {\n                 //20100716 - 616.1c\n                 Player player = game.getPlayer(event.getPlayerId());\n                 index = player.chooseEffect(getReplacementEffectsTexts(rEffects, game), game);\n             }\n             // get the selected effect\n             int checked = 0;\n             ReplacementEffect rEffect = null;\n             Ability rAbility = null;\n             for (Map.Entry<ReplacementEffect, HashSet<Ability>> entry : rEffects.entrySet()) {\n                 if (entry.getValue() == null) {\n                     if (checked == index) {\n                         rEffect = entry.getKey();\n                         break;\n                     } else {\n                         checked++;\n                     }\n                 } else {\n                     HashSet<Ability> abilities = entry.getValue();\n                     int size = abilities.size();\n                     if (index > (checked + size - 1)) {\n                         checked += size;\n                     } else {\n                         rEffect = entry.getKey();\n                         Iterator it = abilities.iterator();\n                         while (it.hasNext() && rAbility == null) {\n                             if (checked == index) {\n                                 rAbility = (Ability) it.next();\n                             } else {\n                                 it.next();\n                                 checked++;\n                             }\n                         }\n                         break;\n                     }\n                 }                \n             }\n \n             if (rEffect != null) {\n                 event.getAppliedEffects().add(rEffect.getId());\n                 caught = rEffect.replaceEvent(event, rAbility, game);\n             }\n             if (caught) { // Event was completely replaced -> stop applying effects to it\n                 break;\n             }\n \n             // add used effect to consumed effects\n             if (rEffect != null) {\n                 if (consumed.containsKey(rEffect.getId())) {\n                     HashSet<UUID> set = consumed.get(rEffect.getId());\n                     if (rAbility != null) {\n                         if (!set.contains(rAbility.getId())) {\n                             set.add(rAbility.getId());\n                         }\n                     }\n                 } else {\n                     HashSet<UUID> set = new HashSet<>();\n                     if (rAbility != null) { // in case of AuraReplacementEffect or PlaneswalkerReplacementEffect there is no Ability\n                         set.add(rAbility.getId());\n                     }\n                     consumed.put(rEffect.getId(), set);\n                 }\n             }\n \n             game.applyEffects();\n         } while (true);\n         return caught;\n     }\n\\ No newline at end of file\n",
            "actualSource": "    public boolean replaceEvent(GameEvent event, Game game) {\n        if (preventedByRuleModification(event, game, false)) {\n            return true;\n        }\n        boolean caught = false;\n        HashMap<UUID, HashSet<UUID>> consumed = new HashMap<>();\n        do {\n            HashMap<ReplacementEffect, HashSet<Ability>> rEffects = getApplicableReplacementEffects(event, game);\n            // Remove all consumed effects (ability dependant)\n            for (Iterator<ReplacementEffect> it1 = rEffects.keySet().iterator(); it1.hasNext();){\n                ReplacementEffect entry = it1.next();\n                if (consumed.containsKey(entry.getId())) {\n                    HashSet<UUID> consumedAbilitiesIds = consumed.get(entry.getId());\n                    if (rEffects.get(entry) == null || consumedAbilitiesIds.size() == rEffects.get(entry).size()) {\n                        it1.remove();\n                    } else {\n                        Iterator it = rEffects.get(entry).iterator();\n                        while (it.hasNext()) {\n                            Ability ability = (Ability) it.next();\n                            if (consumedAbilitiesIds.contains(ability.getId())) {\n                                it.remove();\n                            }\n                        }\n                    }\n                }\n            }\n            // no effects left, quit\n            if (rEffects.isEmpty()) {\n                break;\n            }\n            int index;\n            boolean onlyOne = false;\n            if (rEffects.size() == 1) {\n                ReplacementEffect effect = rEffects.keySet().iterator().next();\n                HashSet<Ability> abilities = replacementEffects.getAbility(effect.getId());\n                if (abilities == null || abilities.size() == 1) {\n                    onlyOne = true;\n                }\n            }\n            if (onlyOne) {\n                index = 0;\n            } else {\n                //20100716 - 616.1c\n                Player player = game.getPlayer(event.getPlayerId());\n                index = player.chooseEffect(getReplacementEffectsTexts(rEffects, game), game);\n            }\n            // get the selected effect\n            int checked = 0;\n            ReplacementEffect rEffect = null;\n            Ability rAbility = null;\n            for (Map.Entry<ReplacementEffect, HashSet<Ability>> entry : rEffects.entrySet()) {\n                if (entry.getValue() == null) {\n                    if (checked == index) {\n                        rEffect = entry.getKey();\n                        break;\n                    } else {\n                        checked++;\n                    }\n                } else {\n                    HashSet<Ability> abilities = entry.getValue();\n                    int size = abilities.size();\n                    if (index > (checked + size - 1)) {\n                        checked += size;\n                    } else {\n                        rEffect = entry.getKey();\n                        Iterator it = abilities.iterator();\n                        while (it.hasNext() && rAbility == null) {\n                            if (checked == index) {\n                                rAbility = (Ability) it.next();\n                            } else {\n                                it.next();\n                                checked++;\n                            }\n                        }\n                        break;\n                    }\n                }                \n            }\n\n            if (rEffect != null) {\n                event.getAppliedEffects().add(rEffect.getId());\n                caught = rEffect.replaceEvent(event, rAbility, game);\n            }\n            if (caught) { // Event was completely replaced -> stop applying effects to it\n                break;\n            }\n\n            // add used effect to consumed effects\n            if (rEffect != null) {\n                if (consumed.containsKey(rEffect.getId())) {\n                    HashSet<UUID> set = consumed.get(rEffect.getId());\n                    if (rAbility != null) {\n                        if (!set.contains(rAbility.getId())) {\n                            set.add(rAbility.getId());\n                        }\n                    }\n                } else {\n                    HashSet<UUID> set = new HashSet<>();\n                    if (rAbility != null) { // in case of AuraReplacementEffect or PlaneswalkerReplacementEffect there is no Ability\n                        set.add(rAbility.getId());\n                    }\n                    consumed.put(rEffect.getId(), set);\n                }\n            }\n\n            game.applyEffects();\n        } while (true);\n        return caught;\n    }",
            "path": "Mage/src/mage/abilities/effects/ContinuousEffects.java",
            "extendedDetails": {},
            "BugCommit": "0",
            "TangledWMoveandFileRename": "9"
        },
        "45618309fbd2e172015a4c6de00e02b72760c011": {
            "type": "Ybodychange",
            "commitMessage": "Removed some redundant casts. Added missing type definitions.",
            "commitDate": "23/07/14 10:42 AM",
            "commitName": "45618309fbd2e172015a4c6de00e02b72760c011",
            "commitAuthor": "LevelX2",
            "commitDateOld": "21/07/14 6:03 AM",
            "commitNameOld": "142e95fe421c99e374ff376fa9b61a7b0ba264dc",
            "commitAuthorOld": "LevelX2",
            "daysBetweenCommits": 2.19,
            "commitsBetweenForRepo": 22,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,106 +1,106 @@\n     public boolean replaceEvent(GameEvent event, Game game) {\n         boolean caught = false;\n         HashMap<UUID, HashSet<UUID>> consumed = new HashMap<>();\n         do {\n             HashMap<ReplacementEffect, HashSet<Ability>> rEffects = getApplicableReplacementEffects(event, game);\n             // Remove all consumed effects (ability dependant)\n             for (Iterator<ReplacementEffect> it1 = rEffects.keySet().iterator(); it1.hasNext();){\n                 ReplacementEffect entry = it1.next();\n                 if (consumed.containsKey(entry.getId())) {\n                     HashSet<UUID> consumedAbilitiesIds = consumed.get(entry.getId());\n-                    if (rEffects.get(entry) == null || consumedAbilitiesIds.size() == ((HashSet<Ability>) rEffects.get(entry)).size()) {\n+                    if (rEffects.get(entry) == null || consumedAbilitiesIds.size() == rEffects.get(entry).size()) {\n                         it1.remove();\n                     } else {\n-                        Iterator it = ((HashSet<Ability>) rEffects.get(entry)).iterator();\n+                        Iterator it = rEffects.get(entry).iterator();\n                         while (it.hasNext()) {\n                             Ability ability = (Ability) it.next();\n                             if (consumedAbilitiesIds.contains(ability.getId())) {\n                                 it.remove();\n                             }\n                         }\n                     }\n                 }\n             }\n             // no effects left, quit\n             if (rEffects.isEmpty()) {\n                 break;\n             }\n             int index;\n             boolean onlyOne = false;\n             if (rEffects.size() == 1) {\n-                ReplacementEffect effect = (ReplacementEffect) rEffects.keySet().iterator().next();\n+                ReplacementEffect effect = rEffects.keySet().iterator().next();\n                 HashSet<Ability> abilities = replacementEffects.getAbility(effect.getId());\n                 if (abilities == null || abilities.size() == 1) {\n                     onlyOne = true;\n                 }\n             }\n             if (onlyOne) {\n                 index = 0;\n             } else {\n                 //20100716 - 616.1c\n                 Player player = game.getPlayer(event.getPlayerId());\n                 index = player.chooseEffect(getReplacementEffectsTexts(rEffects, game), game);\n             }\n             // get the selected effect\n             int checked = 0;\n             ReplacementEffect rEffect = null;\n             Ability rAbility = null;\n-            for (Map.Entry entry : rEffects.entrySet()) {\n+            for (Map.Entry<ReplacementEffect, HashSet<Ability>> entry : rEffects.entrySet()) {\n                 if (entry.getValue() == null) {\n                     if (checked == index) {\n-                        rEffect = (ReplacementEffect) entry.getKey();\n+                        rEffect = entry.getKey();\n                         break;\n                     } else {\n                         checked++;\n                     }\n                 } else {\n-                    HashSet<Ability> abilities = (HashSet<Ability>) entry.getValue();\n+                    HashSet<Ability> abilities = entry.getValue();\n                     int size = abilities.size();\n                     if (index > (checked + size - 1)) {\n                         checked += size;\n                     } else {\n-                        rEffect = (ReplacementEffect) entry.getKey();\n+                        rEffect = entry.getKey();\n                         Iterator it = abilities.iterator();\n                         while (it.hasNext() && rAbility == null) {\n                             if (checked == index) {\n                                 rAbility = (Ability) it.next();\n                             } else {\n                                 it.next();\n                                 checked++;\n                             }\n                         }\n                         break;\n                     }\n                 }                \n             }\n \n             if (rEffect != null) {\n                 event.getAppliedEffects().add(rEffect.getId());\n                 caught = rEffect.replaceEvent(event, rAbility, game);\n             }\n             if (caught) { // Event was completely replaced -> stop applying effects to it\n                 break;\n             }\n \n             // add used effect to consumed effects\n             if (rEffect != null) {\n                 if (consumed.containsKey(rEffect.getId())) {\n                     HashSet<UUID> set = consumed.get(rEffect.getId());\n                     if (rAbility != null) {\n                         if (!set.contains(rAbility.getId())) {\n                             set.add(rAbility.getId());\n                         }\n                     }\n                 } else {\n                     HashSet<UUID> set = new HashSet<>();\n                     if (rAbility != null) { // in case of AuraReplacementEffect or PlaneswalkerReplacementEffect there is no Ability\n                         set.add(rAbility.getId());\n                     }\n                     consumed.put(rEffect.getId(), set);\n                 }\n             }\n \n             game.applyEffects();\n         } while (true);\n         return caught;\n     }\n\\ No newline at end of file\n",
            "actualSource": "    public boolean replaceEvent(GameEvent event, Game game) {\n        boolean caught = false;\n        HashMap<UUID, HashSet<UUID>> consumed = new HashMap<>();\n        do {\n            HashMap<ReplacementEffect, HashSet<Ability>> rEffects = getApplicableReplacementEffects(event, game);\n            // Remove all consumed effects (ability dependant)\n            for (Iterator<ReplacementEffect> it1 = rEffects.keySet().iterator(); it1.hasNext();){\n                ReplacementEffect entry = it1.next();\n                if (consumed.containsKey(entry.getId())) {\n                    HashSet<UUID> consumedAbilitiesIds = consumed.get(entry.getId());\n                    if (rEffects.get(entry) == null || consumedAbilitiesIds.size() == rEffects.get(entry).size()) {\n                        it1.remove();\n                    } else {\n                        Iterator it = rEffects.get(entry).iterator();\n                        while (it.hasNext()) {\n                            Ability ability = (Ability) it.next();\n                            if (consumedAbilitiesIds.contains(ability.getId())) {\n                                it.remove();\n                            }\n                        }\n                    }\n                }\n            }\n            // no effects left, quit\n            if (rEffects.isEmpty()) {\n                break;\n            }\n            int index;\n            boolean onlyOne = false;\n            if (rEffects.size() == 1) {\n                ReplacementEffect effect = rEffects.keySet().iterator().next();\n                HashSet<Ability> abilities = replacementEffects.getAbility(effect.getId());\n                if (abilities == null || abilities.size() == 1) {\n                    onlyOne = true;\n                }\n            }\n            if (onlyOne) {\n                index = 0;\n            } else {\n                //20100716 - 616.1c\n                Player player = game.getPlayer(event.getPlayerId());\n                index = player.chooseEffect(getReplacementEffectsTexts(rEffects, game), game);\n            }\n            // get the selected effect\n            int checked = 0;\n            ReplacementEffect rEffect = null;\n            Ability rAbility = null;\n            for (Map.Entry<ReplacementEffect, HashSet<Ability>> entry : rEffects.entrySet()) {\n                if (entry.getValue() == null) {\n                    if (checked == index) {\n                        rEffect = entry.getKey();\n                        break;\n                    } else {\n                        checked++;\n                    }\n                } else {\n                    HashSet<Ability> abilities = entry.getValue();\n                    int size = abilities.size();\n                    if (index > (checked + size - 1)) {\n                        checked += size;\n                    } else {\n                        rEffect = entry.getKey();\n                        Iterator it = abilities.iterator();\n                        while (it.hasNext() && rAbility == null) {\n                            if (checked == index) {\n                                rAbility = (Ability) it.next();\n                            } else {\n                                it.next();\n                                checked++;\n                            }\n                        }\n                        break;\n                    }\n                }                \n            }\n\n            if (rEffect != null) {\n                event.getAppliedEffects().add(rEffect.getId());\n                caught = rEffect.replaceEvent(event, rAbility, game);\n            }\n            if (caught) { // Event was completely replaced -> stop applying effects to it\n                break;\n            }\n\n            // add used effect to consumed effects\n            if (rEffect != null) {\n                if (consumed.containsKey(rEffect.getId())) {\n                    HashSet<UUID> set = consumed.get(rEffect.getId());\n                    if (rAbility != null) {\n                        if (!set.contains(rAbility.getId())) {\n                            set.add(rAbility.getId());\n                        }\n                    }\n                } else {\n                    HashSet<UUID> set = new HashSet<>();\n                    if (rAbility != null) { // in case of AuraReplacementEffect or PlaneswalkerReplacementEffect there is no Ability\n                        set.add(rAbility.getId());\n                    }\n                    consumed.put(rEffect.getId(), set);\n                }\n            }\n\n            game.applyEffects();\n        } while (true);\n        return caught;\n    }",
            "path": "Mage/src/mage/abilities/effects/ContinuousEffects.java",
            "extendedDetails": {},
            "BugCommit": "0",
            "TangledWMoveandFileRename": "4"
        },
        "d8236a8d3a4834e23276d5a13bac80ce1a8b4790": {
            "type": "Ybodychange",
            "commitMessage": "* Fixed that ThoughtAs effects could be used by any player instead of only the controller of the effect. (Fixes e.g. that Misthollow Griffin could be cast by any player from exile).",
            "commitDate": "10/03/14 6:14 PM",
            "commitName": "d8236a8d3a4834e23276d5a13bac80ce1a8b4790",
            "commitAuthor": "LevelX2",
            "commitDateOld": "30/01/14 8:01 AM",
            "commitNameOld": "f32b28abccc485113bd91dbebbc1b08178aaa877",
            "commitAuthorOld": "LevelX2",
            "daysBetweenCommits": 39.38,
            "commitsBetweenForRepo": 181,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,106 +1,106 @@\n     public boolean replaceEvent(GameEvent event, Game game) {\n         boolean caught = false;\n-        HashMap<UUID, HashSet<UUID>> consumed = new HashMap<UUID, HashSet<UUID>>();\n+        HashMap<UUID, HashSet<UUID>> consumed = new HashMap<>();\n         do {\n             HashMap<ReplacementEffect, HashSet<Ability>> rEffects = getApplicableReplacementEffects(event, game);\n             // Remove all consumed effects (ability dependant)\n             for (Iterator<ReplacementEffect> it1 = rEffects.keySet().iterator(); it1.hasNext();){\n                 ReplacementEffect entry = it1.next();\n                 if (consumed.containsKey(entry.getId())) {\n                     HashSet<UUID> consumedAbilitiesIds = consumed.get(entry.getId());\n                     if (rEffects.get(entry) == null || consumedAbilitiesIds.size() == ((HashSet<Ability>) rEffects.get(entry)).size()) {\n                         it1.remove();\n                     } else {\n                         Iterator it = ((HashSet<Ability>) rEffects.get(entry)).iterator();\n                         while (it.hasNext()) {\n                             Ability ability = (Ability) it.next();\n                             if (consumedAbilitiesIds.contains(ability.getId())) {\n                                 it.remove();\n                             }\n                         }\n                     }\n                 }\n             }\n             // no effects left, quit\n             if (rEffects.isEmpty()) {\n                 break;\n             }\n             int index;\n             boolean onlyOne = false;\n             if (rEffects.size() == 1) {\n                 ReplacementEffect effect = (ReplacementEffect) rEffects.keySet().iterator().next();\n                 HashSet<Ability> abilities = replacementEffects.getAbility(effect.getId());\n                 if (abilities == null || abilities.size() == 1) {\n                     onlyOne = true;\n                 }\n             }\n             if (onlyOne) {\n                 index = 0;\n             } else {\n                 //20100716 - 616.1c\n                 Player player = game.getPlayer(event.getPlayerId());\n                 index = player.chooseEffect(getReplacementEffectsTexts(rEffects, game), game);\n             }\n             // get the selected effect\n             int checked = 0;\n             ReplacementEffect rEffect = null;\n             Ability rAbility = null;\n             for (Map.Entry entry : rEffects.entrySet()) {\n                 if (entry.getValue() == null) {\n                     if (checked == index) {\n                         rEffect = (ReplacementEffect) entry.getKey();\n                         break;\n                     } else {\n                         checked++;\n                     }\n                 } else {\n                     HashSet<Ability> abilities = (HashSet<Ability>) entry.getValue();\n                     int size = abilities.size();\n                     if (index > (checked + size - 1)) {\n                         checked += size;\n                     } else {\n                         rEffect = (ReplacementEffect) entry.getKey();\n                         Iterator it = abilities.iterator();\n                         while (it.hasNext() && rAbility == null) {\n                             if (checked == index) {\n                                 rAbility = (Ability) it.next();\n                             } else {\n                                 it.next();\n                                 checked++;\n                             }\n                         }\n                         break;\n                     }\n                 }                \n             }\n \n             if (rEffect != null) {\n                 event.getAppliedEffects().add(rEffect.getId());\n                 caught = rEffect.replaceEvent(event, rAbility, game);\n             }\n             if (caught) { // Event was completely replaced -> stop applying effects to it\n                 break;\n             }\n \n             // add used effect to consumed effects\n             if (rEffect != null) {\n                 if (consumed.containsKey(rEffect.getId())) {\n                     HashSet<UUID> set = consumed.get(rEffect.getId());\n                     if (rAbility != null) {\n                         if (!set.contains(rAbility.getId())) {\n                             set.add(rAbility.getId());\n                         }\n                     }\n                 } else {\n-                    HashSet<UUID> set = new HashSet<UUID>();\n+                    HashSet<UUID> set = new HashSet<>();\n                     if (rAbility != null) { // in case of AuraReplacementEffect or PlaneswalkerReplacementEffect there is no Ability\n                         set.add(rAbility.getId());\n                     }\n                     consumed.put(rEffect.getId(), set);\n                 }\n             }\n \n             game.applyEffects();\n         } while (true);\n         return caught;\n     }\n\\ No newline at end of file\n",
            "actualSource": "    public boolean replaceEvent(GameEvent event, Game game) {\n        boolean caught = false;\n        HashMap<UUID, HashSet<UUID>> consumed = new HashMap<>();\n        do {\n            HashMap<ReplacementEffect, HashSet<Ability>> rEffects = getApplicableReplacementEffects(event, game);\n            // Remove all consumed effects (ability dependant)\n            for (Iterator<ReplacementEffect> it1 = rEffects.keySet().iterator(); it1.hasNext();){\n                ReplacementEffect entry = it1.next();\n                if (consumed.containsKey(entry.getId())) {\n                    HashSet<UUID> consumedAbilitiesIds = consumed.get(entry.getId());\n                    if (rEffects.get(entry) == null || consumedAbilitiesIds.size() == ((HashSet<Ability>) rEffects.get(entry)).size()) {\n                        it1.remove();\n                    } else {\n                        Iterator it = ((HashSet<Ability>) rEffects.get(entry)).iterator();\n                        while (it.hasNext()) {\n                            Ability ability = (Ability) it.next();\n                            if (consumedAbilitiesIds.contains(ability.getId())) {\n                                it.remove();\n                            }\n                        }\n                    }\n                }\n            }\n            // no effects left, quit\n            if (rEffects.isEmpty()) {\n                break;\n            }\n            int index;\n            boolean onlyOne = false;\n            if (rEffects.size() == 1) {\n                ReplacementEffect effect = (ReplacementEffect) rEffects.keySet().iterator().next();\n                HashSet<Ability> abilities = replacementEffects.getAbility(effect.getId());\n                if (abilities == null || abilities.size() == 1) {\n                    onlyOne = true;\n                }\n            }\n            if (onlyOne) {\n                index = 0;\n            } else {\n                //20100716 - 616.1c\n                Player player = game.getPlayer(event.getPlayerId());\n                index = player.chooseEffect(getReplacementEffectsTexts(rEffects, game), game);\n            }\n            // get the selected effect\n            int checked = 0;\n            ReplacementEffect rEffect = null;\n            Ability rAbility = null;\n            for (Map.Entry entry : rEffects.entrySet()) {\n                if (entry.getValue() == null) {\n                    if (checked == index) {\n                        rEffect = (ReplacementEffect) entry.getKey();\n                        break;\n                    } else {\n                        checked++;\n                    }\n                } else {\n                    HashSet<Ability> abilities = (HashSet<Ability>) entry.getValue();\n                    int size = abilities.size();\n                    if (index > (checked + size - 1)) {\n                        checked += size;\n                    } else {\n                        rEffect = (ReplacementEffect) entry.getKey();\n                        Iterator it = abilities.iterator();\n                        while (it.hasNext() && rAbility == null) {\n                            if (checked == index) {\n                                rAbility = (Ability) it.next();\n                            } else {\n                                it.next();\n                                checked++;\n                            }\n                        }\n                        break;\n                    }\n                }                \n            }\n\n            if (rEffect != null) {\n                event.getAppliedEffects().add(rEffect.getId());\n                caught = rEffect.replaceEvent(event, rAbility, game);\n            }\n            if (caught) { // Event was completely replaced -> stop applying effects to it\n                break;\n            }\n\n            // add used effect to consumed effects\n            if (rEffect != null) {\n                if (consumed.containsKey(rEffect.getId())) {\n                    HashSet<UUID> set = consumed.get(rEffect.getId());\n                    if (rAbility != null) {\n                        if (!set.contains(rAbility.getId())) {\n                            set.add(rAbility.getId());\n                        }\n                    }\n                } else {\n                    HashSet<UUID> set = new HashSet<>();\n                    if (rAbility != null) { // in case of AuraReplacementEffect or PlaneswalkerReplacementEffect there is no Ability\n                        set.add(rAbility.getId());\n                    }\n                    consumed.put(rEffect.getId(), set);\n                }\n            }\n\n            game.applyEffects();\n        } while (true);\n        return caught;\n    }",
            "path": "Mage/src/mage/abilities/effects/ContinuousEffects.java",
            "extendedDetails": {},
            "BugCommit": "0",
            "TangledWMoveandFileRename": "34"
        },
        "8b6cfc952996df8c40fcc998a5eea3f69c6a851d": {
            "type": "Ybodychange",
            "commitMessage": "Fixed a bug with multiple replacement effect.  The bug appear with the fix of #198 and #196",
            "commitDate": "23/07/13 4:20 PM",
            "commitName": "8b6cfc952996df8c40fcc998a5eea3f69c6a851d",
            "commitAuthor": "Plopman",
            "commitDateOld": "29/06/13 1:50 PM",
            "commitNameOld": "3572cbdc87f07fc7069fa7dd2dd278e3ed1fd106",
            "commitAuthorOld": "LevelX2",
            "daysBetweenCommits": 24.1,
            "commitsBetweenForRepo": 263,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,105 +1,106 @@\n     public boolean replaceEvent(GameEvent event, Game game) {\n         boolean caught = false;\n         HashMap<UUID, HashSet<UUID>> consumed = new HashMap<UUID, HashSet<UUID>>();\n         do {\n             HashMap<ReplacementEffect, HashSet<Ability>> rEffects = getApplicableReplacementEffects(event, game);\n             // Remove all consumed effects (ability dependant)\n             for (Iterator<ReplacementEffect> it1 = rEffects.keySet().iterator(); it1.hasNext();){\n                 ReplacementEffect entry = it1.next();\n                 if (consumed.containsKey(entry.getId())) {\n                     HashSet<UUID> consumedAbilitiesIds = consumed.get(entry.getId());\n                     if (rEffects.get(entry) == null || consumedAbilitiesIds.size() == ((HashSet<Ability>) rEffects.get(entry)).size()) {\n                         it1.remove();\n                     } else {\n                         Iterator it = ((HashSet<Ability>) rEffects.get(entry)).iterator();\n                         while (it.hasNext()) {\n                             Ability ability = (Ability) it.next();\n                             if (consumedAbilitiesIds.contains(ability.getId())) {\n                                 it.remove();\n                             }\n                         }\n                     }\n                 }\n             }\n             // no effects left, quit\n             if (rEffects.isEmpty()) {\n                 break;\n             }\n             int index;\n             boolean onlyOne = false;\n             if (rEffects.size() == 1) {\n                 ReplacementEffect effect = (ReplacementEffect) rEffects.keySet().iterator().next();\n                 HashSet<Ability> abilities = replacementEffects.getAbility(effect.getId());\n                 if (abilities == null || abilities.size() == 1) {\n                     onlyOne = true;\n                 }\n             }\n             if (onlyOne) {\n                 index = 0;\n             } else {\n                 //20100716 - 616.1c\n                 Player player = game.getPlayer(event.getPlayerId());\n                 index = player.chooseEffect(getReplacementEffectsTexts(rEffects, game), game);\n             }\n             // get the selected effect\n             int checked = 0;\n             ReplacementEffect rEffect = null;\n             Ability rAbility = null;\n             for (Map.Entry entry : rEffects.entrySet()) {\n                 if (entry.getValue() == null) {\n                     if (checked == index) {\n                         rEffect = (ReplacementEffect) entry.getKey();\n                         break;\n                     } else {\n                         checked++;\n                     }\n                 } else {\n                     HashSet<Ability> abilities = (HashSet<Ability>) entry.getValue();\n                     int size = abilities.size();\n                     if (index > (checked + size - 1)) {\n                         checked += size;\n                     } else {\n                         rEffect = (ReplacementEffect) entry.getKey();\n                         Iterator it = abilities.iterator();\n                         while (it.hasNext() && rAbility == null) {\n                             if (checked == index) {\n                                 rAbility = (Ability) it.next();\n                             } else {\n                                 it.next();\n                                 checked++;\n                             }\n                         }\n+                        break;\n                     }\n                 }                \n             }\n \n             if (rEffect != null) {\n                 event.getAppliedEffects().add(rEffect.getId());\n                 caught = rEffect.replaceEvent(event, rAbility, game);\n             }\n             if (caught) { // Event was completely replaced -> stop applying effects to it\n                 break;\n             }\n \n             // add used effect to consumed effects\n             if (rEffect != null) {\n                 if (consumed.containsKey(rEffect.getId())) {\n                     HashSet<UUID> set = consumed.get(rEffect.getId());\n                     if (rAbility != null) {\n                         if (!set.contains(rAbility.getId())) {\n                             set.add(rAbility.getId());\n                         }\n                     }\n                 } else {\n                     HashSet<UUID> set = new HashSet<UUID>();\n                     if (rAbility != null) { // in case of AuraReplacementEffect or PlaneswalkerReplacementEffect there is no Ability\n                         set.add(rAbility.getId());\n                     }\n                     consumed.put(rEffect.getId(), set);\n                 }\n             }\n \n             game.applyEffects();\n         } while (true);\n         return caught;\n     }\n\\ No newline at end of file\n",
            "actualSource": "    public boolean replaceEvent(GameEvent event, Game game) {\n        boolean caught = false;\n        HashMap<UUID, HashSet<UUID>> consumed = new HashMap<UUID, HashSet<UUID>>();\n        do {\n            HashMap<ReplacementEffect, HashSet<Ability>> rEffects = getApplicableReplacementEffects(event, game);\n            // Remove all consumed effects (ability dependant)\n            for (Iterator<ReplacementEffect> it1 = rEffects.keySet().iterator(); it1.hasNext();){\n                ReplacementEffect entry = it1.next();\n                if (consumed.containsKey(entry.getId())) {\n                    HashSet<UUID> consumedAbilitiesIds = consumed.get(entry.getId());\n                    if (rEffects.get(entry) == null || consumedAbilitiesIds.size() == ((HashSet<Ability>) rEffects.get(entry)).size()) {\n                        it1.remove();\n                    } else {\n                        Iterator it = ((HashSet<Ability>) rEffects.get(entry)).iterator();\n                        while (it.hasNext()) {\n                            Ability ability = (Ability) it.next();\n                            if (consumedAbilitiesIds.contains(ability.getId())) {\n                                it.remove();\n                            }\n                        }\n                    }\n                }\n            }\n            // no effects left, quit\n            if (rEffects.isEmpty()) {\n                break;\n            }\n            int index;\n            boolean onlyOne = false;\n            if (rEffects.size() == 1) {\n                ReplacementEffect effect = (ReplacementEffect) rEffects.keySet().iterator().next();\n                HashSet<Ability> abilities = replacementEffects.getAbility(effect.getId());\n                if (abilities == null || abilities.size() == 1) {\n                    onlyOne = true;\n                }\n            }\n            if (onlyOne) {\n                index = 0;\n            } else {\n                //20100716 - 616.1c\n                Player player = game.getPlayer(event.getPlayerId());\n                index = player.chooseEffect(getReplacementEffectsTexts(rEffects, game), game);\n            }\n            // get the selected effect\n            int checked = 0;\n            ReplacementEffect rEffect = null;\n            Ability rAbility = null;\n            for (Map.Entry entry : rEffects.entrySet()) {\n                if (entry.getValue() == null) {\n                    if (checked == index) {\n                        rEffect = (ReplacementEffect) entry.getKey();\n                        break;\n                    } else {\n                        checked++;\n                    }\n                } else {\n                    HashSet<Ability> abilities = (HashSet<Ability>) entry.getValue();\n                    int size = abilities.size();\n                    if (index > (checked + size - 1)) {\n                        checked += size;\n                    } else {\n                        rEffect = (ReplacementEffect) entry.getKey();\n                        Iterator it = abilities.iterator();\n                        while (it.hasNext() && rAbility == null) {\n                            if (checked == index) {\n                                rAbility = (Ability) it.next();\n                            } else {\n                                it.next();\n                                checked++;\n                            }\n                        }\n                        break;\n                    }\n                }                \n            }\n\n            if (rEffect != null) {\n                event.getAppliedEffects().add(rEffect.getId());\n                caught = rEffect.replaceEvent(event, rAbility, game);\n            }\n            if (caught) { // Event was completely replaced -> stop applying effects to it\n                break;\n            }\n\n            // add used effect to consumed effects\n            if (rEffect != null) {\n                if (consumed.containsKey(rEffect.getId())) {\n                    HashSet<UUID> set = consumed.get(rEffect.getId());\n                    if (rAbility != null) {\n                        if (!set.contains(rAbility.getId())) {\n                            set.add(rAbility.getId());\n                        }\n                    }\n                } else {\n                    HashSet<UUID> set = new HashSet<UUID>();\n                    if (rAbility != null) { // in case of AuraReplacementEffect or PlaneswalkerReplacementEffect there is no Ability\n                        set.add(rAbility.getId());\n                    }\n                    consumed.put(rEffect.getId(), set);\n                }\n            }\n\n            game.applyEffects();\n        } while (true);\n        return caught;\n    }",
            "path": "Mage/src/mage/abilities/effects/ContinuousEffects.java",
            "extendedDetails": {},
            "BugCommit": "1",
            "TangledWMoveandFileRename": "1"
        },
        "b7a22aa28370ced96ceb1cec5b71cc13901b576a": {
            "type": "Ybodychange",
            "commitMessage": "* Sovereigns of Lost Alara - Fixed a bug that the effect attaching the aura to the attacking creature throws an error.",
            "commitDate": "14/06/13 5:24 PM",
            "commitName": "b7a22aa28370ced96ceb1cec5b71cc13901b576a",
            "commitAuthor": "LevelX2",
            "commitDateOld": "09/05/13 2:06 AM",
            "commitNameOld": "f84177bbcd18a4646d46849aeeb76c7cc52e21b2",
            "commitAuthorOld": "LevelX2",
            "daysBetweenCommits": 36.64,
            "commitsBetweenForRepo": 219,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,105 +1,105 @@\n     public boolean replaceEvent(GameEvent event, Game game) {\n         boolean caught = false;\n         HashMap<UUID, HashSet<UUID>> consumed = new HashMap<UUID, HashSet<UUID>>();\n         do {\n             HashMap<ReplacementEffect, HashSet<Ability>> rEffects = getApplicableReplacementEffects(event, game);\n             // Remove all consumed effects (ability dependant)\n             for (Iterator<ReplacementEffect> it1 = rEffects.keySet().iterator(); it1.hasNext();){\n                 ReplacementEffect entry = it1.next();\n                 if (consumed.containsKey(entry.getId())) {\n                     HashSet<UUID> consumedAbilitiesIds = consumed.get(entry.getId());\n-                    if (consumedAbilitiesIds.size() == ((HashSet<Ability>) rEffects.get(entry)).size()) {\n+                    if (rEffects.get(entry) == null || consumedAbilitiesIds.size() == ((HashSet<Ability>) rEffects.get(entry)).size()) {\n                         it1.remove();\n                     } else {\n                         Iterator it = ((HashSet<Ability>) rEffects.get(entry)).iterator();\n                         while (it.hasNext()) {\n                             Ability ability = (Ability) it.next();\n                             if (consumedAbilitiesIds.contains(ability.getId())) {\n                                 it.remove();\n                             }\n                         }\n                     }\n                 }\n             }\n             // no effects left, quit\n             if (rEffects.isEmpty()) {\n                 break;\n             }\n             int index;\n             boolean onlyOne = false;\n             if (rEffects.size() == 1) {\n                 ReplacementEffect effect = (ReplacementEffect) rEffects.keySet().iterator().next();\n                 HashSet<Ability> abilities = replacementEffects.getAbility(effect.getId());\n                 if (abilities == null || abilities.size() == 1) {\n                     onlyOne = true;\n                 }\n             }\n             if (onlyOne) {\n                 index = 0;\n             } else {\n                 //20100716 - 616.1c\n                 Player player = game.getPlayer(event.getPlayerId());\n                 index = player.chooseEffect(getReplacementEffectsTexts(rEffects, game), game);\n             }\n             // get the selected effect\n             int checked = 0;\n             ReplacementEffect rEffect = null;\n             Ability rAbility = null;\n             for (Map.Entry entry : rEffects.entrySet()) {\n                 if (entry.getValue() == null) {\n                     if (checked == index) {\n                         rEffect = (ReplacementEffect) entry.getKey();\n                         break;\n                     } else {\n                         checked++;\n                     }\n                 } else {\n                     HashSet<Ability> abilities = (HashSet<Ability>) entry.getValue();\n                     int size = abilities.size();\n                     if (index > (checked + size - 1)) {\n                         checked += size;\n                     } else {\n                         rEffect = (ReplacementEffect) entry.getKey();\n                         Iterator it = abilities.iterator();\n                         while (it.hasNext() && rAbility == null) {\n                             if (checked == index) {\n                                 rAbility = (Ability) it.next();\n                             } else {\n                                 it.next();\n                                 checked++;\n                             }\n                         }\n                     }\n                 }                \n             }\n \n             if (rEffect != null) {\n                 event.getAppliedEffects().add(rEffect.getId());\n                 caught = rEffect.replaceEvent(event, rAbility, game);\n             }\n             if (caught) { // Event was completely replaced -> stop applying effects to it\n                 break;\n             }\n \n             // add used effect to consumed effects\n             if (rEffect != null) {\n                 if (consumed.containsKey(rEffect.getId())) {\n                     HashSet<UUID> set = consumed.get(rEffect.getId());\n                     if (rAbility != null) {\n                         if (!set.contains(rAbility.getId())) {\n                             set.add(rAbility.getId());\n                         }\n                     }\n                 } else {\n                     HashSet<UUID> set = new HashSet<UUID>();\n                     if (rAbility != null) { // in case of AuraReplacementEffect or PlaneswalkerReplacementEffect there is no Ability\n                         set.add(rAbility.getId());\n                     }\n                     consumed.put(rEffect.getId(), set);\n                 }\n             }\n \n             game.applyEffects();\n         } while (true);\n         return caught;\n     }\n\\ No newline at end of file\n",
            "actualSource": "    public boolean replaceEvent(GameEvent event, Game game) {\n        boolean caught = false;\n        HashMap<UUID, HashSet<UUID>> consumed = new HashMap<UUID, HashSet<UUID>>();\n        do {\n            HashMap<ReplacementEffect, HashSet<Ability>> rEffects = getApplicableReplacementEffects(event, game);\n            // Remove all consumed effects (ability dependant)\n            for (Iterator<ReplacementEffect> it1 = rEffects.keySet().iterator(); it1.hasNext();){\n                ReplacementEffect entry = it1.next();\n                if (consumed.containsKey(entry.getId())) {\n                    HashSet<UUID> consumedAbilitiesIds = consumed.get(entry.getId());\n                    if (rEffects.get(entry) == null || consumedAbilitiesIds.size() == ((HashSet<Ability>) rEffects.get(entry)).size()) {\n                        it1.remove();\n                    } else {\n                        Iterator it = ((HashSet<Ability>) rEffects.get(entry)).iterator();\n                        while (it.hasNext()) {\n                            Ability ability = (Ability) it.next();\n                            if (consumedAbilitiesIds.contains(ability.getId())) {\n                                it.remove();\n                            }\n                        }\n                    }\n                }\n            }\n            // no effects left, quit\n            if (rEffects.isEmpty()) {\n                break;\n            }\n            int index;\n            boolean onlyOne = false;\n            if (rEffects.size() == 1) {\n                ReplacementEffect effect = (ReplacementEffect) rEffects.keySet().iterator().next();\n                HashSet<Ability> abilities = replacementEffects.getAbility(effect.getId());\n                if (abilities == null || abilities.size() == 1) {\n                    onlyOne = true;\n                }\n            }\n            if (onlyOne) {\n                index = 0;\n            } else {\n                //20100716 - 616.1c\n                Player player = game.getPlayer(event.getPlayerId());\n                index = player.chooseEffect(getReplacementEffectsTexts(rEffects, game), game);\n            }\n            // get the selected effect\n            int checked = 0;\n            ReplacementEffect rEffect = null;\n            Ability rAbility = null;\n            for (Map.Entry entry : rEffects.entrySet()) {\n                if (entry.getValue() == null) {\n                    if (checked == index) {\n                        rEffect = (ReplacementEffect) entry.getKey();\n                        break;\n                    } else {\n                        checked++;\n                    }\n                } else {\n                    HashSet<Ability> abilities = (HashSet<Ability>) entry.getValue();\n                    int size = abilities.size();\n                    if (index > (checked + size - 1)) {\n                        checked += size;\n                    } else {\n                        rEffect = (ReplacementEffect) entry.getKey();\n                        Iterator it = abilities.iterator();\n                        while (it.hasNext() && rAbility == null) {\n                            if (checked == index) {\n                                rAbility = (Ability) it.next();\n                            } else {\n                                it.next();\n                                checked++;\n                            }\n                        }\n                    }\n                }                \n            }\n\n            if (rEffect != null) {\n                event.getAppliedEffects().add(rEffect.getId());\n                caught = rEffect.replaceEvent(event, rAbility, game);\n            }\n            if (caught) { // Event was completely replaced -> stop applying effects to it\n                break;\n            }\n\n            // add used effect to consumed effects\n            if (rEffect != null) {\n                if (consumed.containsKey(rEffect.getId())) {\n                    HashSet<UUID> set = consumed.get(rEffect.getId());\n                    if (rAbility != null) {\n                        if (!set.contains(rAbility.getId())) {\n                            set.add(rAbility.getId());\n                        }\n                    }\n                } else {\n                    HashSet<UUID> set = new HashSet<UUID>();\n                    if (rAbility != null) { // in case of AuraReplacementEffect or PlaneswalkerReplacementEffect there is no Ability\n                        set.add(rAbility.getId());\n                    }\n                    consumed.put(rEffect.getId(), set);\n                }\n            }\n\n            game.applyEffects();\n        } while (true);\n        return caught;\n    }",
            "path": "Mage/src/mage/abilities/effects/ContinuousEffects.java",
            "extendedDetails": {},
            "BugCommit": "1",
            "TangledWMoveandFileRename": "1"
        },
        "768ef9a4fc6403e9a7492422a9490f072d7602c3": {
            "type": "Ybodychange",
            "commitMessage": "Improved handling of applied efffects for replacement effects.",
            "commitDate": "21/04/13 3:34 PM",
            "commitName": "768ef9a4fc6403e9a7492422a9490f072d7602c3",
            "commitAuthor": "LevelX2",
            "commitDateOld": "17/04/13 4:44 PM",
            "commitNameOld": "1e5100e0d6e3d0b5899aa9b71ec8b3642b3a263b",
            "commitAuthorOld": "LevelX2",
            "daysBetweenCommits": 3.95,
            "commitsBetweenForRepo": 26,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,104 +1,105 @@\n     public boolean replaceEvent(GameEvent event, Game game) {\n         boolean caught = false;\n         HashMap<UUID, HashSet<UUID>> consumed = new HashMap<UUID, HashSet<UUID>>();\n         do {\n             HashMap<ReplacementEffect, HashSet<Ability>> rEffects = getApplicableReplacementEffects(event, game);\n             // Remove all consumed effects (ability dependant)\n             for (Iterator<ReplacementEffect> it1 = rEffects.keySet().iterator(); it1.hasNext();){\n                 ReplacementEffect entry = it1.next();\n                 if (consumed.containsKey(entry.getId())) {\n                     HashSet<UUID> consumedAbilitiesIds = consumed.get(entry.getId());\n                     if (consumedAbilitiesIds.size() == ((HashSet<Ability>) rEffects.get(entry)).size()) {\n                         it1.remove();\n                     } else {\n                         Iterator it = ((HashSet<Ability>) rEffects.get(entry)).iterator();\n                         while (it.hasNext()) {\n                             Ability ability = (Ability) it.next();\n                             if (consumedAbilitiesIds.contains(ability.getId())) {\n                                 it.remove();\n                             }\n                         }\n                     }\n                 }\n             }\n             // no effects left, quit\n             if (rEffects.isEmpty()) {\n                 break;\n             }\n             int index;\n             boolean onlyOne = false;\n             if (rEffects.size() == 1) {\n                 ReplacementEffect effect = (ReplacementEffect) rEffects.keySet().iterator().next();\n                 HashSet<Ability> abilities = replacementEffects.getAbility(effect.getId());\n                 if (abilities == null || abilities.size() == 1) {\n                     onlyOne = true;\n                 }\n             }\n             if (onlyOne) {\n                 index = 0;\n             } else {\n                 //20100716 - 616.1c\n                 Player player = game.getPlayer(event.getPlayerId());\n                 index = player.chooseEffect(getReplacementEffectsTexts(rEffects, game), game);\n             }\n             // get the selected effect\n             int checked = 0;\n             ReplacementEffect rEffect = null;\n             Ability rAbility = null;\n             for (Map.Entry entry : rEffects.entrySet()) {\n                 if (entry.getValue() == null) {\n                     if (checked == index) {\n                         rEffect = (ReplacementEffect) entry.getKey();\n                         break;\n                     } else {\n                         checked++;\n                     }\n                 } else {\n                     HashSet<Ability> abilities = (HashSet<Ability>) entry.getValue();\n                     int size = abilities.size();\n                     if (index > (checked + size - 1)) {\n                         checked += size;\n                     } else {\n                         rEffect = (ReplacementEffect) entry.getKey();\n                         Iterator it = abilities.iterator();\n                         while (it.hasNext() && rAbility == null) {\n                             if (checked == index) {\n                                 rAbility = (Ability) it.next();\n                             } else {\n                                 it.next();\n                                 checked++;\n                             }\n                         }\n                     }\n                 }                \n             }\n \n             if (rEffect != null) {\n+                event.getAppliedEffects().add(rEffect.getId());\n                 caught = rEffect.replaceEvent(event, rAbility, game);\n             }\n             if (caught) { // Event was completely replaced -> stop applying effects to it\n                 break;\n             }\n \n             // add used effect to consumed effects\n             if (rEffect != null) {\n                 if (consumed.containsKey(rEffect.getId())) {\n                     HashSet<UUID> set = consumed.get(rEffect.getId());\n                     if (rAbility != null) {\n                         if (!set.contains(rAbility.getId())) {\n                             set.add(rAbility.getId());\n                         }\n                     }\n                 } else {\n                     HashSet<UUID> set = new HashSet<UUID>();\n                     if (rAbility != null) { // in case of AuraReplacementEffect or PlaneswalkerReplacementEffect there is no Ability\n                         set.add(rAbility.getId());\n                     }\n                     consumed.put(rEffect.getId(), set);\n                 }\n             }\n \n             game.applyEffects();\n         } while (true);\n         return caught;\n     }\n\\ No newline at end of file\n",
            "actualSource": "    public boolean replaceEvent(GameEvent event, Game game) {\n        boolean caught = false;\n        HashMap<UUID, HashSet<UUID>> consumed = new HashMap<UUID, HashSet<UUID>>();\n        do {\n            HashMap<ReplacementEffect, HashSet<Ability>> rEffects = getApplicableReplacementEffects(event, game);\n            // Remove all consumed effects (ability dependant)\n            for (Iterator<ReplacementEffect> it1 = rEffects.keySet().iterator(); it1.hasNext();){\n                ReplacementEffect entry = it1.next();\n                if (consumed.containsKey(entry.getId())) {\n                    HashSet<UUID> consumedAbilitiesIds = consumed.get(entry.getId());\n                    if (consumedAbilitiesIds.size() == ((HashSet<Ability>) rEffects.get(entry)).size()) {\n                        it1.remove();\n                    } else {\n                        Iterator it = ((HashSet<Ability>) rEffects.get(entry)).iterator();\n                        while (it.hasNext()) {\n                            Ability ability = (Ability) it.next();\n                            if (consumedAbilitiesIds.contains(ability.getId())) {\n                                it.remove();\n                            }\n                        }\n                    }\n                }\n            }\n            // no effects left, quit\n            if (rEffects.isEmpty()) {\n                break;\n            }\n            int index;\n            boolean onlyOne = false;\n            if (rEffects.size() == 1) {\n                ReplacementEffect effect = (ReplacementEffect) rEffects.keySet().iterator().next();\n                HashSet<Ability> abilities = replacementEffects.getAbility(effect.getId());\n                if (abilities == null || abilities.size() == 1) {\n                    onlyOne = true;\n                }\n            }\n            if (onlyOne) {\n                index = 0;\n            } else {\n                //20100716 - 616.1c\n                Player player = game.getPlayer(event.getPlayerId());\n                index = player.chooseEffect(getReplacementEffectsTexts(rEffects, game), game);\n            }\n            // get the selected effect\n            int checked = 0;\n            ReplacementEffect rEffect = null;\n            Ability rAbility = null;\n            for (Map.Entry entry : rEffects.entrySet()) {\n                if (entry.getValue() == null) {\n                    if (checked == index) {\n                        rEffect = (ReplacementEffect) entry.getKey();\n                        break;\n                    } else {\n                        checked++;\n                    }\n                } else {\n                    HashSet<Ability> abilities = (HashSet<Ability>) entry.getValue();\n                    int size = abilities.size();\n                    if (index > (checked + size - 1)) {\n                        checked += size;\n                    } else {\n                        rEffect = (ReplacementEffect) entry.getKey();\n                        Iterator it = abilities.iterator();\n                        while (it.hasNext() && rAbility == null) {\n                            if (checked == index) {\n                                rAbility = (Ability) it.next();\n                            } else {\n                                it.next();\n                                checked++;\n                            }\n                        }\n                    }\n                }                \n            }\n\n            if (rEffect != null) {\n                event.getAppliedEffects().add(rEffect.getId());\n                caught = rEffect.replaceEvent(event, rAbility, game);\n            }\n            if (caught) { // Event was completely replaced -> stop applying effects to it\n                break;\n            }\n\n            // add used effect to consumed effects\n            if (rEffect != null) {\n                if (consumed.containsKey(rEffect.getId())) {\n                    HashSet<UUID> set = consumed.get(rEffect.getId());\n                    if (rAbility != null) {\n                        if (!set.contains(rAbility.getId())) {\n                            set.add(rAbility.getId());\n                        }\n                    }\n                } else {\n                    HashSet<UUID> set = new HashSet<UUID>();\n                    if (rAbility != null) { // in case of AuraReplacementEffect or PlaneswalkerReplacementEffect there is no Ability\n                        set.add(rAbility.getId());\n                    }\n                    consumed.put(rEffect.getId(), set);\n                }\n            }\n\n            game.applyEffects();\n        } while (true);\n        return caught;\n    }",
            "path": "Mage/src/mage/abilities/effects/ContinuousEffects.java",
            "extendedDetails": {},
            "BugCommit": "0",
            "TangledWMoveandFileRename": "4"
        },
        "1e5100e0d6e3d0b5899aa9b71ec8b3642b3a263b": {
            "type": "Ybodychange",
            "commitMessage": "Added the logic, that one continious effect in game state can be connected to multiple abilities. This fixes issue #198 and #196.   ",
            "commitDate": "17/04/13 4:44 PM",
            "commitName": "1e5100e0d6e3d0b5899aa9b71ec8b3642b3a263b",
            "commitAuthor": "LevelX2",
            "commitDateOld": "23/03/13 10:40 AM",
            "commitNameOld": "32dff5ae723947d3a763775f8161a469f77fcc97",
            "commitAuthorOld": "LevelX2",
            "daysBetweenCommits": 25.25,
            "commitsBetweenForRepo": 145,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,33 +1,104 @@\n     public boolean replaceEvent(GameEvent event, Game game) {\n         boolean caught = false;\n-        List<UUID> consumed = new ArrayList<UUID>();\n+        HashMap<UUID, HashSet<UUID>> consumed = new HashMap<UUID, HashSet<UUID>>();\n         do {\n-            List<ReplacementEffect> rEffects = getApplicableReplacementEffects(event, game);\n-            for (Iterator<ReplacementEffect> i = rEffects.iterator(); i.hasNext();) {\n-                ReplacementEffect entry = i.next();\n-                if (consumed.contains(entry.getId())) {\n-                    i.remove();\n+            HashMap<ReplacementEffect, HashSet<Ability>> rEffects = getApplicableReplacementEffects(event, game);\n+            // Remove all consumed effects (ability dependant)\n+            for (Iterator<ReplacementEffect> it1 = rEffects.keySet().iterator(); it1.hasNext();){\n+                ReplacementEffect entry = it1.next();\n+                if (consumed.containsKey(entry.getId())) {\n+                    HashSet<UUID> consumedAbilitiesIds = consumed.get(entry.getId());\n+                    if (consumedAbilitiesIds.size() == ((HashSet<Ability>) rEffects.get(entry)).size()) {\n+                        it1.remove();\n+                    } else {\n+                        Iterator it = ((HashSet<Ability>) rEffects.get(entry)).iterator();\n+                        while (it.hasNext()) {\n+                            Ability ability = (Ability) it.next();\n+                            if (consumedAbilitiesIds.contains(ability.getId())) {\n+                                it.remove();\n+                            }\n+                        }\n+                    }\n                 }\n             }\n+            // no effects left, quit\n             if (rEffects.isEmpty()) {\n                 break;\n             }\n             int index;\n+            boolean onlyOne = false;\n             if (rEffects.size() == 1) {\n-                index = 0;\n+                ReplacementEffect effect = (ReplacementEffect) rEffects.keySet().iterator().next();\n+                HashSet<Ability> abilities = replacementEffects.getAbility(effect.getId());\n+                if (abilities == null || abilities.size() == 1) {\n+                    onlyOne = true;\n+                }\n             }\n-            else {\n+            if (onlyOne) {\n+                index = 0;\n+            } else {\n                 //20100716 - 616.1c\n                 Player player = game.getPlayer(event.getPlayerId());\n                 index = player.chooseEffect(getReplacementEffectsTexts(rEffects, game), game);\n             }\n-            ReplacementEffect rEffect = rEffects.get(index);\n-            caught = rEffect.replaceEvent(event, this.getAbility(rEffect.getId()), game);\n-            if (caught) {\n+            // get the selected effect\n+            int checked = 0;\n+            ReplacementEffect rEffect = null;\n+            Ability rAbility = null;\n+            for (Map.Entry entry : rEffects.entrySet()) {\n+                if (entry.getValue() == null) {\n+                    if (checked == index) {\n+                        rEffect = (ReplacementEffect) entry.getKey();\n+                        break;\n+                    } else {\n+                        checked++;\n+                    }\n+                } else {\n+                    HashSet<Ability> abilities = (HashSet<Ability>) entry.getValue();\n+                    int size = abilities.size();\n+                    if (index > (checked + size - 1)) {\n+                        checked += size;\n+                    } else {\n+                        rEffect = (ReplacementEffect) entry.getKey();\n+                        Iterator it = abilities.iterator();\n+                        while (it.hasNext() && rAbility == null) {\n+                            if (checked == index) {\n+                                rAbility = (Ability) it.next();\n+                            } else {\n+                                it.next();\n+                                checked++;\n+                            }\n+                        }\n+                    }\n+                }                \n+            }\n+\n+            if (rEffect != null) {\n+                caught = rEffect.replaceEvent(event, rAbility, game);\n+            }\n+            if (caught) { // Event was completely replaced -> stop applying effects to it\n                 break;\n             }\n-            consumed.add(rEffect.getId());\n+\n+            // add used effect to consumed effects\n+            if (rEffect != null) {\n+                if (consumed.containsKey(rEffect.getId())) {\n+                    HashSet<UUID> set = consumed.get(rEffect.getId());\n+                    if (rAbility != null) {\n+                        if (!set.contains(rAbility.getId())) {\n+                            set.add(rAbility.getId());\n+                        }\n+                    }\n+                } else {\n+                    HashSet<UUID> set = new HashSet<UUID>();\n+                    if (rAbility != null) { // in case of AuraReplacementEffect or PlaneswalkerReplacementEffect there is no Ability\n+                        set.add(rAbility.getId());\n+                    }\n+                    consumed.put(rEffect.getId(), set);\n+                }\n+            }\n+\n             game.applyEffects();\n         } while (true);\n         return caught;\n     }\n\\ No newline at end of file\n",
            "actualSource": "    public boolean replaceEvent(GameEvent event, Game game) {\n        boolean caught = false;\n        HashMap<UUID, HashSet<UUID>> consumed = new HashMap<UUID, HashSet<UUID>>();\n        do {\n            HashMap<ReplacementEffect, HashSet<Ability>> rEffects = getApplicableReplacementEffects(event, game);\n            // Remove all consumed effects (ability dependant)\n            for (Iterator<ReplacementEffect> it1 = rEffects.keySet().iterator(); it1.hasNext();){\n                ReplacementEffect entry = it1.next();\n                if (consumed.containsKey(entry.getId())) {\n                    HashSet<UUID> consumedAbilitiesIds = consumed.get(entry.getId());\n                    if (consumedAbilitiesIds.size() == ((HashSet<Ability>) rEffects.get(entry)).size()) {\n                        it1.remove();\n                    } else {\n                        Iterator it = ((HashSet<Ability>) rEffects.get(entry)).iterator();\n                        while (it.hasNext()) {\n                            Ability ability = (Ability) it.next();\n                            if (consumedAbilitiesIds.contains(ability.getId())) {\n                                it.remove();\n                            }\n                        }\n                    }\n                }\n            }\n            // no effects left, quit\n            if (rEffects.isEmpty()) {\n                break;\n            }\n            int index;\n            boolean onlyOne = false;\n            if (rEffects.size() == 1) {\n                ReplacementEffect effect = (ReplacementEffect) rEffects.keySet().iterator().next();\n                HashSet<Ability> abilities = replacementEffects.getAbility(effect.getId());\n                if (abilities == null || abilities.size() == 1) {\n                    onlyOne = true;\n                }\n            }\n            if (onlyOne) {\n                index = 0;\n            } else {\n                //20100716 - 616.1c\n                Player player = game.getPlayer(event.getPlayerId());\n                index = player.chooseEffect(getReplacementEffectsTexts(rEffects, game), game);\n            }\n            // get the selected effect\n            int checked = 0;\n            ReplacementEffect rEffect = null;\n            Ability rAbility = null;\n            for (Map.Entry entry : rEffects.entrySet()) {\n                if (entry.getValue() == null) {\n                    if (checked == index) {\n                        rEffect = (ReplacementEffect) entry.getKey();\n                        break;\n                    } else {\n                        checked++;\n                    }\n                } else {\n                    HashSet<Ability> abilities = (HashSet<Ability>) entry.getValue();\n                    int size = abilities.size();\n                    if (index > (checked + size - 1)) {\n                        checked += size;\n                    } else {\n                        rEffect = (ReplacementEffect) entry.getKey();\n                        Iterator it = abilities.iterator();\n                        while (it.hasNext() && rAbility == null) {\n                            if (checked == index) {\n                                rAbility = (Ability) it.next();\n                            } else {\n                                it.next();\n                                checked++;\n                            }\n                        }\n                    }\n                }                \n            }\n\n            if (rEffect != null) {\n                caught = rEffect.replaceEvent(event, rAbility, game);\n            }\n            if (caught) { // Event was completely replaced -> stop applying effects to it\n                break;\n            }\n\n            // add used effect to consumed effects\n            if (rEffect != null) {\n                if (consumed.containsKey(rEffect.getId())) {\n                    HashSet<UUID> set = consumed.get(rEffect.getId());\n                    if (rAbility != null) {\n                        if (!set.contains(rAbility.getId())) {\n                            set.add(rAbility.getId());\n                        }\n                    }\n                } else {\n                    HashSet<UUID> set = new HashSet<UUID>();\n                    if (rAbility != null) { // in case of AuraReplacementEffect or PlaneswalkerReplacementEffect there is no Ability\n                        set.add(rAbility.getId());\n                    }\n                    consumed.put(rEffect.getId(), set);\n                }\n            }\n\n            game.applyEffects();\n        } while (true);\n        return caught;\n    }",
            "path": "Mage/src/mage/abilities/effects/ContinuousEffects.java",
            "extendedDetails": {},
            "BugCommit": "0",
            "TangledWMoveandFileRename": "34"
        },
        "32dff5ae723947d3a763775f8161a469f77fcc97": {
            "type": "Ybodychange",
            "commitMessage": "Added replacement of {this} and{source} for selection of replacement effect order.",
            "commitDate": "23/03/13 10:40 AM",
            "commitName": "32dff5ae723947d3a763775f8161a469f77fcc97",
            "commitAuthor": "LevelX2",
            "commitDateOld": "22/03/13 9:00 AM",
            "commitNameOld": "b46bdef429c53abb7dff74049e135bf4d5615502",
            "commitAuthorOld": "LevelX2",
            "daysBetweenCommits": 1.07,
            "commitsBetweenForRepo": 4,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,33 +1,33 @@\n     public boolean replaceEvent(GameEvent event, Game game) {\n         boolean caught = false;\n         List<UUID> consumed = new ArrayList<UUID>();\n         do {\n             List<ReplacementEffect> rEffects = getApplicableReplacementEffects(event, game);\n             for (Iterator<ReplacementEffect> i = rEffects.iterator(); i.hasNext();) {\n                 ReplacementEffect entry = i.next();\n                 if (consumed.contains(entry.getId())) {\n                     i.remove();\n                 }\n             }\n             if (rEffects.isEmpty()) {\n                 break;\n             }\n             int index;\n             if (rEffects.size() == 1) {\n                 index = 0;\n             }\n             else {\n                 //20100716 - 616.1c\n                 Player player = game.getPlayer(event.getPlayerId());\n-                index = player.chooseEffect(rEffects, game);\n+                index = player.chooseEffect(getReplacementEffectsTexts(rEffects, game), game);\n             }\n             ReplacementEffect rEffect = rEffects.get(index);\n             caught = rEffect.replaceEvent(event, this.getAbility(rEffect.getId()), game);\n             if (caught) {\n                 break;\n             }\n             consumed.add(rEffect.getId());\n             game.applyEffects();\n         } while (true);\n         return caught;\n     }\n\\ No newline at end of file\n",
            "actualSource": "    public boolean replaceEvent(GameEvent event, Game game) {\n        boolean caught = false;\n        List<UUID> consumed = new ArrayList<UUID>();\n        do {\n            List<ReplacementEffect> rEffects = getApplicableReplacementEffects(event, game);\n            for (Iterator<ReplacementEffect> i = rEffects.iterator(); i.hasNext();) {\n                ReplacementEffect entry = i.next();\n                if (consumed.contains(entry.getId())) {\n                    i.remove();\n                }\n            }\n            if (rEffects.isEmpty()) {\n                break;\n            }\n            int index;\n            if (rEffects.size() == 1) {\n                index = 0;\n            }\n            else {\n                //20100716 - 616.1c\n                Player player = game.getPlayer(event.getPlayerId());\n                index = player.chooseEffect(getReplacementEffectsTexts(rEffects, game), game);\n            }\n            ReplacementEffect rEffect = rEffects.get(index);\n            caught = rEffect.replaceEvent(event, this.getAbility(rEffect.getId()), game);\n            if (caught) {\n                break;\n            }\n            consumed.add(rEffect.getId());\n            game.applyEffects();\n        } while (true);\n        return caught;\n    }",
            "path": "Mage/src/mage/abilities/effects/ContinuousEffects.java",
            "extendedDetails": {},
            "BugCommit": "0",
            "TangledWMoveandFileRename": "4"
        },
        "2e60801df6c6909ce2bc9a4852ec6b312f67abb1": {
            "type": "Ybodychange",
            "commitMessage": "Fixed some problems concerning applying layeres effects in timestamp order. Tests now always successful.\n  1.Timestamps not distinct.\n  2. Timestamps not updated when attachments are attached (mainly equipments).",
            "commitDate": "12/12/12 8:51 AM",
            "commitName": "2e60801df6c6909ce2bc9a4852ec6b312f67abb1",
            "commitAuthor": "LevelX2",
            "commitDateOld": "22/11/12 5:53 PM",
            "commitNameOld": "29222dfcbf90e9290720b737a24c957b53abe4f9",
            "commitAuthorOld": "LevelX2",
            "daysBetweenCommits": 19.62,
            "commitsBetweenForRepo": 80,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,30 +1,33 @@\n     public boolean replaceEvent(GameEvent event, Game game) {\n         boolean caught = false;\n         List<UUID> consumed = new ArrayList<UUID>();\n         do {\n             List<ReplacementEffect> rEffects = getApplicableReplacementEffects(event, game);\n             for (Iterator<ReplacementEffect> i = rEffects.iterator(); i.hasNext();) {\n                 ReplacementEffect entry = i.next();\n-                if (consumed.contains(entry.getId()))\n+                if (consumed.contains(entry.getId())) {\n                     i.remove();\n+                }\n             }\n-            if (rEffects.isEmpty())\n+            if (rEffects.isEmpty()) {\n                 break;\n+            }\n             int index;\n             if (rEffects.size() == 1) {\n                 index = 0;\n             }\n             else {\n                 //20100716 - 616.1c\n                 Player player = game.getPlayer(event.getPlayerId());\n                 index = player.chooseEffect(rEffects, game);\n             }\n             ReplacementEffect rEffect = rEffects.get(index);\n             caught = rEffect.replaceEvent(event, this.getAbility(rEffect.getId()), game);\n-            if (caught)\n+            if (caught) {\n                 break;\n+            }\n             consumed.add(rEffect.getId());\n             game.applyEffects();\n         } while (true);\n         return caught;\n     }\n\\ No newline at end of file\n",
            "actualSource": "    public boolean replaceEvent(GameEvent event, Game game) {\n        boolean caught = false;\n        List<UUID> consumed = new ArrayList<UUID>();\n        do {\n            List<ReplacementEffect> rEffects = getApplicableReplacementEffects(event, game);\n            for (Iterator<ReplacementEffect> i = rEffects.iterator(); i.hasNext();) {\n                ReplacementEffect entry = i.next();\n                if (consumed.contains(entry.getId())) {\n                    i.remove();\n                }\n            }\n            if (rEffects.isEmpty()) {\n                break;\n            }\n            int index;\n            if (rEffects.size() == 1) {\n                index = 0;\n            }\n            else {\n                //20100716 - 616.1c\n                Player player = game.getPlayer(event.getPlayerId());\n                index = player.chooseEffect(rEffects, game);\n            }\n            ReplacementEffect rEffect = rEffects.get(index);\n            caught = rEffect.replaceEvent(event, this.getAbility(rEffect.getId()), game);\n            if (caught) {\n                break;\n            }\n            consumed.add(rEffect.getId());\n            game.applyEffects();\n        } while (true);\n        return caught;\n    }",
            "path": "Mage/src/mage/abilities/effects/ContinuousEffects.java",
            "extendedDetails": {},
            "BugCommit": "0",
            "TangledWMoveandFileRename": "18"
        },
        "1cb25812c9d6bb82a9a98bcf8e774fe0f50e7039": {
            "type": "Ybodychange",
            "commitMessage": "Fixed replacement effects for copied creatures. All tests pass now.\n",
            "commitDate": "14/06/12 11:59 AM",
            "commitName": "1cb25812c9d6bb82a9a98bcf8e774fe0f50e7039",
            "commitAuthor": "magenoxx",
            "commitDateOld": "25/05/12 10:00 AM",
            "commitNameOld": "5650c6c7826012580b1234e2d1e5b48fcf087231",
            "commitAuthorOld": "magenoxx",
            "daysBetweenCommits": 20.08,
            "commitsBetweenForRepo": 122,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,29 +1,30 @@\n \tpublic boolean replaceEvent(GameEvent event, Game game) {\n \t\tboolean caught = false;\n         List<UUID> consumed = new ArrayList<UUID>();\n         do {\n             List<ReplacementEffect> rEffects = getApplicableReplacementEffects(event, game);\n             for (Iterator<ReplacementEffect> i = rEffects.iterator(); i.hasNext();) {\n                 ReplacementEffect entry = i.next();\n                 if (consumed.contains(entry.getId()))\n                     i.remove();\n             }\n             if (rEffects.isEmpty())\n                 break;\n             int index;\n             if (rEffects.size() == 1) {\n                 index = 0;\n             }\n             else {\n                 //20100716 - 616.1c\n                 Player player = game.getPlayer(event.getPlayerId());\n                 index = player.chooseEffect(rEffects, game);\n             }\n             ReplacementEffect rEffect = rEffects.get(index);\n             caught = rEffect.replaceEvent(event, this.getAbility(rEffect.getId()), game);\n             if (caught)\n                 break;\n             consumed.add(rEffect.getId());\n+            game.applyEffects();\n         } while (true);\n \t\treturn caught;\n \t}\n\\ No newline at end of file\n",
            "actualSource": "\tpublic boolean replaceEvent(GameEvent event, Game game) {\n\t\tboolean caught = false;\n        List<UUID> consumed = new ArrayList<UUID>();\n        do {\n            List<ReplacementEffect> rEffects = getApplicableReplacementEffects(event, game);\n            for (Iterator<ReplacementEffect> i = rEffects.iterator(); i.hasNext();) {\n                ReplacementEffect entry = i.next();\n                if (consumed.contains(entry.getId()))\n                    i.remove();\n            }\n            if (rEffects.isEmpty())\n                break;\n            int index;\n            if (rEffects.size() == 1) {\n                index = 0;\n            }\n            else {\n                //20100716 - 616.1c\n                Player player = game.getPlayer(event.getPlayerId());\n                index = player.chooseEffect(rEffects, game);\n            }\n            ReplacementEffect rEffect = rEffects.get(index);\n            caught = rEffect.replaceEvent(event, this.getAbility(rEffect.getId()), game);\n            if (caught)\n                break;\n            consumed.add(rEffect.getId());\n            game.applyEffects();\n        } while (true);\n\t\treturn caught;\n\t}",
            "path": "Mage/src/mage/abilities/effects/ContinuousEffects.java",
            "extendedDetails": {},
            "BugCommit": "0",
            "TangledWMoveandFileRename": "1"
        },
        "3b643805c80a4595da8ebfab56ea078dde579422": {
            "type": "Ybodychange",
            "commitMessage": "normalized ContinuousEffects\n",
            "commitDate": "10/03/12 9:20 PM",
            "commitName": "3b643805c80a4595da8ebfab56ea078dde579422",
            "commitAuthor": "BetaSteward",
            "commitDateOld": "05/03/12 9:45 PM",
            "commitNameOld": "631308a5df1d77f2f8bd3450fbf1ea35485d8e88",
            "commitAuthorOld": "BetaSteward",
            "daysBetweenCommits": 4.98,
            "commitsBetweenForRepo": 24,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,29 +1,29 @@\n \tpublic boolean replaceEvent(GameEvent event, Game game) {\n \t\tboolean caught = false;\n         List<UUID> consumed = new ArrayList<UUID>();\n         do {\n             List<ReplacementEffect> rEffects = getApplicableReplacementEffects(event, game);\n             for (Iterator<ReplacementEffect> i = rEffects.iterator(); i.hasNext();) {\n                 ReplacementEffect entry = i.next();\n                 if (consumed.contains(entry.getId()))\n                     i.remove();\n             }\n             if (rEffects.isEmpty())\n                 break;\n             int index;\n             if (rEffects.size() == 1) {\n                 index = 0;\n             }\n             else {\n                 //20100716 - 616.1c\n                 Player player = game.getPlayer(event.getPlayerId());\n                 index = player.chooseEffect(rEffects, game);\n             }\n             ReplacementEffect rEffect = rEffects.get(index);\n-            caught = rEffect.replaceEvent(event, abilityMap.get(rEffect.getId()), game);\n+            caught = rEffect.replaceEvent(event, this.getAbility(rEffect.getId()), game);\n             if (caught)\n                 break;\n             consumed.add(rEffect.getId());\n         } while (true);\n \t\treturn caught;\n \t}\n\\ No newline at end of file\n",
            "actualSource": "\tpublic boolean replaceEvent(GameEvent event, Game game) {\n\t\tboolean caught = false;\n        List<UUID> consumed = new ArrayList<UUID>();\n        do {\n            List<ReplacementEffect> rEffects = getApplicableReplacementEffects(event, game);\n            for (Iterator<ReplacementEffect> i = rEffects.iterator(); i.hasNext();) {\n                ReplacementEffect entry = i.next();\n                if (consumed.contains(entry.getId()))\n                    i.remove();\n            }\n            if (rEffects.isEmpty())\n                break;\n            int index;\n            if (rEffects.size() == 1) {\n                index = 0;\n            }\n            else {\n                //20100716 - 616.1c\n                Player player = game.getPlayer(event.getPlayerId());\n                index = player.chooseEffect(rEffects, game);\n            }\n            ReplacementEffect rEffect = rEffects.get(index);\n            caught = rEffect.replaceEvent(event, this.getAbility(rEffect.getId()), game);\n            if (caught)\n                break;\n            consumed.add(rEffect.getId());\n        } while (true);\n\t\treturn caught;\n\t}",
            "path": "Mage/src/mage/abilities/effects/ContinuousEffects.java",
            "extendedDetails": {},
            "BugCommit": "0",
            "TangledWMoveandFileRename": "20"
        },
        "2d0842f320be9ac106ea1ffc8c5d3bbf72345ef5": {
            "type": "Ybodychange",
            "commitMessage": "handle multiple replacement effects\n",
            "commitDate": "19/08/11 9:17 PM",
            "commitName": "2d0842f320be9ac106ea1ffc8c5d3bbf72345ef5",
            "commitAuthor": "BetaSteward",
            "commitDateOld": "11/08/11 3:35 PM",
            "commitNameOld": "5010ef9dbe7b8062a398731e256592696aeeeb31",
            "commitAuthorOld": "magenoxx",
            "daysBetweenCommits": 8.24,
            "commitsBetweenForRepo": 88,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,19 +1,29 @@\n \tpublic boolean replaceEvent(GameEvent event, Game game) {\n \t\tboolean caught = false;\n-\t\tList<ReplacementEffect> rEffects = getApplicableReplacementEffects(event, game);\n-\t\tif (rEffects.size() > 0) {\n-\t\t\tint index;\n-\t\t\tif (rEffects.size() == 1) {\n-\t\t\t\tindex = 0;\n-\t\t\t}\n-\t\t\telse {\n-\t\t\t\t//20100716 - 616.1c\n-\t\t\t\tPlayer player = game.getPlayer(event.getPlayerId());\n-\t\t\t\tindex = player.chooseEffect(rEffects, game);\n-\t\t\t}\n-\t\t\tReplacementEffect rEffect = rEffects.get(index);\n-\t\t\tcaught = rEffect.replaceEvent(event, abilityMap.get(rEffect.getId()), game);\n-\t\t}\n-\n+        List<UUID> consumed = new ArrayList<UUID>();\n+        do {\n+            List<ReplacementEffect> rEffects = getApplicableReplacementEffects(event, game);\n+            for (Iterator<ReplacementEffect> i = rEffects.iterator(); i.hasNext();) {\n+                ReplacementEffect entry = i.next();\n+                if (consumed.contains(entry.getId()))\n+                    i.remove();\n+            }\n+            if (rEffects.isEmpty())\n+                break;\n+            int index;\n+            if (rEffects.size() == 1) {\n+                index = 0;\n+            }\n+            else {\n+                //20100716 - 616.1c\n+                Player player = game.getPlayer(event.getPlayerId());\n+                index = player.chooseEffect(rEffects, game);\n+            }\n+            ReplacementEffect rEffect = rEffects.get(index);\n+            caught = rEffect.replaceEvent(event, abilityMap.get(rEffect.getId()), game);\n+            if (caught)\n+                break;\n+            consumed.add(rEffect.getId());\n+        } while (true);\n \t\treturn caught;\n \t}\n\\ No newline at end of file\n",
            "actualSource": "\tpublic boolean replaceEvent(GameEvent event, Game game) {\n\t\tboolean caught = false;\n        List<UUID> consumed = new ArrayList<UUID>();\n        do {\n            List<ReplacementEffect> rEffects = getApplicableReplacementEffects(event, game);\n            for (Iterator<ReplacementEffect> i = rEffects.iterator(); i.hasNext();) {\n                ReplacementEffect entry = i.next();\n                if (consumed.contains(entry.getId()))\n                    i.remove();\n            }\n            if (rEffects.isEmpty())\n                break;\n            int index;\n            if (rEffects.size() == 1) {\n                index = 0;\n            }\n            else {\n                //20100716 - 616.1c\n                Player player = game.getPlayer(event.getPlayerId());\n                index = player.chooseEffect(rEffects, game);\n            }\n            ReplacementEffect rEffect = rEffects.get(index);\n            caught = rEffect.replaceEvent(event, abilityMap.get(rEffect.getId()), game);\n            if (caught)\n                break;\n            consumed.add(rEffect.getId());\n        } while (true);\n\t\treturn caught;\n\t}",
            "path": "Mage/src/mage/abilities/effects/ContinuousEffects.java",
            "extendedDetails": {},
            "BugCommit": "0",
            "TangledWMoveandFileRename": "1"
        },
        "428609ab8b47e1127e6e1f2632f381ed941fffde": {
            "type": "Ybodychange",
            "commitMessage": "fixes for issues 18, 19, 20, 21 + more fixes\n",
            "commitDate": "24/11/10 9:15 PM",
            "commitName": "428609ab8b47e1127e6e1f2632f381ed941fffde",
            "commitAuthor": "BetaSteward",
            "commitDateOld": "22/11/10 11:08 PM",
            "commitNameOld": "0cd0b7045a93aa4fd7101c9857057a7f58861a2a",
            "commitAuthorOld": "BetaSteward",
            "daysBetweenCommits": 1.92,
            "commitsBetweenForRepo": 17,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,19 +1,19 @@\n \tpublic boolean replaceEvent(GameEvent event, Game game) {\n \t\tboolean caught = false;\n \t\tList<ReplacementEffect> rEffects = getApplicableReplacementEffects(event, game);\n \t\tif (rEffects.size() > 0) {\n \t\t\tint index;\n \t\t\tif (rEffects.size() == 1) {\n \t\t\t\tindex = 0;\n \t\t\t}\n \t\t\telse {\n \t\t\t\t//20100716 - 616.1c\n \t\t\t\tPlayer player = game.getPlayer(event.getPlayerId());\n \t\t\t\tindex = player.chooseEffect(rEffects, game);\n \t\t\t}\n \t\t\tReplacementEffect rEffect = rEffects.get(index);\n-\t\t\tcaught = rEffect.replaceEvent(event, abilityMap.get(rEffect), game);\n+\t\t\tcaught = rEffect.replaceEvent(event, abilityMap.get(rEffect.getId()), game);\n \t\t}\n \n \t\treturn caught;\n \t}\n\\ No newline at end of file\n",
            "actualSource": "\tpublic boolean replaceEvent(GameEvent event, Game game) {\n\t\tboolean caught = false;\n\t\tList<ReplacementEffect> rEffects = getApplicableReplacementEffects(event, game);\n\t\tif (rEffects.size() > 0) {\n\t\t\tint index;\n\t\t\tif (rEffects.size() == 1) {\n\t\t\t\tindex = 0;\n\t\t\t}\n\t\t\telse {\n\t\t\t\t//20100716 - 616.1c\n\t\t\t\tPlayer player = game.getPlayer(event.getPlayerId());\n\t\t\t\tindex = player.chooseEffect(rEffects, game);\n\t\t\t}\n\t\t\tReplacementEffect rEffect = rEffects.get(index);\n\t\t\tcaught = rEffect.replaceEvent(event, abilityMap.get(rEffect.getId()), game);\n\t\t}\n\n\t\treturn caught;\n\t}",
            "path": "Mage/src/mage/abilities/effects/ContinuousEffects.java",
            "extendedDetails": {},
            "BugCommit": "0",
            "TangledWMoveandFileRename": "63"
        },
        "0cd0b7045a93aa4fd7101c9857057a7f58861a2a": {
            "type": "Ybodychange",
            "commitMessage": "lots of fixes - mainly to continuous effects and zone changes\n",
            "commitDate": "22/11/10 11:08 PM",
            "commitName": "0cd0b7045a93aa4fd7101c9857057a7f58861a2a",
            "commitAuthor": "BetaSteward",
            "commitDateOld": "20/11/10 9:35 PM",
            "commitNameOld": "06b7e638437b32e2bece6aaa799d3a80fa1c020b",
            "commitAuthorOld": "BetaSteward",
            "daysBetweenCommits": 2.07,
            "commitsBetweenForRepo": 10,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,17 +1,19 @@\n \tpublic boolean replaceEvent(GameEvent event, Game game) {\n \t\tboolean caught = false;\n \t\tList<ReplacementEffect> rEffects = getApplicableReplacementEffects(event, game);\n \t\tif (rEffects.size() > 0) {\n \t\t\tint index;\n \t\t\tif (rEffects.size() == 1) {\n \t\t\t\tindex = 0;\n \t\t\t}\n \t\t\telse {\n+\t\t\t\t//20100716 - 616.1c\n \t\t\t\tPlayer player = game.getPlayer(event.getPlayerId());\n \t\t\t\tindex = player.chooseEffect(rEffects, game);\n \t\t\t}\n-\t\t\tcaught = rEffects.get(index).replaceEvent(event, replacementEffects.get(rEffects.get(index)), game);\n+\t\t\tReplacementEffect rEffect = rEffects.get(index);\n+\t\t\tcaught = rEffect.replaceEvent(event, abilityMap.get(rEffect), game);\n \t\t}\n \n \t\treturn caught;\n \t}\n\\ No newline at end of file\n",
            "actualSource": "\tpublic boolean replaceEvent(GameEvent event, Game game) {\n\t\tboolean caught = false;\n\t\tList<ReplacementEffect> rEffects = getApplicableReplacementEffects(event, game);\n\t\tif (rEffects.size() > 0) {\n\t\t\tint index;\n\t\t\tif (rEffects.size() == 1) {\n\t\t\t\tindex = 0;\n\t\t\t}\n\t\t\telse {\n\t\t\t\t//20100716 - 616.1c\n\t\t\t\tPlayer player = game.getPlayer(event.getPlayerId());\n\t\t\t\tindex = player.chooseEffect(rEffects, game);\n\t\t\t}\n\t\t\tReplacementEffect rEffect = rEffects.get(index);\n\t\t\tcaught = rEffect.replaceEvent(event, abilityMap.get(rEffect), game);\n\t\t}\n\n\t\treturn caught;\n\t}",
            "path": "Mage/src/mage/abilities/effects/ContinuousEffects.java",
            "extendedDetails": {},
            "BugCommit": "0",
            "TangledWMoveandFileRename": "101"
        },
        "5eae8136e40add7603cb73bf94a5b9df6e7098e9": {
            "type": "Ybodychange",
            "commitMessage": "...\n",
            "commitDate": "05/10/10 8:51 PM",
            "commitName": "5eae8136e40add7603cb73bf94a5b9df6e7098e9",
            "commitAuthor": "BetaSteward",
            "commitDateOld": "31/08/10 10:01 PM",
            "commitNameOld": "3fa0e8b8f4444c077085ad270feafcfd238d2719",
            "commitAuthorOld": "BetaSteward",
            "daysBetweenCommits": 34.95,
            "commitsBetweenForRepo": 6,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,30 +1,17 @@\n \tpublic boolean replaceEvent(GameEvent event, Game game) {\n \t\tboolean caught = false;\n-//\t\tList<SelfReplacementEffect> srEffects = GetApplicableSelfReplacementEffects(event, game);\n-//\n-//\t\tif (srEffects.size() > 0) {\n-//\t\t\tif (srEffects.size() == 1) {\n-//\t\t\t\tcaught = srEffects.get(0).ReplaceEvent(event, game);\n-//\t\t\t}\n-//\t\t\telse {\n-//\t\t\t\t//TODO: handle multiple\n-//\t\t\t}\n-//\t\t}\n-\n-\t\tif (!caught) {\n-\t\t\tList<ReplacementEffect> rEffects = getApplicableReplacementEffects(event, game);\n-\t\t\tif (rEffects.size() > 0) {\n-\t\t\t\tint index;\n-\t\t\t\tif (rEffects.size() == 1) {\n-\t\t\t\t\tindex = 0;\n-\t\t\t\t}\n-\t\t\t\telse {\n-\t\t\t\t\tPlayer player = game.getPlayer(event.getPlayerId());\n-\t\t\t\t\tindex = player.chooseEffect(rEffects, game);\n-\t\t\t\t}\n-\t\t\t\tcaught = rEffects.get(index).replaceEvent(event, effects.get(rEffects.get(index)), game);\n+\t\tList<ReplacementEffect> rEffects = getApplicableReplacementEffects(event, game);\n+\t\tif (rEffects.size() > 0) {\n+\t\t\tint index;\n+\t\t\tif (rEffects.size() == 1) {\n+\t\t\t\tindex = 0;\n \t\t\t}\n+\t\t\telse {\n+\t\t\t\tPlayer player = game.getPlayer(event.getPlayerId());\n+\t\t\t\tindex = player.chooseEffect(rEffects, game);\n+\t\t\t}\n+\t\t\tcaught = rEffects.get(index).replaceEvent(event, replacementEffects.get(rEffects.get(index)), game);\n \t\t}\n \n \t\treturn caught;\n \t}\n\\ No newline at end of file\n",
            "actualSource": "\tpublic boolean replaceEvent(GameEvent event, Game game) {\n\t\tboolean caught = false;\n\t\tList<ReplacementEffect> rEffects = getApplicableReplacementEffects(event, game);\n\t\tif (rEffects.size() > 0) {\n\t\t\tint index;\n\t\t\tif (rEffects.size() == 1) {\n\t\t\t\tindex = 0;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tPlayer player = game.getPlayer(event.getPlayerId());\n\t\t\t\tindex = player.chooseEffect(rEffects, game);\n\t\t\t}\n\t\t\tcaught = rEffects.get(index).replaceEvent(event, replacementEffects.get(rEffects.get(index)), game);\n\t\t}\n\n\t\treturn caught;\n\t}",
            "path": "Mage/src/mage/abilities/effects/ContinuousEffects.java",
            "extendedDetails": {},
            "BugCommit": "0",
            "TangledWMoveandFileRename": "79"
        },
        "3fa0e8b8f4444c077085ad270feafcfd238d2719": {
            "type": "Ybodychange",
            "commitMessage": "...\n",
            "commitDate": "31/08/10 10:01 PM",
            "commitName": "3fa0e8b8f4444c077085ad270feafcfd238d2719",
            "commitAuthor": "BetaSteward",
            "commitDateOld": "16/05/10 10:08 PM",
            "commitNameOld": "2d5af63cbabd037e1744b0589c0af6853b2b7bf0",
            "commitAuthorOld": "BetaSteward",
            "daysBetweenCommits": 107.0,
            "commitsBetweenForRepo": 19,
            "commitsBetweenForFile": 1,
            "diff": "@@ -1,28 +1,30 @@\n \tpublic boolean replaceEvent(GameEvent event, Game game) {\n \t\tboolean caught = false;\n //\t\tList<SelfReplacementEffect> srEffects = GetApplicableSelfReplacementEffects(event, game);\n //\n //\t\tif (srEffects.size() > 0) {\n //\t\t\tif (srEffects.size() == 1) {\n //\t\t\t\tcaught = srEffects.get(0).ReplaceEvent(event, game);\n //\t\t\t}\n //\t\t\telse {\n //\t\t\t\t//TODO: handle multiple\n //\t\t\t}\n //\t\t}\n \n \t\tif (!caught) {\n \t\t\tList<ReplacementEffect> rEffects = getApplicableReplacementEffects(event, game);\n \t\t\tif (rEffects.size() > 0) {\n+\t\t\t\tint index;\n \t\t\t\tif (rEffects.size() == 1) {\n-\t\t\t\t\tcaught = rEffects.get(0).replaceEvent(event, game);\n+\t\t\t\t\tindex = 0;\n \t\t\t\t}\n \t\t\t\telse {\n \t\t\t\t\tPlayer player = game.getPlayer(event.getPlayerId());\n-\t\t\t\t\tcaught = rEffects.get(player.chooseEffect(rEffects, game)).replaceEvent(event, game);\n+\t\t\t\t\tindex = player.chooseEffect(rEffects, game);\n \t\t\t\t}\n+\t\t\t\tcaught = rEffects.get(index).replaceEvent(event, effects.get(rEffects.get(index)), game);\n \t\t\t}\n \t\t}\n \n \t\treturn caught;\n \t}\n\\ No newline at end of file\n",
            "actualSource": "\tpublic boolean replaceEvent(GameEvent event, Game game) {\n\t\tboolean caught = false;\n//\t\tList<SelfReplacementEffect> srEffects = GetApplicableSelfReplacementEffects(event, game);\n//\n//\t\tif (srEffects.size() > 0) {\n//\t\t\tif (srEffects.size() == 1) {\n//\t\t\t\tcaught = srEffects.get(0).ReplaceEvent(event, game);\n//\t\t\t}\n//\t\t\telse {\n//\t\t\t\t//TODO: handle multiple\n//\t\t\t}\n//\t\t}\n\n\t\tif (!caught) {\n\t\t\tList<ReplacementEffect> rEffects = getApplicableReplacementEffects(event, game);\n\t\t\tif (rEffects.size() > 0) {\n\t\t\t\tint index;\n\t\t\t\tif (rEffects.size() == 1) {\n\t\t\t\t\tindex = 0;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tPlayer player = game.getPlayer(event.getPlayerId());\n\t\t\t\t\tindex = player.chooseEffect(rEffects, game);\n\t\t\t\t}\n\t\t\t\tcaught = rEffects.get(index).replaceEvent(event, effects.get(rEffects.get(index)), game);\n\t\t\t}\n\t\t}\n\n\t\treturn caught;\n\t}",
            "path": "Mage/src/mage/abilities/effects/ContinuousEffects.java",
            "extendedDetails": {},
            "BugCommit": "0",
            "TangledWMoveandFileRename": "1046"
        },
        "a4ecfa58fa632ae0b1ee715ab474889c67a2f105": {
            "type": "Yintroduced",
            "commitMessage": "Initial\n",
            "commitDate": "19/03/10 9:47 PM",
            "commitName": "a4ecfa58fa632ae0b1ee715ab474889c67a2f105",
            "commitAuthor": "BetaSteward",
            "diff": "@@ -0,0 +1,40 @@\n+\tpublic boolean replaceEvent(GameEvent event, Game game) {\n+\t\tboolean caught = false;\n+//\t\tList<SelfReplacementEffect> srEffects = GetApplicableSelfReplacementEffects(event, game);\n+//\n+//\t\tif (srEffects.size() > 0) {\n+//\t\t\tif (srEffects.size() == 1) {\n+//\t\t\t\tcaught = srEffects.get(0).ReplaceEvent(event, game);\n+//\t\t\t}\n+//\t\t\telse {\n+//\t\t\t\t//TODO: handle multiple\n+//\t\t\t}\n+//\t\t}\n+\n+\t\tif (!caught) {\n+\t\t\tList<ReplacementEffect> rEffects = getApplicableReplacementEffects(event, game);\n+\t\t\tif (rEffects.size() > 0) {\n+\t\t\t\tif (rEffects.size() == 1) {\n+\t\t\t\t\tcaught = rEffects.get(0).replaceEvent(event, game);\n+\t\t\t\t}\n+\t\t\t\telse {\n+\t\t\t\t\tPlayer player = game.getPlayer(event.getPlayerId());\n+\t\t\t\t\tcaught = rEffects.get(player.chooseEffect(rEffects, game)).replaceEvent(event, game);\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\n+//\t\tif (!caught) {\n+//\t\t\tList<PreventionEffect> pEffects = GetApplicablePreventionEffects(event, game);\n+//\t\t\tif (pEffects.size() > 0) {\n+//\t\t\t\tif (pEffects.size() == 1) {\n+//\t\t\t\t\tcaught = pEffects.get(0).ReplaceEvent(event, game);\n+//\t\t\t\t}\n+//\t\t\t\telse {\n+//\t\t\t\t\t//TODO: handle multiple\n+//\t\t\t\t}\n+//\t\t\t}\n+//\t\t}\n+\n+\t\treturn caught;\n+\t}\n\\ No newline at end of file\n",
            "actualSource": "\tpublic boolean replaceEvent(GameEvent event, Game game) {\n\t\tboolean caught = false;\n//\t\tList<SelfReplacementEffect> srEffects = GetApplicableSelfReplacementEffects(event, game);\n//\n//\t\tif (srEffects.size() > 0) {\n//\t\t\tif (srEffects.size() == 1) {\n//\t\t\t\tcaught = srEffects.get(0).ReplaceEvent(event, game);\n//\t\t\t}\n//\t\t\telse {\n//\t\t\t\t//TODO: handle multiple\n//\t\t\t}\n//\t\t}\n\n\t\tif (!caught) {\n\t\t\tList<ReplacementEffect> rEffects = getApplicableReplacementEffects(event, game);\n\t\t\tif (rEffects.size() > 0) {\n\t\t\t\tif (rEffects.size() == 1) {\n\t\t\t\t\tcaught = rEffects.get(0).replaceEvent(event, game);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tPlayer player = game.getPlayer(event.getPlayerId());\n\t\t\t\t\tcaught = rEffects.get(player.chooseEffect(rEffects, game)).replaceEvent(event, game);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n//\t\tif (!caught) {\n//\t\t\tList<PreventionEffect> pEffects = GetApplicablePreventionEffects(event, game);\n//\t\t\tif (pEffects.size() > 0) {\n//\t\t\t\tif (pEffects.size() == 1) {\n//\t\t\t\t\tcaught = pEffects.get(0).ReplaceEvent(event, game);\n//\t\t\t\t}\n//\t\t\t\telse {\n//\t\t\t\t\t//TODO: handle multiple\n//\t\t\t\t}\n//\t\t\t}\n//\t\t}\n\n\t\treturn caught;\n\t}",
            "path": "Mage/src/mage/abilities/effects/ContinuousEffects.java",
            "BugCommit": "0",
            "TangledWMoveandFileRename": "0"
        }
    },
    "file": "73534.json"
}